{"version":3,"file":"App.controller.js","names":["BaseController","_interopRequireDefault","__BaseController","App","extend","onInit","_onInit","this","getView","addStyleClass","getOwnerComponent","getContentDensityClass","Device","resize","width","onSideNavButtonPress","getBundleText","_getBundleText","sI18nKey","aPlaceholderValues","Promise","resolve","getBundleTextByModel","getModel","onShutdownPress","async","_onShutdownPress","console","log","globalModel","backendBaseUrl","getProperty","response","fetch","method","ok","result","json","showShutdownConfirmationPage","error","status","MessageBox","title","_showShutdownConfirmationPage","description","instruction","buttonText","buttonTooltip","document","setTimeout","body","innerHTML","replace","_onSideNavButtonPress","oToolPage","byId","bSideExpanded","getSideExpanded","setSideExpanded","_setToggleButtonTooltip","oToggleButton","setTooltip"],"sources":["App.controller.ts"],"sourcesContent":["import BaseController from \"./BaseController\";\nimport Device from \"sap/ui/Device\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport ToolPage from \"sap/tnt/ToolPage\";\nimport ResourceModel from \"sap/ui/model/resource/ResourceModel\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport VBox from \"sap/m/VBox\";\nimport HBox from \"sap/m/HBox\";\nimport Text from \"sap/m/Text\";\nimport Title from \"sap/m/Title\";\nimport Button from \"sap/m/Button\";\nimport Panel from \"sap/m/Panel\";\nimport Icon from \"sap/ui/core/Icon\";\nimport Page from \"sap/m/Page\";\n\n/**\n * @namespace com.optrabot.ui.controller\n */\nexport default class App extends BaseController {\n\tpublic onInit(): void {\n\t\t// apply content density mode to root view\n\t\tthis.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());\n\n\t\t// if the app starts on desktop devices with small or medium screen size, collaps the side navigation\n\t\tif (Device.resize.width <= 1024) {\n\t\t\tthis.onSideNavButtonPress();\n\t\t}\n\t}\n\t\n\tpublic getBundleText(sI18nKey: string, aPlaceholderValues?: string[]): Promise<string> {\n\t\treturn Promise.resolve(this.getBundleTextByModel(sI18nKey, this.getOwnerComponent().getModel(\"i18n\") as ResourceModel, aPlaceholderValues));\n\t}\n\n\tpublic async onShutdownPress(): Promise<void> {\n\t\tconsole.log(\"Shutdown button pressed\");\n\t\tconst globalModel = this.getOwnerComponent().getModel(\"global\") as JSONModel;\n\t\tconst backendBaseUrl = globalModel.getProperty(\"/backendBaseUrl\");\n\t\t\n\t\ttry {\n\t\t\tconst response = await fetch(`${backendBaseUrl}/api/shutdown`, { method: 'POST' });\n\t\t\t\n\t\t\tif (response.ok) {\n\t\t\t\tconst result = await response.json();\n\t\t\t\tconsole.log(\"Shutdown request successful\", result);\n\t\t\t\t\n\t\t\t\tawait this.showShutdownConfirmationPage();\n\n\t\t\t} else {\n\t\t\t\tconsole.error(\"Shutdown request failed with status:\", response.status);\n\t\t\t\tMessageBox.error(\n\t\t\t\t\t\"Fehler beim Herunterfahren des OptraBots.\",\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: \"Shutdown Fehler\"\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error occurred while shutting down:\", error);\n\t\t\tMessageBox.error(\n\t\t\t\t\"Ein unerwarteter Fehler ist beim Herunterfahren aufgetreten.\",\n\t\t\t\t{\n\t\t\t\t\ttitle: \"Unerwarteter Fehler\"\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate async showShutdownConfirmationPage(): Promise<void> {\n\t\t// Hole die lokalisierten Texte\n\t\tconst title = await this.getBundleText(\"shutdownPageTitle\");\n\t\tconst description = await this.getBundleText(\"shutdownPageDescription\");\n\t\tconst instruction = await this.getBundleText(\"shutdownPageInstruction\");\n\t\tconst buttonText = await this.getBundleText(\"shutdownPageButtonText\");\n\t\tconst buttonTooltip = await this.getBundleText(\"shutdownPageButtonTooltip\");\n\t\t\n\t\t// Ändere den Seitentitel sofort\n\t\tdocument.title = `OptraBot - ${title}`;\n\t\t\n\t\t// Erstelle eine saubere Shutdown-Seite mit DOM-Manipulation\n\t\t// Dies verhindert Konflikte mit der bestehenden NavigationList\n\t\tsetTimeout(() => {\n\t\t\tdocument.body.innerHTML = `\n\t\t\t\t<!DOCTYPE html>\n\t\t\t\t<html>\n\t\t\t\t<head>\n\t\t\t\t\t<meta charset=\"utf-8\">\n\t\t\t\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t\t\t\t\t<title>OptraBot - ${title}</title>\n\t\t\t\t\t<link rel=\"icon\" type=\"image/png\" href=\"img/favicon.png\">\n\t\t\t\t\t<link rel=\"stylesheet\" href=\"https://sdk.openui5.org/1.132.1/resources/sap/ui/core/themes/sap_horizon/library.css\">\n\t\t\t\t\t<style>\n\t\t\t\t\t\tbody, html {\n\t\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\t\theight: 100vh;\n\t\t\t\t\t\t\tfont-family: '72', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n\t\t\t\t\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.shutdown-container {\n\t\t\t\t\t\t\tbackground: rgba(255, 255, 255, 0.98);\n\t\t\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\t\t\tpadding: 48px 40px;\n\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t\tbox-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\n\t\t\t\t\t\t\tmax-width: 520px;\n\t\t\t\t\t\t\twidth: 90%;\n\t\t\t\t\t\t\tborder: 1px solid rgba(0, 0, 0, 0.1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.success-icon {\n\t\t\t\t\t\t\twidth: 50px;\n\t\t\t\t\t\t\theight: 50px;\n\t\t\t\t\t\t\tmargin: 0 auto 32px;\n\t\t\t\t\t\t\tbackground: #4CAF50;\n\t\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\t\tfont-size: 40px;\n\t\t\t\t\t\t\tfont-weight: 300;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.shutdown-title {\n\t\t\t\t\t\t\tfont-size: 28px;\n\t\t\t\t\t\t\tfont-weight: 400;\n\t\t\t\t\t\t\tcolor: #333;\n\t\t\t\t\t\t\tmargin-bottom: 24px;\n\t\t\t\t\t\t\tline-height: 1.2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.shutdown-description {\n\t\t\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\t\t\tcolor: #666;\n\t\t\t\t\t\t\tmargin-bottom: 20px;\n\t\t\t\t\t\t\tline-height: 1.6;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.shutdown-instruction {\n\t\t\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\t\t\tcolor: #333;\n\t\t\t\t\t\t\tmargin-bottom: 32px;\n\t\t\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.close-button {\n\t\t\t\t\t\t\tbackground: #0854a0;\n\t\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\t\tborder: none;\n\t\t\t\t\t\t\tpadding: 12px 24px;\n\t\t\t\t\t\t\tborder-radius: 6px;\n\t\t\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\t\t\t\tmin-width: 200px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.close-button:hover {\n\t\t\t\t\t\t\tbackground: #0a5d9e;\n\t\t\t\t\t\t\tbox-shadow: 0 2px 8px rgba(8, 84, 160, 0.3);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.close-button:active {\n\t\t\t\t\t\t\ttransform: translateY(1px);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.close-button:focus {\n\t\t\t\t\t\t\toutline: 2px solid #0854a0;\n\t\t\t\t\t\t\toutline-offset: 2px;\n\t\t\t\t\t\t}\n\t\t\t\t\t</style>\n\t\t\t\t</head>\n\t\t\t\t<body>\n\t\t\t\t\t<div class=\"shutdown-container\">\n\t\t\t\t\t\t<div class=\"success-icon\">✓</div>\n\t\t\t\t\t\t<h1 class=\"shutdown-title\">${title}</h1>\n\t\t\t\t\t\t<p class=\"shutdown-description\">\n\t\t\t\t\t\t\t${description.replace(/\\\\n/g, '<br>')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p class=\"shutdown-instruction\">\n\t\t\t\t\t\t\t${instruction}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<button class=\"close-button\" onclick=\"window.close();\" title=\"${buttonTooltip}\">\n\t\t\t\t\t\t\t${buttonText}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<script>\n\t\t\t\t\t\t// Fokus auf den Button setzen für Keyboard-Navigation\n\t\t\t\t\t\tdocument.querySelector('.close-button').focus();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Tastaturunterstützung\n\t\t\t\t\t\tdocument.addEventListener('keydown', function(e) {\n\t\t\t\t\t\t\tif (e.key === 'Escape' || (e.ctrlKey && e.key === 'w') || (e.metaKey && e.key === 'w')) {\n\t\t\t\t\t\t\t\twindow.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t</script>\n\t\t\t\t</body>\n\t\t\t\t</html>\n\t\t\t`;\n\t\t}, 500); // Kurze Verzögerung um sicherzustellen, dass der API-Call abgeschlossen ist\n\t}\n\n\tpublic onSideNavButtonPress(): void {\n\t\tconsole.log(\"SideNavButton pressed\");\n\t\tconst oToolPage = this.byId(\"optrabot_app\") as ToolPage;\n\t\tvar bSideExpanded = oToolPage.getSideExpanded();\n\t\toToolPage.setSideExpanded(!bSideExpanded);\n\t\tthis._setToggleButtonTooltip(!bSideExpanded);\n\t}\n\n\tpublic async _setToggleButtonTooltip(bSideExpanded: boolean): Promise<void> {\n\t\tconst oToggleButton = this.byId(\"sideNavigationToggleButton\");\n\t\tif (bSideExpanded) {\n\t\t\toToggleButton.setTooltip(await this.getBundleText(\"sideNavigationCollapseTooltip\"));\n\t\t} else {\n\t\t\toToggleButton.setTooltip(await this.getBundleText(\"sideNavigationExpandTooltip\"));\n\t\t}\n\t}\n}\n"],"mappings":"uMAAOA,EAAcC,EAAAC,GAerB,MAGqBC,EAAYH,EAAcI,OAAA,kCACvCC,OAAM,SAAAC,IAEZC,KAAKC,UAAUC,cAAcF,KAAKG,oBAAoBC,0BAGtD,GAAIC,EAAOC,OAAOC,OAAS,KAAM,CAChCP,KAAKQ,sBACN,CACD,EAEOC,cAAa,SAAAC,EAACC,EAAkBC,GACtC,OAAOC,QAAQC,QAAQd,KAAKe,qBAAqBJ,EAAUX,KAAKG,oBAAoBa,SAAS,QAA0BJ,GACxH,EAEaK,gBAAeC,eAAAC,IAC3BC,QAAQC,IAAI,2BACZ,MAAMC,EAActB,KAAKG,oBAAoBa,SAAS,UACtD,MAAMO,EAAiBD,EAAYE,YAAY,mBAE/C,IACC,MAAMC,QAAiBC,MAAM,GAAGH,iBAA+B,CAAEI,OAAQ,SAEzE,GAAIF,EAASG,GAAI,CAChB,MAAMC,QAAeJ,EAASK,OAC9BV,QAAQC,IAAI,8BAA+BQ,SAErC7B,KAAK+B,8BAEZ,KAAO,CACNX,QAAQY,MAAM,uCAAwCP,EAASQ,QAC/DC,EAAWF,MACV,4CACA,CACCG,MAAO,mBAGV,CACD,CAAE,MAAOH,GACRZ,QAAQY,MAAM,sCAAuCA,GACrDE,EAAWF,MACV,+DACA,CACCG,MAAO,uBAGV,CACD,EAEcJ,6BAA4Bb,eAAAkB,IAEzC,MAAMD,QAAcnC,KAAKS,cAAc,qBACvC,MAAM4B,QAAoBrC,KAAKS,cAAc,2BAC7C,MAAM6B,QAAoBtC,KAAKS,cAAc,2BAC7C,MAAM8B,QAAmBvC,KAAKS,cAAc,0BAC5C,MAAM+B,QAAsBxC,KAAKS,cAAc,6BAG/CgC,SAASN,MAAQ,cAAcA,IAI/BO,WAAW,KACVD,SAASE,KAAKC,UAAY,8MAMJT,m/FA6FUA,uEAE1BE,EAAYQ,QAAQ,OAAQ,0FAG5BP,kGAE6DE,sBAC7DD,8iBAiBL,EACC,IACJ,EAEO/B,qBAAoB,SAAAsC,IAC1B1B,QAAQC,IAAI,yBACZ,MAAM0B,EAAY/C,KAAKgD,KAAK,gBAC5B,IAAIC,EAAgBF,EAAUG,kBAC9BH,EAAUI,iBAAiBF,GAC3BjD,KAAKoD,yBAAyBH,EAC/B,EAEaG,wBAAuBlC,eAAAkC,EAACH,GACpC,MAAMI,EAAgBrD,KAAKgD,KAAK,8BAChC,GAAIC,EAAe,CAClBI,EAAcC,iBAAiBtD,KAAKS,cAAc,iCACnD,KAAO,CACN4C,EAAcC,iBAAiBtD,KAAKS,cAAc,+BACnD,CACD,IAAC,OA9MmBb,CAAG","ignoreList":[]}