import{j as e}from"./ui-DTFgKa_e.js";import{f as T,j as R,r as m}from"./vendor-Dje7enk0.js";import{u as D,d as L,a as b,B as g,l as B,S as F,D as U,C as y}from"./index-tD243MzK.js";import{C as _,d as w,b as P,c as I,a as M}from"./card-Yrf7NGmU.js";import{B as $}from"./badge-D5TJqaKK.js";import{V as Z,I as q}from"./VMCPDetailsDisplay-DE89cmKt.js";import{T as z}from"./triangle-alert-DW_m1oF-.js";import{A}from"./arrow-left-DoZf1bLk.js";import{Z as G}from"./zap-BrOjbvFk.js";import{L as H}from"./link-Da243Ry6.js";import{M as J}from"./message-square-CW0HFtVv.js";import{C as K}from"./circle-check-big-YfK9xyEK.js";import"./favicon-icon-CjFK3LTq.js";import"./chevron-down-CLOcCYE1.js";import"./type-C59iAb9S.js";import"./file-text-BBrGjPNc.js";import"./wifi-LHEink8J.js";function xe(){const u=D(),V=T(),[c]=R(),{error:x}=L(),n=V.vmcp_name,j=c.get("vmcp_username"),p=c.get("code"),o=c.get("state"),s=c.get("redirect_url"),d=c.get("user_id"),l=c.get("vmcp_type"),i=c.get("error"),[O,h]=m.useState(!0),[v,N]=m.useState(!1),[t,C]=m.useState(null);m.useEffect(()=>{S()},[]);const S=async()=>{try{if(h(!0),console.log("Loading VMCP data for:",n,j,d,i),i){h(!1);return}const r=c.get("fetch_vmcp_config_from");if(r){const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({original_state:o,vmcp_name:n,vmcp_username:j,user_id:d})});if(a.ok){const f=await a.json();C(f.vmcp_config)}else throw new Error("Failed to fetch VMCP configuration")}else{const a=await b.getVMCPConfiguration(n,{code:p,state:o,redirect_url:s,user_id:d,vmcp_type:l});a.success?C(a.data):x("Failed to load VMCP data")}}catch(r){console.error("Error loading VMCP data:",r),x("Error loading VMCP data")}finally{h(!1)}},k=async()=>{try{y.capture("oauth_setup_completed",{vmcp_name:n,vmcp_type:l,has_redirect_url:!!s}),N(!0),console.log("Saving VMCP Configuration");const r=await b.saveVMCPConfiguration(n,{vmcp_config:t,code:p,state:o,user_id:d,vmcp_type:l});if(console.log("VMCP Configuration saved"),s){console.log("Redirecting to:",s);const a=s.includes("?")?"&":"?",f=s+(o?"&state="+o:"");window.location.href=f}else u.push(`/oauth_setup/${n}/callback?code=${p}&state=${o}&configured=true`)}catch(r){console.error("Error completing OAuth:",r),x("Error completing OAuth flow")}finally{N(!1)}},E=()=>{if(y.capture("oauth_setup_error_return_to_client",{vmcp_name:n,error_message:i}),s){const r=s.includes("?")?"&":"?",a=s+r+"error="+encodeURIComponent(i||"OAuth setup failed");console.log("Returning to client:",a),window.location.href=a}else u.push("/vmcp")};return O?e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading OAuth configuration..."})]})}):i?e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-destructive/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(z,{className:"h-6 w-6 text-destructive"})}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"OAuth Setup Error"}),e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg mb-6",children:e.jsx("p",{className:"text-destructive text-sm",children:i})}),e.jsx("div",{className:"flex gap-3 justify-center",children:s&&e.jsxs(g,{onClick:E,variant:"destructive",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Return to Client"]})})]})}):t?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/20 flex items-center justify-center",children:e.jsx(B,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Complete OAuth Setup"}),e.jsxs("p",{className:"text-muted-foreground",children:["OAuth authentication for ",t.name]})]})]})}),e.jsxs(_,{className:"mb-6",children:[e.jsx(w,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-xl",children:t.name}),e.jsx(I,{className:"text-sm mt-1",children:t.description||"No description available"})]}),e.jsx($,{variant:"default",className:"text-xs px-2 py-1",children:l==="wellknown"?"Well-Known":"Public"})]})}),e.jsx(M,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(F,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:t.vmcp_config?.selected_servers?.length||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"MCP Servers"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(G,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:t.total_tools||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tools"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(H,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:t.total_resources||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Resources"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(J,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:t.total_prompts||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Prompts"})]})]})})]}),e.jsx("div",{className:"mb-8",children:e.jsx(Z,{vmcpData:t,vmcpType:l||"public",isRemoteVMCP:!1,showExpandableLists:!1})}),e.jsxs(_,{className:"mb-8",children:[e.jsx(w,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),"OAuth Setup Details"]})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"By completing the OAuth flow, you will:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 pl-4",children:[e.jsx("li",{children:"• Authenticate with the VMCP service"}),e.jsx("li",{children:"• Grant necessary permissions for the VMCP to function"}),e.jsx("li",{children:"• Complete the setup process"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You can configure server authentication and environment variables after OAuth completion."})]})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(g,{onClick:k,disabled:v,size:"lg",className:"px-8 py-3",children:v?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}),"Completing OAuth..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Complete OAuth Setup"]})})})]})}):e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive",children:"OAuth configuration not found"}),e.jsxs(g,{onClick:()=>u.push("/vmcp"),className:"mt-4",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Back to VMCP"]})]})})}export{xe as default};
//# sourceMappingURL=OAuthSetupConfigurePage-DD2xe7wf.js.map
