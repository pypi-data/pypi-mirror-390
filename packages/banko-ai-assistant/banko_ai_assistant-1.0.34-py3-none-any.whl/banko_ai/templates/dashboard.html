<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Banko - Home Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v={{ range(1, 10000) | random }}">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        'cockroach': {
                            'primary': '#6933FF',
                            'primary-light': '#8B5CF6',
                            'primary-dark': '#5B21B6',
                            'secondary': '#10B981',
                            'accent': '#F59E0B',
                            'background': '#FFFFFF',
                            'surface': '#F8FAFC',
                            'border': '#E2E8F0',
                            'text': '#1E293B',
                            'text-light': '#64748B',
                        }
                    }
                }
            }
        }
    </script>
<style>
    .mobile-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 40;
        transition: opacity 0.3s ease;
    }
    
    .sidebar-hidden {
        transform: translateX(-100%);
    }
    
    .sidebar-visible {
        transform: translateX(0);
    }
    
    .card-shadow {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .dashboard-card {
        background: white;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #E2E8F0;
        transition: all 0.3s ease;
    }
    
    .dashboard-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }
    
    .stat-card {
        background: linear-gradient(135deg, #6933FF 0%, #8B5CF6 100%);
        color: white;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(105, 51, 255, 0.3);
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(105, 51, 255, 0.4);
    }
</style>
</head>
<body class="bg-cockroach-surface text-cockroach-text">
    <div class="flex h-screen">
<!-- Sidebar -->
        <aside id="sidebar" class="fixed lg:static left-0 top-0 h-full w-72 bg-white border-r border-cockroach-border flex flex-col z-50 shadow-lg transition-all duration-300">
            <!-- Sidebar Header -->
            <div class="py-4 px-6 border-b border-cockroach-border bg-gradient-to-br from-cockroach-primary to-cockroach-primary-light">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-white">Banko</h1>
                        <p class="text-white/80 text-sm">AI Banking Assistant</p>
                    </div>
                    <button id="sidebar-close" class="lg:hidden text-white hover:bg-white/20 p-2 rounded-lg transition-colors">
                        <i class="fas fa-times text-lg"></i>
                    </button>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 p-6">
                <div class="space-y-2">
                    <a href="/home" class="sidebar-item {{ 'active' if current_page == 'home' else '' }}">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="/savings" class="sidebar-item {{ 'active' if current_page == 'savings' else '' }}">
                        <i class="fas fa-piggy-bank"></i>
                        <span>Savings</span>
                    </a>
                    <a href="/wallet" class="sidebar-item {{ 'active' if current_page == 'wallet' else '' }}">
                        <i class="fas fa-wallet"></i>
                        <span>Wallet</span>
                    </a>
                    <a href="/credit-card" class="sidebar-item {{ 'active' if current_page == 'credit-card' else '' }}">
                        <i class="fas fa-credit-card"></i>
                        <span>Credit Card</span>
                    </a>
                    <a href="/statements" class="sidebar-item {{ 'active' if current_page == 'statements' else '' }}">
                        <i class="fas fa-file-alt"></i>
                        <span>Statements</span>
                    </a>
                    <a href="/banko" class="sidebar-item {{ 'active' if current_page == 'banko' else '' }}">
                        <i class="fas fa-robot"></i>
                        <span>Banko Assistant</span>
                    </a>
                    <a href="/benefits" class="sidebar-item {{ 'active' if current_page == 'benefits' else '' }}">
                        <i class="fas fa-star"></i>
                        <span>Benefits</span>
                    </a>
                    <a href="/settings" class="sidebar-item {{ 'active' if current_page == 'settings' else '' }}">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
            </nav>
            
            <!-- Sidebar Footer -->
            <div class="p-4 border-t border-cockroach-border">
                <div class="text-center text-xs text-cockroach-text-light">
                    <p>Powered by CockroachDB</p>
                    <p>© 2025 Banko</p>
                </div>
            </div>
        </aside>
  
        <!-- Mobile Overlay -->
        <div id="mobile-overlay" class="mobile-overlay hidden"></div>
        
        <!-- Main Content -->
        <main id="main-content" class="flex-1 flex flex-col transition-all duration-300">
            <!-- Header -->
            <header class="header flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <button id="sidebar-toggle" class="lg:hidden btn-modern btn-secondary">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-white">Welcome to Roachathon Bank!</h2>
                    <div class="provider-badges flex items-center">
                        <span class="provider-badge badge-db">
                            <img src="{{ url_for('static', filename='roach-logo.svg') }}" alt="CockroachDB" />
                            CockroachDB
                        </span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 text-white">
                        <img src="{{ url_for('static', filename='profilepic.jpeg') }}" alt="Profile" class="w-8 h-8 rounded-full">
                        <span class="text-sm font-medium">John Doe</span>
                    </div>
                </div>
            </header>
            
            <!-- Dashboard Content -->
            <div class="flex-1 p-6 overflow-y-auto">
                {% if current_page == 'settings' %}
                <!-- Settings Content -->
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-6">Settings</h3>
                        
                        <!-- AI Provider Section -->
                        <div class="mb-8">
                            <h4 class="text-md font-medium text-gray-700 mb-4">AI Configuration</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">AI Provider:</label>
                                    <div class="flex items-center space-x-2">
                                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                                            {{ ai_provider.name if ai_provider else 'Unknown' }}
                                        </span>
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="model-select" class="block text-sm font-medium text-gray-700 mb-2">AI Model:</label>
                                    <div class="flex space-x-2">
                                        <select id="model-select" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white">
                                            <option value="">Loading models...</option>
                                        </select>
                                        <button id="refresh-models" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Switch between different models for the current AI provider</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- System Status Section -->
                        <div class="mb-8">
                            <h4 class="text-md font-medium text-gray-700 mb-4">System Status</h4>
                            <div id="system-status" class="space-y-2">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-spinner fa-spin text-blue-500"></i>
                                    <span class="text-sm text-gray-600">Checking system status...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <!-- Default Dashboard Content -->
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white/80 text-sm">Card Balance</p>
                                <p class="text-2xl font-bold text-white">-$2300.47</p>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                                <i class="fas fa-credit-card text-white text-lg"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-cockroach-text-light text-sm">Credit Limit</p>
                                <p class="text-2xl font-bold text-cockroach-secondary">$25000</p>
                                <p class="text-xs text-cockroach-text-light">Approved</p>
                            </div>
                            <div class="w-12 h-12 bg-cockroach-secondary/10 rounded-full flex items-center justify-center">
                                <i class="fas fa-check-circle text-cockroach-secondary text-lg"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-cockroach-text-light text-sm">Recent Transaction</p>
                                <p class="text-lg font-bold text-cockroach-text">Salary</p>
                                <p class="text-sm text-cockroach-secondary">+$5,000.00</p>
                            </div>
                            <div class="w-12 h-12 bg-cockroach-secondary/10 rounded-full flex items-center justify-center">
                                <i class="fas fa-arrow-up text-cockroach-secondary text-lg"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-cockroach-text-light text-sm">Monthly Spending</p>
                                <p class="text-lg font-bold text-cockroach-text">Shopping 52%</p>
                                <p class="text-xs text-cockroach-text-light">Top category</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-500/10 rounded-full flex items-center justify-center">
                                <i class="fas fa-shopping-cart text-blue-500 text-lg"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Expenses Chart -->
                    <div class="dashboard-card">
                        <h3 class="text-lg font-semibold text-cockroach-text mb-4">Expenses by Category</h3>
                        <div class="flex items-center justify-center">
                            <img src="{{ url_for('static', filename='Graph.png') }}" alt="Expenses Chart" class="max-w-full h-auto rounded-lg">
                        </div>
                    </div>
                    
                    <!-- Spend Analysis -->
                    <div class="dashboard-card">
                        <h3 class="text-lg font-semibold text-cockroach-text mb-4">Spend Analysis</h3>
                        <div class="flex items-center justify-center">
                            <img src="{{ url_for('static', filename='Graph2.png') }}" alt="Spend Analysis" class="max-w-full h-auto rounded-lg">
                        </div>
                    </div>
                </div>
                
                <!-- Transactions Section -->
                <div class="dashboard-card">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-cockroach-text">Recent Transactions</h3>
                        <button class="text-cockroach-primary hover:text-cockroach-primary-dark font-medium text-sm">
                            More details →
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-cockroach-surface rounded-lg">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-yellow-500/10 rounded-full flex items-center justify-center">
                                    <i class="fas fa-utensils text-yellow-500"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-cockroach-text">Uber eats</p>
                                    <p class="text-sm text-cockroach-text-light">Jan 31, 9:00 AM</p>
                                </div>
                            </div>
                            <span class="font-semibold text-red-500">-$23.10</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-cockroach-surface rounded-lg">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-blue-500/10 rounded-full flex items-center justify-center">
                                    <i class="fas fa-dumbbell text-blue-500"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-cockroach-text">Gym membership</p>
                                    <p class="text-sm text-cockroach-text-light">Jan 30, 10:31 PM</p>
                                </div>
                            </div>
                            <span class="font-semibold text-red-500">-$150.00</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 bg-cockroach-surface rounded-lg">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-green-500/10 rounded-full flex items-center justify-center">
                                    <i class="fas fa-dollar-sign text-green-500"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-cockroach-text">Salary</p>
                                    <p class="text-sm text-cockroach-text-light">Jan 30, 12:15 PM</p>
                                </div>
                            </div>
                            <span class="font-semibold text-green-500">+$5,000.00</span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </main>
    </div>

<script>
        // Sidebar Management
        class SidebarManager {
            constructor() {
                this.sidebar = document.getElementById('sidebar');
                this.mainContent = document.getElementById('main-content');
                this.sidebarToggle = document.getElementById('sidebar-toggle');
                this.sidebarClose = document.getElementById('sidebar-close');
                this.mobileOverlay = document.getElementById('mobile-overlay');
                this.isOpen = true;
                
                this.init();
            }
            
            init() {
                this.sidebarToggle?.addEventListener('click', () => this.toggle());
                this.sidebarClose?.addEventListener('click', () => this.close());
                this.mobileOverlay?.addEventListener('click', () => this.close());
                
                // Handle window resize
                window.addEventListener('resize', () => this.handleResize());
                this.handleResize();
            }
            
            toggle() {
                if (this.isOpen) {
                    this.close();
                } else {
                    this.open();
                }
            }
            
            open() {
                this.isOpen = true;
                this.sidebar.classList.remove('sidebar-hidden');
                this.sidebar.classList.add('sidebar-visible');
                this.mobileOverlay?.classList.remove('hidden');
            }
            
            close() {
                this.isOpen = false;
                this.sidebar.classList.add('sidebar-hidden');
                this.sidebar.classList.remove('sidebar-visible');
                this.mobileOverlay?.classList.add('hidden');
            }
            
            handleResize() {
                if (window.innerWidth >= 1024) {
                    // Desktop: always show sidebar
                    this.sidebar.classList.remove('sidebar-hidden');
                    this.sidebar.classList.add('sidebar-visible');
                    this.mobileOverlay?.classList.add('hidden');
                    this.isOpen = true;
                } else {
                    // Mobile: hide sidebar by default
                    this.sidebar.classList.add('sidebar-hidden');
                    this.sidebar.classList.remove('sidebar-visible');
                    this.mobileOverlay?.classList.add('hidden');
                    this.isOpen = false;
                }
            }
        }

        // Model Switching Functionality
        class ModelManager {
            constructor() {
                this.modelSelect = document.getElementById('model-select');
                this.refreshButton = document.getElementById('refresh-models');
                this.systemStatus = document.getElementById('system-status');
                
                if (this.modelSelect) {
                    this.init();
                }
            }
            
            init() {
                this.loadModels();
                this.loadSystemStatus();
                
                if (this.modelSelect) {
                    this.modelSelect.addEventListener('change', (e) => {
                        if (e.target.value) {
                            this.switchModel(e.target.value);
                        }
                    });
                }
                
                if (this.refreshButton) {
                    this.refreshButton.addEventListener('click', () => {
                        this.loadModels();
                        this.loadSystemStatus();
                    });
                }
            }
            
            async loadModels() {
                try {
                    const response = await fetch('/api/models');
                    const data = await response.json();
                    
                    if (data.success && this.modelSelect) {
                        this.modelSelect.innerHTML = '';
                        
                        data.models.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model;
                            option.textContent = model;
                            if (model === data.current) {
                                option.selected = true;
                            }
                            this.modelSelect.appendChild(option);
                        });
                    }
                } catch (error) {
                    console.error('Error loading models:', error);
                    if (this.modelSelect) {
                        this.modelSelect.innerHTML = '<option value="">Error loading models</option>';
                    }
                }
            }
            
            async switchModel(model) {
                try {
                    const response = await fetch('/api/models', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ model })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.showNotification(data.message, 'success');
                        this.loadSystemStatus();
                    } else {
                        this.showNotification('Error: ' + data.error, 'error');
                    }
                } catch (error) {
                    this.showNotification('Error: ' + error.message, 'error');
                }
            }
            
            async loadSystemStatus() {
                try {
                    const response = await fetch('/api/health');
                    const data = await response.json();
                    
                    if (this.systemStatus) {
                        if (data.success) {
                            this.systemStatus.innerHTML = `
                                <div class="space-y-2">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-check-circle text-green-500"></i>
                                        <span class="text-sm text-cockroach-text-light">Database: ${data.database}</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-${data.ai_provider === 'connected' ? 'check-circle text-green-500' : 'times-circle text-red-500'}"></i>
                                        <span class="text-sm text-cockroach-text-light">AI Provider (${data.ai_service}): ${data.ai_provider}</span>
                                        ${data.ai_provider === 'disconnected' && data.ai_provider_available ? '<span class="text-xs text-yellow-500 ml-1">(Model switched, connection test failed)</span>' : ''}
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-robot text-blue-500"></i>
                                        <span class="text-sm text-cockroach-text-light">Current Model: ${data.current_model}</span>
                                    </div>
                                </div>
                            `;
                        } else {
                            this.systemStatus.innerHTML = `
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-times-circle text-red-500"></i>
                                    <span class="text-sm text-red-500">Error: ${data.error}</span>
                                </div>
                            `;
                        }
                    }
                } catch (error) {
                    if (this.systemStatus) {
                        this.systemStatus.innerHTML = `
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-times-circle text-red-500"></i>
                                <span class="text-sm text-red-500">Error checking status</span>
                            </div>
                        `;
                    }
                }
            }
            
            showNotification(message, type) {
                // Create a simple notification
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white z-50 ${
                    type === 'success' ? 'bg-green-500' : 'bg-red-500'
                }`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing Banko Dashboard...');
            window.sidebarManager = new SidebarManager();
            window.modelManager = new ModelManager();
        });
    </script>
</body>
</html>