<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>NLSL: lfun.f90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NLSL
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lfun_8f90.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">lfun.f90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This seems to be the central hub, which is called by the L-M optimization, and which calls the functions that generate the simulated spectrum.  
<a href="#details">More...</a></p>

<p><a href="lfun_8f90_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ab7c9dc7a5f1e9505fe661df6f7f23018"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfun_8f90.html#ab7c9dc7a5f1e9505fe661df6f7f23018">lfun</a> (m, n, x, fvec, fjac, ldfjac, iflag)</td></tr>
<tr class="memdesc:ab7c9dc7a5f1e9505fe661df6f7f23018"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine for interfacing EPRLL spectral calculations with the MINPACK version of the Levenberg-Marquardt nonlinear least squares algorithm for fitting experimental spectra. The function performed function determined by the IFLAG argument. MOMDLS subroutine to calculate a spectrum or series of spectra, each of which consists of one or more spectral components, or "sites".  <a href="#ab7c9dc7a5f1e9505fe661df6f7f23018">More...</a><br /></td></tr>
<tr class="separator:ab7c9dc7a5f1e9505fe661df6f7f23018"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6920b92f32157bb75d353c210aa9ffd"><td class="memItemLeft" align="right" valign="top">logical function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfun_8f90.html#aa6920b92f32157bb75d353c210aa9ffd">hltchk</a> (ierr, isite, ispec, iflag)</td></tr>
<tr class="memdesc:aa6920b92f32157bb75d353c210aa9ffd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether a user halt (control-C) or other error has occurred during the spectral calculation and set the iflag error flag for LMNLS accordingly. Returns .true. for fatal errors or user halts, and .false. otherwise.  <a href="#aa6920b92f32157bb75d353c210aa9ffd">More...</a><br /></td></tr>
<tr class="separator:aa6920b92f32157bb75d353c210aa9ffd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This seems to be the central hub, which is called by the L-M optimization, and which calls the functions that generate the simulated spectrum. </p>

<p>Definition in file <a class="el" href="lfun_8f90_source.html">lfun.f90</a>.</p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="aa6920b92f32157bb75d353c210aa9ffd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function hltchk </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ierr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>isite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ispec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>iflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check whether a user halt (control-C) or other error has occurred during the spectral calculation and set the iflag error flag for LMNLS accordingly. Returns .true. for fatal errors or user halts, and .false. otherwise. </p>

<p>Definition at line <a class="el" href="lfun_8f90_source.html#l00615">615</a> of file <a class="el" href="lfun_8f90_source.html">lfun.f90</a>.</p>

</div>
</div>
<a class="anchor" id="ab7c9dc7a5f1e9505fe661df6f7f23018"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine lfun </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double precision, dimension(n)&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double precision, dimension(m)&#160;</td>
          <td class="paramname"><em>fvec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double precision, dimension(ldfjac,n+nsite+nspc)&#160;</td>
          <td class="paramname"><em>fjac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ldfjac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>iflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine for interfacing EPRLL spectral calculations with the MINPACK version of the Levenberg-Marquardt nonlinear least squares algorithm for fitting experimental spectra. The function performed function determined by the IFLAG argument. MOMDLS subroutine to calculate a spectrum or series of spectra, each of which consists of one or more spectral components, or "sites". </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">iflag</td><td><blockquote class="doxtable">
<p>IFLAG=0 (Printing of iterates)</p>
<p>IFLAG=1 (Evaluation of residuals function)</p>
<p>For a function evaluation, this routine takes the input vector X of search parameters, loads them into the fparm parameter arrays in /parcom/ (using additional indices available in /parcom/) and then performs spectral calculations by calling the MOMDLS subroutine.</p>
<p>The experimental data to which the calculations are to be compared is contained in the common block /expdat/. LFUN optionally shifts the calculated spectra to minimize the squared differences between calculation and data, and then automatically determines a least- squares scale factor (or set of scale factors for multiple sites/spectra) which are returned in the vector sfac in common /mspctr/. The The unscaled spectra are returned in the matrix spectr in common /mspctr/. Each column of spectr corresponds to a single site; multiple spectra are stored sequentially in the columns of spectr.</p>
<p>The residuals (differences between calculation and data after shifting and scaling) are scaled by the standard deviation of the estimated noise in each experimental spectrum, and returned to MINPACK through the fvec argument.</p>
<p>IFLAG=2 (Jacobian evaluation)</p>
<p>For evaluation of the Jacobian, the routine uses the forward-differences approximation to calculate the partial derivative of the spectrum with respect to each of the parameters being varied. The routine assumes that the individual spectra calculated at the point in parameter space where the Jacobian is being evaluated are contained in in the spectr matrix, and the appropriate scaling factors in the sfac array (both in common /mspctr/ ). The Jacobian matrix is returned in the fjac argument.</p>
<p>IFLAG=3 Fit is terminating. Output most recent set of parameter values and exit. </p>
</blockquote>
</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfun_8f90_source.html#l00068">68</a> of file <a class="el" href="lfun_8f90_source.html">lfun.f90</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="lfun_8f90_ab7c9dc7a5f1e9505fe661df6f7f23018_cgraph.png" border="0" usemap="#lfun_8f90_ab7c9dc7a5f1e9505fe661df6f7f23018_cgraph" alt=""/></div>
<map name="lfun_8f90_ab7c9dc7a5f1e9505fe661df6f7f23018_cgraph" id="lfun_8f90_ab7c9dc7a5f1e9505fe661df6f7f23018_cgraph">
<area shape="rect" id="node2" href="writr_8f90.html#a7fc7e4ae2ba0e7302d81c4c71614a28a" title="wrfun" alt="" coords="104,81,156,108"/><area shape="rect" id="node3" href="writr_8f90.html#a1aa436a086ebcf5072fd86b4f696d570" title="wrtrdg" alt="" coords="101,132,159,159"/><area shape="rect" id="node4" href="writr_8f90.html#a0855e314704f93d072249717d892d2a1" title="wrjac" alt="" coords="104,183,156,209"/><area shape="rect" id="node5" href="setprm_8f90.html#a7e1548d88d71985a1c2da1936867fcfa" title="This file contains two routines that set a given parameter, specified by an index into the fparm or i..." alt="" coords="99,233,161,260"/><area shape="rect" id="node6" href="tdsqz_8f90.html#acce045df9af0de990707f5afafcf329a" title="tdsqz" alt="" coords="103,284,157,311"/><area shape="rect" id="node7" href="tdchek_8f90.html#a96761d34b7cdccd23cba9df4dd0aa4e0" title="tdchek" alt="" coords="99,335,161,361"/><area shape="rect" id="node9" href="setspc_8f90.html#a61ca0836c54fcb7dc436e12e92759dbe" title="setspc" alt="" coords="99,385,161,412"/><area shape="rect" id="node10" href="momdls_8f90.html#ac4a32504f4ecbaad49ecd2d60a79eeb6" title="Subroutine version of EPRLL family of programs. This routine is intended for use with nonlinear least..." alt="" coords="96,436,164,463"/><area shape="rect" id="node42" href="sscale_8f90.html#a39da067b8870667b582ba329d60d0e04" title="sscale" alt="" coords="100,563,160,589"/><area shape="rect" id="node48" href="pltx_8c.html#ace1dbffe01532e1ef8931009a72dd700" title="fstplt" alt="" coords="541,588,592,615"/><area shape="rect" id="node50" href="fitl_8f90.html#abc2e8bf69aae0ee49ef6bb2f5ccf679e" title="xpack" alt="" coords="101,765,159,792"/><area shape="rect" id="node8" href="lbasix_8f90.html#a08e4d12074fccf28f9d0635483659c64" title="lbasix" alt="" coords="214,5,270,32"/><area shape="rect" id="node11" href="lcheck_8f90.html#a1c222880bc10288fb68d1dc615bcf08b" title="lcheck" alt="" coords="212,411,272,437"/><area shape="rect" id="node12" href="tensym_8f90.html#a7d21f8ee08ee97adfdd4f1f8344d7a3b" title="tocart" alt="" coords="322,563,377,589"/><area shape="rect" id="node14" href="eprls_8f90.html#a97c141db091577f522d24040ddcc3a91" title="Subroutine version of EPRLL family of programs by D. Schneider. This routine is intended for use with..." alt="" coords="217,309,267,336"/><area shape="rect" id="node32" href="ccrints_8f90.html#ae1dc3490b258748ce8604fecc424ffcd" title="ccrint" alt="" coords="431,107,485,133"/><area shape="rect" id="node13" href="cd2km_8f90.html#ac3c368805211d175425132fceb959bb4" title="cd2km" alt="" coords="427,461,489,488"/><area shape="rect" id="node15" href="pmatrl_8f90.html#ae2bbd1d3d2c972b119c130f12f50d888" title="pmatrl" alt="" coords="320,360,379,387"/><area shape="rect" id="node17" href="pltx_8c.html#ab22bf31828fb3b581a3655ce56ab9bc3" title="wpoll" alt="" coords="433,360,483,387"/><area shape="rect" id="node30" href="matrll_8f90.html#a17036c17a63dea0fc75f9b2d05281deb" title="matrll" alt="" coords="322,411,377,437"/><area shape="rect" id="node31" href="pstvec_8f90.html#a7f53a4ef493e39ea939321c0423134e1" title="pstvec" alt="" coords="320,157,379,184"/><area shape="rect" id="node33" href="stvect_8f90.html#a6d21dd6b772f9a56b6a59a986216276d" title="stvect" alt="" coords="321,107,377,133"/><area shape="rect" id="node34" href="cscg_8f90.html#ac2c12f97311dedeb153680b2419fef81" title="cscg" alt="" coords="324,259,375,285"/><area shape="rect" id="node39" href="cfs_8f90.html#aea3fae3b919d5b25eb3629ce23f8283d" title="cfs" alt="" coords="330,208,369,235"/><area shape="rect" id="node40" href="gconvl_8f90.html#a01464aec875c0107e45d8a7804098869" title="gconvl" alt="" coords="320,461,379,488"/><area shape="rect" id="node16" href="anxlk_8f90.html#ada6fa09edf3fa496ab46f2d7de2480c7" title="anxlk" alt="" coords="431,411,485,437"/><area shape="rect" id="node18" href="pltx_8c.html#ad3f1a01c499cc0f3f5bb2316f5e746db" title="doevnt" alt="" coords="537,461,596,488"/><area shape="rect" id="node19" href="pltx_8c.html#a141111e642d5f81befc812204887412a" title="calcul" alt="" coords="649,512,705,539"/><area shape="rect" id="node27" href="pltx_8c.html#a88130bf35d237dabab9614148aa3dfa3" title="drawln" alt="" coords="647,563,706,589"/><area shape="rect" id="node28" href="pltx_8c.html#ad405c86ebd73a157d4487e4424a754e6" title="calcpt" alt="" coords="648,461,705,488"/><area shape="rect" id="node29" href="pltx_8c.html#a51dac7c88bf37276eeb721ff1e4043a4" title="setxpts" alt="" coords="644,411,709,437"/><area shape="rect" id="node20" href="pltx_8c.html#a422a31814a7415731e36707f73c4121f" title="findmax" alt="" coords="759,411,826,437"/><area shape="rect" id="node21" href="pltx_8c.html#aa6614a6fc5066548ab0cdb791113a069" title="findmin" alt="" coords="761,461,824,488"/><area shape="rect" id="node22" href="pltx_8c.html#ad09dfee00faca367bed656e71623f002" title="pixary" alt="" coords="764,512,821,539"/><area shape="rect" id="node25" href="pltx_8c.html#aefa16b0f532fe180904f44eafab05208" title="findzero" alt="" coords="759,563,826,589"/><area shape="rect" id="node26" href="pltx_8c.html#aa6565904a3998c8908015d1a8f6445b3" title="differnce" alt="" coords="757,613,828,640"/><area shape="rect" id="node23" href="pltx_8c.html#a6747050abff0d477c44e492383218a11" title="xnew" alt="" coords="881,487,933,513"/><area shape="rect" id="node24" href="pltx_8c.html#a9d46ff9578c5000db70120029a2cb57f" title="xdump" alt="" coords="876,537,937,564"/><area shape="rect" id="node35" href="zaypx_8f90.html#ad804995ea2eb0d1d0024c86c91c42280" title="zaypx" alt="" coords="429,309,487,336"/><area shape="rect" id="node36" href="scmvm_8f90.html#a817a228f783b83b1f24cba6492a5020c" title="scmvm" alt="" coords="427,157,489,184"/><area shape="rect" id="node37" href="zaxpy_8f90.html#a624350bcd2e4e1eea8741a253580dccb" title="zaxpy" alt="" coords="429,208,487,235"/><area shape="rect" id="node38" href="cgltri_8f90.html#ae8e8ac24c0e51a504cfd460519d82e9c" title="cgltri" alt="" coords="433,259,483,285"/><area shape="rect" id="node41" href="ftfuns_8f90.html#af84562807eef4e65674c1b6005c8a350" title="realft" alt="" coords="433,512,483,539"/><area shape="rect" id="node43" href="qrfac_8f90.html#ae3d81a1f6eac605eeb9f19ac00441bf3" title="qrfac" alt="" coords="217,613,267,640"/><area shape="rect" id="node44" href="qrutil_8f90.html#acc4f258942e86ea5ec36099ee2f83242" title="qtbvec" alt="" coords="213,664,271,691"/><area shape="rect" id="node45" href="qrutil_8f90.html#ad888b0b2150ef957dc9fbec773dd2844" title="rsolve" alt="" coords="215,512,269,539"/><area shape="rect" id="node46" href="dchex_8f90.html#a2a9333d034ad0ec4b0d9f400fad55854" title="dchex" alt="" coords="213,563,271,589"/><area shape="rect" id="node47" href="drotg_8f90.html#aae6cc59f6f785dcaf966e7f5f092ed58" title="drotg" alt="" coords="324,613,375,640"/><area shape="rect" id="node49" href="pltx_8c.html#a38dc6b2da2e8a3902fc907c2a02fc534" title="putary" alt="" coords="647,613,706,640"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="lfun_8f90_ab7c9dc7a5f1e9505fe661df6f7f23018_icgraph.png" border="0" usemap="#lfun_8f90_ab7c9dc7a5f1e9505fe661df6f7f23018_icgraph" alt=""/></div>
<map name="lfun_8f90_ab7c9dc7a5f1e9505fe661df6f7f23018_icgraph" id="lfun_8f90_ab7c9dc7a5f1e9505fe661df6f7f23018_icgraph">
<area shape="rect" id="node2" href="fitl_8f90.html#a118157010a06f371982aa8f4776e4cbf" title="fitl" alt="" coords="105,5,143,32"/><area shape="rect" id="node5" href="l1pfun_8f90.html#a3debb267bdd8abe63fda9fccd7b466e2" title="l1pfun" alt="" coords="96,56,152,83"/><area shape="rect" id="node6" href="scalec_8f90.html#ad0a10d81f2261d3878c75b50d67b8b09" title="scalec" alt="" coords="200,107,260,133"/><area shape="rect" id="node7" href="shiftc_8f90.html#a6a52b18ff3a85d80bac3f46a497d7e6e" title="shiftc" alt="" coords="203,157,257,184"/><area shape="rect" id="node3" href="fitc_8f90.html#ae805998691f59fca2d33023f207e8b7d" title="fitc" alt="" coords="211,31,249,57"/><area shape="rect" id="node4" href="nlsl_8f90.html#a89bfe89320539cc08d8701d4f2a028a6" title="nlsl" alt="" coords="308,107,351,133"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="lfun_8f90.html">lfun.f90</a></li>
    <li class="footer">Generated on Wed Jun 3 2015 12:50:25 for NLSL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
