# Text Enhancement Pipeline - Configuration with Validation Rules
# This example shows how to configure optional validation rules

provider:
  name: ultrasafe
  api_key: ${OMNIGEN_TEXT_ENHANCEMENT_API_KEY}
  model: usf-mini
  temperature: 0.7
  max_tokens: 4096

generation:
  num_texts: 10
  parallel_workers: 10
  skip_invalid: true

base_data:
  enabled: true
  file_path: examples/text_enhancement/sample_data.jsonl
  text_column: text
  format: jsonl

storage:
  type: jsonl
  output_file: output.jsonl
  partial_file: partial.jsonl
  failed_file: failed.jsonl

checkpoint:
  enabled: true
  auto_save_frequency: 100
  validate_input_hash: true
  resume_mode: auto

# ============================================================================
# VALIDATION CONFIGURATION (OPT-IN - Disabled by default)
# ============================================================================
# All validation is optional and disabled by default.
# Uncomment and configure rules you want to enforce.
# ============================================================================

validation:
  # Enable validation (disabled by default)
  enabled: true
  
  # Max retry attempts if validation fails
  max_retries: 2
  
  # Mark as failed after max retries (or save with warning if false)
  fail_on_validation_error: true
  
  # Save rejected items to separate file for analysis
  save_rejected_to_file: true
  rejected_file: rejected.jsonl
  
  # Validation rules (all are opt-in)
  rules:
    # Rule 1: Must not be empty (fail immediately, no retry)
    - type: not_empty
      enabled: true
      name: empty_check
      fail_immediately: true
      description: 'Enhanced text must not be empty'
    
    # Rule 2: Length must be 70-130% of original
    # (Prevents removing too much or adding unnecessary details)
    - type: length_ratio
      enabled: true
      min_ratio: 0.7   # Enhanced must be ≥70% of original length
      max_ratio: 1.3   # Enhanced must be ≤130% of original length
      name: length_ratio_70_130
      description: 'Enhanced text must be 70-130% of original length'
    
    # Rule 3: Must be different from original (actual enhancement)
    - type: not_identical
      enabled: true
      name: must_be_enhanced
      description: 'Enhanced text must be different from original'
    
    # Rule 4: Minimum length (optional)
    - type: min_length
      enabled: false  # Disabled - only use if needed
      value: 20
      name: min_20_chars
      description: 'Enhanced text must be at least 20 characters'
    
    # Rule 5: No TODO/FIXME markers (optional)
    - type: regex_not_match
      enabled: false  # Disabled - only use if needed
      pattern: '\b(TODO|FIXME|XXX)\b'
      name: no_dev_markers
      description: 'Must not contain development markers'
    
    # Rule 6: Must have proper sentence structure (optional)
    - type: regex_match
      enabled: false  # Disabled - only use if needed
      pattern: '[.!?]$'
      name: ends_with_punctuation
      description: 'Must end with sentence punctuation'

# ============================================================================
# EXAMPLE RULE CONFIGURATIONS
# ============================================================================

# Example 1: Strict validation (high quality)
# validation:
#   enabled: true
#   max_retries: 3
#   save_rejected_to_file: true
#   rules:
#     - {type: not_empty, enabled: true, fail_immediately: true}
#     - {type: length_ratio, enabled: true, min_ratio: 0.8, max_ratio: 1.2}
#     - {type: not_identical, enabled: true}
#     - {type: min_length, enabled: true, value: 50}

# Example 2: Minimal validation (fast, basic safety)
# validation:
#   enabled: true
#   max_retries: 1
#   rules:
#     - {type: not_empty, enabled: true, fail_immediately: true}

# Example 3: Custom regex patterns
# validation:
#   enabled: true
#   max_retries: 2
#   rules:
#     - {type: regex_match, enabled: true, pattern: '[A-Z]', name: has_uppercase}
#     - {type: regex_match, enabled: true, pattern: '\d', name: has_number}
#     - {type: regex_not_match, enabled: true, pattern: 'http://', name: no_http}

# Example 4: Disabled (default - no validation overhead)
# validation:
#   enabled: false

error_handling:
  max_retries: 3
  fail_fast: true
  save_partial_on_error: true

debug:
  log_api_timing: true
  log_parallel_status: true
