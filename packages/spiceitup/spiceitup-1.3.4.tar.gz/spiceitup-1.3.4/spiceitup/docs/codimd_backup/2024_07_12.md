---
tags: SPICE, Qt, Quicklook
---
# 2024-06-26 Quicklook Qt meeting
Participants: **David, Frédéric, Éric, Alfred, Salim** (medoc room)
*  [Previous notes](https://codimd.math.cnrs.fr/qUGG2nXXQ9u0FHohWA-e8Q?both#)
*  [Next notes](https://codimd.math.cnrs.fr/qvTgFUegT5axhR6OZ4uH4w#)

## Ready to be checked :checkered_flag:

- In file history but does not exist anymore -> change error message and delete from recent files
![](https://codimd.math.cnrs.fr/uploads/upload_6af4409f81a9da837358a34b0cf15790.png)

NOK on Frédéric's Windows! probably OK when interface is restarted, but need to refresh live

When it works (everyone else): the last file (opened by Ctrl+L) is still the one that is greyed out (if this one has been deleted)

* Open raster (solo_L2_spice-n-ras_20220402T131536_V06_100664004-000.fits), change y fitting boundaries for N IV 765, fit Ne VIII 770. Error:
```
  File "/home/eric/proposals/SO/SPICEops/visualization/data_quicklook/threads/workers/generate_fit_maps.py", line 30, in run
    intensities = self.main.dh.cube_ready_fit[win_key][x_i, y_i, :]
                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
IndexError: index 830 is out of bounds for axis 1 with size 830
```
Actually the error is systematic, even when fitting a just-opened file (with no y boundaries changed) **David: fixed, actually occured when y size was greater than the default y bar position, e.g. in this FITS file: y size is 830 whereas default y position (the upper bar) is 1024**

OK!

- Explain where to find fit maps results once they are ready

OK! but do not show the message if the checkbox is already clicked

- Bars to select the ROI are not visible when plot is zoomed. Not enough contrast.

Now red, are visible.

- For single exposure files, allow I(lambda), but without gaussian fit (+ warn I(x,y) and fits are disabled)

OK !


- [previous question]:question: Where do we upload the doc? or we could open the doc from the project itself.
:point_right: **Answer:** ... link to gitlab?

We have to write the documentation first...


- [previous] Review english in the app, remove explanations, instead we suggest a link to the user documentation?
    - English looks OK. Suggestion: "The grey bars are used to restrict the ROI used to generate the fit maps (e.g. to ignore dumbbells)."
- Use reduced χ² (divide Χ² by number of fitting parameters - 1)
- Then when one cancels the fit, one cannot re-try (because the fit is "already done")
- The warning "Before generating fit maps, you can adjust the y bounds (...)" appears systematically, even when the y bounds have already been changed

All gooooooood !


## To do next

- At least on windows, a window briefly opens at each generation of a plot.

- change mouse cursor to arrow when hovering over cut bars

We can see that the white bars are active when hovering with mouse. We could do the same for the red bars.

- Review behavior when changing scale to logarithmic or other in level option
:question: We use now the "scaled" values to display the image, are they wrong in the histogram then (next to maps)? Pyqtgraph expects 3D objects to display maps+histograms
:point_right: **Answer:** yes the values on the histogram axis are "wrong" (they are the scaled values), but maybe this just has to be documented? Matplotlib can handle the color bar scaling correctly, but maybe PyQtGraph can't.
- Show original values on mouse hover and not the binned/scaled data cube (blue text in plot titles)
    - show the binned + linear values
    - also change Ave 2D in smooth 2D
- Global levels: values > 100 are not caught properly before being passed to nanpercentile(), fix: thread is abort if min,max are float in [0;100]
    - Maybe force correct value after computations are finished
- Add vertical line in profile (but not movable)
    - OK, but could be movable too
- Need to display fit values & pixel values as binned (or not) data values. Need to keep 3 cubes: original, binned & 8 bits scaled. **To sum up: "averaged + leveled" in images, original cube for mouse hovering, "averaged + not leveled" in profile $I(\lambda)$**
:question: What do we show for the profile when selected average = whole dim?
:point_right: limit fit when at least 4 lambda bins are available, otherwise do not show fit
:question: For the moment, averages are separately done for $I(x,y)$ and $I(\lambda, y)$ maps, do we have to merge the option for both maps, what is the behavior on the profile then...
:point_right: **Answer:** ... maybe run a single 3D smooth and keepd displays coherent. TBC.
- Handle sit-and-stare and full spectrum studies, for full spectrum:
    - Show/hide in the menu is locked and only $I(\lambda,y)$ is checked
    - Lambda rescaling by default set to 1

- Review about popup :question: What do we want in the "about" popup? (Fred mentioned his intern's app about this)
:point_right: **Answer:** IAS contact, release date, Eric's phone number...?
- Remove "%" value display on the footer bar that is related to "Recovering data file"
- Sort processes in the footer (by running ones, then date)
- Issue: zoom is looping -> implement a max
- Improve fit offset hint: take 1 percentile of the map to find it
- Write user doc
- Fix fit maps for sit-and-stare, fit maps should be shown in $(t,y)$ plane not $(x,y)$
* Inconsistency between binning on λ and 2D filtering on (x,y)


- (Alfred) Problems with the zoom when 'Link zoom between windows': the x-lambda axis movements are not the same for both graph. Fits filenames used: solo_L2_spice-n-exp_20220407T143611_V04_100664104-000.fits


Reminder of the name ideas:

* Minestrone: MINimal Explorer of SPICE ...
* Instant SPICE
* Gaspacho
* Knorr / Maggi
* SPICE Peek / Peep / Glance / View / Look / Eye...
* SIT / SPICE IT: SPICE Imaging Tool
    * SPICE IT UP: SPICE Imaging Tool Universal Programme
* SPICE up your world / SPICE invaders (SPICE Girls)
* SPICEX (plorer)
* SeeIT: SpicE Electronic/Explorer Imaging Tool

