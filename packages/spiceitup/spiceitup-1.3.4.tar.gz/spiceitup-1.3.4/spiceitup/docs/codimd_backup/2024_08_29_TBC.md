---
tags: SPICE, Qt, Quicklook
---
# 2024-08-29 (TBC) Quicklook Qt meeting
Participants: **(TBC) David, Frédéric, Éric, Alfred, Salim, Susanna**
*  [Previous notes](https://codimd.math.cnrs.fr/0Q_uJd1US4Wgux3-BN10bg)
*  Next notes

:warning: **Writing here, not ready yet...**

## Ready to be checked :checkered_flag:

- Recent files: in fact, do not do anything, just display an error message, do not touch the list (If archives are not mounted yet, we want to keep the data paths)

- (From Alfred) Uncheck "Link zoom windows" after loading another FITS file, otherwise the checkbox is not working

- **[Not ready yet everywhere]** Show lambda unit instead of cube index in maps
$\lambda(Å)=10\times(\frac{WAVEMAX-WAVEMIN}{NAXIS_{\lambda}}i_\lambda+WAVEMIN)$
where $\lambda_i$ was the $\lambda$ cube index

> _DPDD 4.4.1.3.3:_
> WAVEMIN is the wavelength of the leftmost edge of the first detector pixel column of the readout window, ignoring any binning, and WINWIDTH is the edge-to-edge window width. WAVEMAX is the wavelength corresponding to the rightmost edge of the window’s last pixel column.

- Read WAVEUNIT in case it's not $-9$ (nm)
$\lambda(Å)=\lambda($WAVEUNIT$) \times 10$^$[($WAVEUNIT $- (-10)]$

- Replace middle fit maps by "velocity", used: $\lambda_0=median[map$ $\lambda_{max}(x,y)]$
$v=\frac{\lambda_{mes}-\lambda_0}{\lambda_0}\times c$
OK. Can check velocities with one of Slimane's fits, seems to be OK.

- Improve fit offset hint: take 1 percentile of the map to find it
    _(scipy.optimize.curve_fit)_
    
  **Old strategy** :point_down: 
  - **No hints** 
  - **Bounds**
    - Offset = $[10\%,40\%](cube_{averaged\_not\_leveled})$
    - $\sigma$ = $[1,6]$
    - $I_{max}$ = $[0.8, 1.2]I_{max,data}$
    - $\lambda_{max}$  = $[0.8, 1.2]\lambda_{I_{max,data}}$

  **New (current) strategy** :point_down: 
  - **Hints**
      - Offset = $15\%$ $cube_{averaged\_not\_leveled}$ 
      - $\sigma=$ px\_to\_nm$(\frac{6^{(1)}}{2.355})^{(2)}$
      
          $^{(1)}$ From Susanna: FWHM = $6$ px (FWHM = $3.8$ px in doc)
      
          $^{(2)}$ From Eric (if we assume CUNIT3='nm') 
      
          px\_to\_nm$[\Delta\lambda($px$)]=\Delta\lambda($nm$)= (\Delta\lambda($px$) - CRPIX3 + 1) × CDELT3 + CRVAL3$
          
      - $I_{max}=I_{max,data}$
      - $\lambda_{max}=\lambda_{corresponding\ I_{max,data}}$

  - **Bounds**
    - Offset = $[0\%, 30\%](cube_{averaged\_not\_leveled})$
    - $\sigma=$ [px\_to\_nm$(\frac{3}{2.355})$, px\_to\_nm$(\frac{7}{2.355})]$ (arbitrary 3 and 7 pixels for FWHM)
    - $I_{max}$ = $[0.8, 1.2]I_{max,data}$ (not changed)
    - $\lambda_{max}$  = $[0.8, 1.2]\lambda_{I_{max,data}}$ (not changed)

- Improve default y (red) bars positions in $I(x,y)$
    First solution to implement (still including dumbbells): y interval is (min, max) of all pixels on y axis for which any(~isnan(I(:,y,:,:)))

- Fix arrow when hovering bars (mouse changes to arrow whereas bar isn't movable)

## Doing now

- Show "Plot not generated yet" instead of black screen (fit maps)

- Global levels: values > 100 are not caught properly before being passed to nanpercentile(), fix: thread is abort if min,max are float in [0;100]. Maybe force correct value after computations are finished

- Suggest to specify the offset hint range (with an input popup?)

- For all i buttons, the values have been converted from the units in the FITS files (nm or arcsec) to other units (m or °), and the resulting unit is not shown. It would even be better not to convert (and still display the units)

- (From Alfred) Pane not working for single exposure

- :question: What do we show for the profile when selected average = whole dim?
:point_right: limit fit when at least 4 lambda bins are available, otherwise do not show fit


## To do next (also filled from old notes)

- Write user documentation (WIP)

- At least on windows, a window briefly opens at each generation of a plot.

- **TBC** replace [average 1D / Smooth 2D] by Smooth 3D
_**(will waste important parts of development)**_

- Remove "%" value display on the footer bar that is related to "Recovering data file"

- Sort processes in the footer (by running ones, then date)

- (From Alfred) Problems with the zoom when 'Link zoom between windows': the x-lambda axis movements are not the same for both graph. Fits filenames used: solo_L2_spice-n-exp_20220407T143611_V04_100664104-000.fits

- $\lambda$ rescaling: center the view

- Zoom issue: zoom in (x,y) then pane in (lambda_y) reset the view

- Idea: mouse wheel when hovering axis: zoom axis only

- Make the vertical scroll bar larger

- (From Susanna) Moving the x-bar in the x-y plot, does not update always the pixel spectrum.
**e.g.** 3 steps raster. The profile is not updated in the second X-position and the vertical line steps of 4 positions. solo_L2_spice-n-ras_20230415T045752_V02_184549775-116.fits

- Update the date in recent files (it was the first date of loading, we want the last loaded date for each file)

- App name:
    * Minestrone: MINimal Explorer of SPICE ...
    * Instant SPICE
    * SPICE Peek / Peep / Glance / View / Look / Eye...
    * SIT / SPICE IT: SPICE Imaging Tool
        * SPICE IT UP: SPICE Imaging Tool Universal Programme
    * SPICE up your world / SPICE invaders (SPICE Girls)
    * SeeIT: SpicE Electronic/Explorer Imaging Tool
    * **QuickSV (Quicklook SPICE Viewer)** :point_left: I like this one
    * QuickSE (Quicklook SPICE Explorer)

