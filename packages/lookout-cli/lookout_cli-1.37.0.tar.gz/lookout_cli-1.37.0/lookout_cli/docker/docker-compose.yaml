name: lookout

services:
  lookout_core:
    container_name: lookout_core
    image: ghcr.io/greenroom-robotics/lookout_core:${LOOKOUT_VERSION:-latest}-cuda-${CUDA_VERSION:-12.6}
    volumes:
      - /dev/shm:/dev/shm
      - ~/.config/greenroom:/home/ros/.config/greenroom
      - ${LOOKOUT_RECORDING_DIR:-/tmp}:/home/ros/rosbags
      - ${LOOKOUT_LOG_DIR:-/tmp}:/home/ros/.ros/log
      - ${LOOKOUT_MODEL_DIR:-/tmp}:/home/ros/models
    command: ${LOOKOUT_CORE_COMMAND:-tail -f /dev/null}
    privileged: true
    ipc: host
    pid: host
    environment:
      - ROS_DOMAIN_ID
      - ROS_AUTOMATIC_DISCOVERY_RANGE
      - RMW_IMPLEMENTATION
      - LOOKOUT_CONFIG
      - LOOKOUT_CONFIG_DIR
      - CUDA_VERSION
    stop_signal: SIGINT

  lookout_ui:
    container_name: lookout_ui
    image: ghcr.io/greenroom-robotics/lookout_ui:${LOOKOUT_VERSION:-latest}
    environment:
      VITE_LOOKOUT_NAMESPACE_VESSEL: ${LOOKOUT_NAMESPACE_VESSEL}
      USE_HTTPS: false
    stop_signal: SIGINT

  lookout_greenstream:
    container_name: lookout_greenstream
    image: ghcr.io/greenroom-robotics/lookout_greenstream:${LOOKOUT_VERSION:-latest}
    volumes:
      - /dev:/dev
      - ~/.config/greenroom:/home/ros/.config/greenroom
      - ${LOOKOUT_LOG_DIR:-/tmp}:/home/ros/.ros/log
    command: ${LOOKOUT_GREENSTREAM_COMMAND:-tail -f /dev/null}
    privileged: true
    ipc: host
    pid: host
    environment:
      - ROS_DOMAIN_ID
      - ROS_AUTOMATIC_DISCOVERY_RANGE
      - RMW_IMPLEMENTATION
      - LOOKOUT_CONFIG
      - LOOKOUT_CONFIG_DIR
      - GST_DEBUG=2
      - USE_HTTPS=false
    stop_signal: SIGINT

  lookout_docs:
    container_name: lookout_docs
    image: ghcr.io/greenroom-robotics/lookout_docs:${LOOKOUT_VERSION:-latest}
    stop_signal: SIGINT
