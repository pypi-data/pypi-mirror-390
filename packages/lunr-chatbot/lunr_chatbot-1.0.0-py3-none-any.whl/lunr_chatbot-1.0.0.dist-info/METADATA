Metadata-Version: 2.4
Name: lunr_chatbot
Version: 1.0.0
Summary: BibliothÃ¨que Python pour crÃ©er des bots pour Ondes Chat
Home-page: https://github.com/MartinBellot/ondes_chat
Author: Ondes Chat
Author-email: contact@ondeschat.com
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Topic :: Communications :: Chat
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: aiohttp>=3.9.0
Requires-Dist: websockets>=12.0
Requires-Dist: cryptography>=41.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: flake8>=6.0.0; extra == "dev"
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: provides-extra
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# ğŸ¤– Lunr Chatbot Library

BibliothÃ¨que Python pour crÃ©er des bots pour l'application **Ondes Chat** avec chiffrement de bout en bout (E2E).

## ğŸ“‹ Table des matiÃ¨res

- [Installation](#-installation)
- [DÃ©marrage rapide](#-dÃ©marrage-rapide)
- [CrÃ©ation d'un bot](#-crÃ©ation-dun-bot)
- [Exemples](#-exemples)
- [RÃ©fÃ©rence API](#-rÃ©fÃ©rence-api)
- [SÃ©curitÃ©](#-sÃ©curitÃ©)
- [Contribution](#-contribution)

## ğŸš€ Installation

```bash
pip install lunr_chatbot
```

Ou installez directement depuis le dÃ©pÃ´t:

```bash
git clone https://github.com/MartinBellot/ondes_chat.git
cd ondes_chat/chatbot
pip install -e .
```

### DÃ©pendances

- Python >= 3.9
- aiohttp >= 3.9.0
- websockets >= 12.0
- cryptography >= 41.0.0

## âš¡ DÃ©marrage rapide

### 1. CrÃ©er un bot via l'API

Vous devez d'abord crÃ©er un compte bot via l'API Django (nÃ©cessite des droits admin):

```bash
curl -X POST http://localhost:8000/api/auth/bots/ \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "mon_bot",
    "email": "mon_bot@example.com",
    "description": "Mon premier bot",
    "capabilities": ["rÃ©pondre", "calculer"],
    "rate_limit_per_minute": 60
  }'
```

La rÃ©ponse contiendra:
- `bot_token`: Token JWT pour authentifier le bot
- `api_key`: ClÃ© API unique (gardez-la secrÃ¨te!)

### 2. CrÃ©er un bot simple

```python
from lunr_chatbot import OndesBotClient

# Configurer le bot
bot = OndesBotClient(
    api_url="http://localhost:8000",
    bot_token="YOUR_BOT_TOKEN_HERE"
)

# Handler pour les messages
@bot.on_message
async def handle_message(message):
    if message.content == "/hello":
        await bot.send_message(
            message.group_id,
            "Hello! ğŸ‘‹ Je suis un bot Ondes Chat!"
        )

# Lancer le bot
bot.run("GROUP_ID_HERE")
```

### 3. Ajouter le bot Ã  un groupe

Via l'API (en tant qu'admin du groupe):

```bash
curl -X POST http://localhost:8000/api/groups/{GROUP_ID}/add-bot/ \
  -H "Authorization: Bearer YOUR_USER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"bot_id": BOT_PROFILE_ID}'
```

## ğŸ¯ CrÃ©ation d'un bot

### FonctionnalitÃ©s principales

#### 1. Recevoir des messages

```python
@bot.on_message
async def handle_message(message):
    print(f"Message de {message.sender.display_name}: {message.content}")
    
    # Le contenu est automatiquement dÃ©chiffrÃ©
    if message.content.startswith("/"):
        # Traiter les commandes
        await handle_command(message)
```

#### 2. Envoyer des messages

```python
# Message simple
await bot.send_message(group_id, "Bonjour le monde!")

# Avec indicateur "en train d'Ã©crire"
await bot.send_typing(True)
await asyncio.sleep(1)
await bot.send_typing(False)
await bot.send_message(group_id, "Message aprÃ¨s rÃ©flexion...")
```

#### 3. RÃ©actions

```python
@bot.on_reaction
async def handle_reaction(reaction_data):
    emoji = reaction_data['reaction']
    message_id = reaction_data['message_id']
    user = reaction_data['user']
    
    print(f"{user['username']} a rÃ©agi avec {emoji}")

# Ajouter une rÃ©action
await bot.add_reaction(message_id, "ğŸ‘")
```

#### 4. Indicateurs de frappe

```python
@bot.on_typing
async def handle_typing(typing_data):
    if typing_data['type'] == 'user_typing':
        user = typing_data['user']
        print(f"{user['username']} est en train d'Ã©crire...")
```

### Structure d'un bot complet

```python
import logging
from lunr_chatbot import OndesBotClient

# Configuration du logging
logging.basicConfig(level=logging.INFO)

# Configuration
API_URL = "http://localhost:8000"
BOT_TOKEN = "your_token"
GROUP_ID = "group_uuid"

# CrÃ©er le bot
bot = OndesBotClient(api_url=API_URL, bot_token=BOT_TOKEN)

@bot.on_message
async def handle_message(message):
    """Handler principal pour les messages"""
    
    # Ignorer les messages de bots (Ã©viter les boucles)
    if message.sender.is_bot:
        return
    
    content = message.content.lower().strip()
    
    if content == "/help":
        await bot.send_message(message.group_id, "Aide du bot...")
    
    elif content.startswith("/"):
        await bot.send_message(
            message.group_id,
            f"Commande inconnue: {content}"
        )

if __name__ == "__main__":
    bot.run(GROUP_ID)
```

## ğŸ“š Exemples

### Echo Bot

Bot simple qui rÃ©pÃ¨te les messages:

```bash
python examples/echo_bot.py
```

### Weather Bot

Bot qui donne la mÃ©tÃ©o (donnÃ©es fictives):

```bash
python examples/weather_bot.py
```

### AI Assistant Bot

Bot assistant avec calculs et base de connaissances:

```bash
python examples/ai_assistant_bot.py
```

## ğŸ“– RÃ©fÃ©rence API

### OndesBotClient

#### MÃ©thodes

##### `__init__(api_url, bot_token, auto_decrypt=True)`

Initialise le client bot.

**ParamÃ¨tres:**
- `api_url` (str): URL de l'API (ex: "http://localhost:8000")
- `bot_token` (str): Token JWT du bot
- `auto_decrypt` (bool): DÃ©chiffrer automatiquement les messages entrants

##### `async initialize()`

Initialise le bot (authentification, clÃ©s de chiffrement).

##### `async join_group(group_id)`

Rejoint un groupe et Ã©tablit la connexion WebSocket.

**ParamÃ¨tres:**
- `group_id` (str): UUID du groupe

##### `async send_message(group_id, content, message_type='text')`

Envoie un message chiffrÃ© dans un groupe.

**ParamÃ¨tres:**
- `group_id` (str): UUID du groupe
- `content` (str): Contenu du message (sera chiffrÃ© automatiquement)
- `message_type` (str): Type de message ('text', 'image', 'file', 'voice')

##### `async send_typing(is_typing=True)`

Envoie un indicateur "en train d'Ã©crire".

##### `async add_reaction(message_id, reaction)`

Ajoute une rÃ©action emoji Ã  un message.

**ParamÃ¨tres:**
- `message_id` (str): UUID du message
- `reaction` (str): Emoji (ex: 'ğŸ‘', 'â¤ï¸')

##### `run(group_id)`

Lance le bot de maniÃ¨re synchrone (bloquante).

##### `async run_async(group_id)`

Lance le bot de maniÃ¨re asynchrone.

#### DÃ©corateurs

##### `@bot.on_message`

Enregistre un handler pour les messages entrants.

```python
@bot.on_message
async def handle(message):
    # message.content - Contenu dÃ©chiffrÃ©
    # message.sender - Objet User
    # message.group_id - ID du groupe
    pass
```

##### `@bot.on_reaction`

Enregistre un handler pour les rÃ©actions.

```python
@bot.on_reaction
async def handle(reaction_data):
    # reaction_data['reaction'] - Emoji
    # reaction_data['message_id'] - ID du message
    # reaction_data['user'] - Utilisateur
    pass
```

##### `@bot.on_typing`

Enregistre un handler pour les indicateurs de frappe.

### ModÃ¨les de donnÃ©es

#### Message

```python
@dataclass
class Message:
    id: str                      # UUID du message
    content: str                 # Contenu dÃ©chiffrÃ©
    content_encrypted: str       # Contenu chiffrÃ© (brut)
    sender: User                 # ExpÃ©diteur
    group_id: str               # ID du groupe
    message_type: str           # 'text', 'image', 'file', 'voice', 'poll'
    created_at: datetime        # Date de crÃ©ation
    is_edited: bool             # Message modifiÃ©?
    reply_to: Optional[Message] # Message auquel on rÃ©pond
    reactions: Dict[str, List[User]]  # RÃ©actions
```

#### User

```python
@dataclass
class User:
    id: int
    username: str
    email: str
    first_name: Optional[str]
    last_name: Optional[str]
    avatar: Optional[str]
    is_online: bool
    is_bot: bool
    
    @property
    def display_name(self) -> str:
        # Retourne le nom d'affichage
```

#### Group

```python
@dataclass
class Group:
    id: str
    name: Optional[str]
    group_type: str  # 'private' ou 'group'
    members: List[User]
    description: Optional[str]
    avatar: Optional[str]
    
    @property
    def is_private(self) -> bool:
        # True si discussion privÃ©e
```

## ğŸ”’ SÃ©curitÃ©

### Chiffrement E2E

Tous les messages sont automatiquement chiffrÃ©s de bout en bout:

1. **GÃ©nÃ©ration de clÃ©s RSA**: Le bot gÃ©nÃ¨re une paire de clÃ©s RSA 2048 bits
2. **Ã‰change de clÃ©s**: La clÃ© publique est partagÃ©e avec le serveur
3. **ClÃ©s de groupe**: Chaque groupe a une clÃ© AES-256-GCM unique
4. **Chiffrement des messages**: Les messages sont chiffrÃ©s avec AES-256-GCM
5. **DÃ©chiffrement automatique**: La bibliothÃ¨que dÃ©chiffre automatiquement les messages entrants

### Bonnes pratiques

âœ… **Ã€ faire:**
- Garder le `bot_token` et `api_key` secrets
- Utiliser HTTPS en production (`wss://` pour WebSocket)
- Limiter les permissions des bots
- Valider toutes les entrÃ©es utilisateur
- ImplÃ©menter un rate limiting personnalisÃ© si nÃ©cessaire

âŒ **Ã€ ne pas faire:**
- Commiter les tokens dans Git
- Partager les clÃ©s API publiquement
- Ignorer les erreurs de chiffrement
- Faire confiance aveuglÃ©ment aux entrÃ©es utilisateur

### Variables d'environnement

Utilisez des variables d'environnement pour les secrets:

```python
import os

API_URL = os.getenv("ONDES_API_URL", "http://localhost:8000")
BOT_TOKEN = os.getenv("ONDES_BOT_TOKEN")
GROUP_ID = os.getenv("ONDES_GROUP_ID")

if not BOT_TOKEN:
    raise ValueError("ONDES_BOT_TOKEN est requis")
```

## ğŸ› DÃ©bogage

### Activer les logs dÃ©taillÃ©s

```python
import logging

logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
```

### ProblÃ¨mes courants

#### Erreur d'authentification

```
AuthenticationError: Token invalide ou expirÃ©
```

**Solution:** VÃ©rifiez que le token est correct et qu'il n'a pas expirÃ©.

#### Erreur de chiffrement

```
EncryptionError: ClÃ© de groupe non disponible
```

**Solution:** Assurez-vous que le bot est membre du groupe et a reÃ§u la clÃ© de chiffrement.

#### WebSocket dÃ©connectÃ©

```
WebSocketError: WebSocket non connectÃ©
```

**Solution:** Appelez `await bot.join_group(group_id)` avant d'envoyer des messages.

## ğŸ¤ Contribution

Les contributions sont les bienvenues!

1. Forkez le projet
2. CrÃ©ez une branche feature (`git checkout -b feature/amazing-feature`)
3. Committez vos changements (`git commit -m 'Add amazing feature'`)
4. Pushez vers la branche (`git push origin feature/amazing-feature`)
5. Ouvrez une Pull Request

## ğŸ“„ Licence

MIT License - Voir le fichier LICENSE pour plus de dÃ©tails.

## ğŸ“ Support

- ğŸ“§ Email: support@ondeschat.com
- ğŸ› Issues: https://github.com/MartinBellot/ondes_chat/issues
- ğŸ“š Documentation: https://docs.ondeschat.com

## ğŸ‰ Remerciements

Merci Ã  tous les contributeurs qui ont participÃ© Ã  ce projet!

---

Fait avec â¤ï¸ par l'Ã©quipe Ondes Chat
