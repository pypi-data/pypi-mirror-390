import"../chunks/DsnmJJEf.js";import{o as Ve}from"../chunks/Dv-zU6kM.js";import{p as Ye,e as o,g as p,u as Q,i as n,h as e,m as s,k as qe,c as Ge,f as w,a as k,s as M,b as y,n as ue,l as He}from"../chunks/wiODf3u9.js";import{i as L}from"../chunks/BanhNaiI.js";import{b as Je}from"../chunks/CdVljubK.js";import{M as Ke,g as be,c as Qe,p as We,n as Xe,r as Ze,o as Ie,a as et}from"../chunks/BUiXS9lV.js";import{M as ee}from"../chunks/BpW8IzjD.js";import{R as ye}from"../chunks/pdbWY_Kb.js";import{C as tt,a as at}from"../chunks/Bv-Vpr2t.js";import{D as rt,F as ce,a as nt,e as ot,n as Ce,f as me,r as lt}from"../chunks/CrYm4EAs.js";import{T as Se}from"../chunks/DCzEWrZq.js";import{g as D}from"../chunks/CqS7hfz2.js";import{u as st,a as it,g as ut}from"../chunks/CuRYjgcn.js";import{E as W}from"../chunks/Dmw0JB4Z.js";var ct=w("<!> <!>",1),mt=w("<!> <!>",1),gt=w("<!> <!> <!>",1),dt=w("<!> <!>",1),ft=w("<!> <!> <!>",1),vt=w('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),pt=w('<div class="text-center">No solution selected</div>'),_t=w('<div class="text-center">No data with this selection.</div>');function Pt(xe,Ee){Ye(Ee,!0);let Y=o(p([])),q=o(p([])),te=o(p([])),ae=o(p([])),re=o(p([])),ne=o(p([])),ge=o(p({})),de=o(p({})),P=o(!1),R=o(!1),G=o(p([]));const Le=[{label:"Location",value:"location"},{label:"Technology & Carrier",value:"technology_carrier"}],Ae=["Annual","Cumulative"];let i=o(p([null])),d=o(!0),C=o("Annual"),j=o(p([])),U=o(p([])),N=o("location"),oe=o(!1),F=o(p([])),T=o(p([])),le=o(void 0),O=s(()=>e(i).some(t=>t===null)),z=s(()=>e(oe)&&e(d)),De=s(()=>{if(!e(i)[0]?.solution_name)return"";let t=e(i)[0].solution_name.split(".");return[t[t.length-1],e(i)[0].scenario_name,e(ve)].join("_")}),fe=s(()=>e(d)?Object.values(e(ge))[0]||"":Object.values(e(de))[0]||""),Oe=s(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Emissions"+(e(z)?"":` [${e(fe)}]`)},max:e(z)?1:void 0,suggestedMin:e(z)?-1:void 0}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));const $e={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}`+(e(z)?"":` ${e(fe)}`),title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`}}}};let ve=s(()=>e(d)?D("carbon_emissions_carrier",e(i)[0]?.version):e(C)=="Annual"?D("carbon_emissions_annual",e(i)[0]?.version):D("carbon_emissions_cumulative",e(i)[0]?.version)),X=s(()=>{if(e(O))return[];const t=new Set;return e(Y).forEach(r=>{r.forEach(u=>t.add(u.technology))}),Array.from(t).sort()}),Z=s(()=>{if(e(O))return[];const t=new Set;return e(q).forEach(r=>{r.forEach(u=>t.add(u.carrier))}),Array.from(t).sort()}),se=s(()=>{if(e(O))return[];const t=new Set;return e(Y).forEach(r=>{r.forEach(u=>t.add(u.location))}),e(q).forEach(r=>{r.forEach(u=>t.add(u.node))}),Array.from(t).sort()});Q(()=>{n(U,e(X),!0)}),Q(()=>{n(j,e(Z),!0)}),Q(()=>{n(F,e(se),!0)}),Q(()=>{n(T,e(G).map(t=>t.toString()),!0)}),Ve(()=>{n(d,it("subdiv",e(d)),!0),n(C,ut("cumul")||e(C),!0)}),Q(()=>{e(d),e(C),qe().then(()=>{st({subdiv:e(d)?"1":"0",cumul:e(C)})})});function ke(){we()}async function we(){if(e(i).length===0||e(i).some(a=>a==null))return;n(R,!0);const t=e(i),r={technology:D("carbon_emissions_technology",t[0].version),carrier:D("carbon_emissions_carrier",t[0].version),annual_limit:D("carbon_emissions_annual_limit",t[0].version),budget:D("carbon_emissions_budget",t[0].version),annual:D("carbon_emissions_annual",t[0].version),cumulative:D("carbon_emissions_cumulative",t[0].version)};let[u,...m]=await Promise.all([nt(t[0].solution_name,r.annual,t[0].scenario_name),...t.flatMap(a=>[ot(a.solution_name,Object.values(r),a.scenario_name,r.carrier)])]);n(Y,m.map(a=>a[r.technology]?.data||[]),!0),n(q,m.map(a=>a[r.carrier]?.data||[]),!0),n(re,m.map(a=>a[r.annual_limit]?.data||[]),!0),n(ne,m.map(a=>a[r.budget]?.data||[]),!0),n(te,m.map(a=>a[r.annual]?.data||[]),!0),n(ae,m.map(a=>a[r.cumulative]?.data||[]),!0),m[0].unit?.data&&n(ge,Object.fromEntries(m[0].unit.data.map(a=>[a.carrier,a[0]||a.units])),!0),u.data&&n(de,Object.fromEntries(u.data.map(a=>[a.carrier,a[0]||a.units])),!0),n(R,!1)}let Pe=s(()=>{if(e(i).length===0||e(O)||!e(te).length||!e(ae).length||!e(q).length||!e(Y).length)return[[],[]];let t,r;e(d)?e(N)=="location"?(t={technology_carrier:e(U).concat(e(j)),location:e(F)},r=["technology_carrier"]):(t={technology_carrier:e(U).concat(e(j)),location:e(F)},r=["location"]):(t={},r=[]),lt(),Ze();const u=[];return[e(i).flatMap((a,_)=>{if(!a)return[];let g;e(d)?g=W.concatenate([W.fromRows(e(q)[_]).mapIndex(l=>({...l,technology_carrier:l.carrier,location:l.node})),W.fromRows(e(Y)[_]).mapIndex(l=>({...l,technology_carrier:l.technology}))]):e(C)=="Annual"?g=W.fromRows(e(te)[_]):g=W.fromRows(e(ae)[_]),g=g.filterByCriteria(t).groupBy(r).filterDataByIndex(e(T).map(l=>e(G).indexOf(Number(l)))),e(z)&&(g=g.normalize());const A=be(a.solution_name,a.scenario_name),b=_>0?Xe():void 0;return u.push(Qe(A,b)),g.toArray().map(l=>{const v=g.length===1?e(ve):e(N)==="location"?l.index.technology_carrier:l.index.location,S=Ce(v);return{label:v,data:l.data,borderColor:S,backgroundColor:b!==void 0?We.draw(b,me(S)):me(S),stack:A}})}),u]}),pe=s(()=>He(e(Pe),2)),Ne=s(()=>e(pe)[0]),Te=s(()=>e(pe)[1]),Be=s(()=>e(i).length===0||e(O)||e(z)||e(N)==="location"&&e(F).length!==e(se).length||e(N)==="technology_carrier"&&(e(j).length!==e(Z).length||e(U).length!==e(X).length)?[]:e(i).flatMap((t,r)=>{if(!t)return[];let u;if(e(d)||e(C)=="Annual"){if((e(re)[r]??[]).length===0)return[];u=Object.entries(e(re)[r][0]).map(([g,A])=>A==="inf"?1/0:Number(A))}else{if((e(ne)[r]??[]).length===0)return[];const g=Number(Object.values(e(ne)[r][0])[0]);u=e(T).map(()=>g)}const m=be(t.solution_name,t.scenario_name),a=(e(d)||e(C)=="Annual"?"Annual Emissions Limit":"Carbon Emissions Budget")+(e(i).length>1?` (${m})`:""),_=Ce(a);return[{label:a,data:u,borderColor:_,backgroundColor:me(_),type:"line"}]})),_e=s(()=>e(Ne).concat(e(Be)));rt(xe,{parentTitle:"The Transition Pathway",pageTitle:"Emissions",filters:m=>{var a=ft(),_=k(a);ce(_,{title:"Solution Selection",children:(v,S)=>{{let H=s(()=>e(R)||e(P));Ke(v,{get disabled(){return e(H)},onSelected:ke,get solutions(){return e(i)},set solutions(c){n(i,c,!0)},get years(){return e(G)},set years(c){n(G,c,!0)},get loading(){return e(P)},set loading(c){n(P,c,!0)}})}}});var g=M(_,2);{var A=v=>{ce(v,{title:"Variable Selection",children:(S,H)=>{var c=ct(),x=k(c);Se(x,{label:"Subdivision",get value(){return e(d)},set value(h){n(d,h,!0)}});var J=M(x,2);{var K=h=>{{let f=s(()=>e(R)||e(P));ye(h,{get options(){return Ae},label:"Cumulation",get disabled(){return e(f)},get value(){return e(C)},set value($){n(C,$,!0)}})}};L(J,h=>{e(d)||h(K)})}y(S,c)}})};L(g,v=>{!e(P)&&!e(O)&&v(A)})}var b=M(g,2);{var l=v=>{ce(v,{title:"Data Selection",children:(S,H)=>{var c=dt(),x=k(c);{var J=h=>{var f=gt(),$=k(f);ye($,{get options(){return Le},label:"Aggregation",get value(){return e(N)},set value(E){n(N,E,!0)}});var V=M($,2);Se(V,{label:"Normalization",get value(){return e(oe)},set value(E){n(oe,E,!0)}});var Me=M(V,2);{var Re=E=>{ee(E,{get options(){return e(se)},label:"Locations",get value(){return e(F)},set value(I){n(F,I,!0)}})},je=E=>{var I=mt(),he=k(I);{var Ue=B=>{ee(B,{get options(){return e(X)},label:"Technologies",get value(){return e(U)},set value(ie){n(U,ie,!0)}})};L(he,B=>{e(X).length>0&&B(Ue)})}var Fe=M(he,2);{var ze=B=>{ee(B,{get options(){return e(Z)},label:"Carriers",get value(){return e(j)},set value(ie){n(j,ie,!0)}})};L(Fe,B=>{e(Z).length>0&&B(ze)})}y(E,I)};L(Me,E=>{e(N)=="location"?E(Re):E(je,!1)})}y(h,f)};L(x,h=>{e(d)&&h(J)})}var K=M(x,2);{let h=s(()=>e(G).map(f=>f.toString()));ee(K,{get options(){return e(h)},label:"Years",get value(){return e(T)},set value(f){n(T,f,!0)}})}y(S,c)}})};L(b,v=>{!e(P)&&!e(O)&&!e(R)&&v(l)})}y(m,a)},buttons:m=>{tt(m,{get chart(){return e(le)},downloadable:!0})},mainContent:m=>{var a=ue(),_=k(a);{var g=b=>{var l=vt();y(b,l)},A=b=>{var l=ue(),v=k(l);{var S=c=>{var x=pt();y(c,x)},H=c=>{var x=ue(),J=k(x);{var K=f=>{var $=_t();y(f,$)},h=f=>{{let $=s(()=>e(T).map(V=>V.toString()));Je(at(f,{type:"bar",get labels(){return e($)},get datasets(){return e(_e)},get options(){return e(Oe)},get pluginOptions(){return $e},get plotName(){return e(De)},get patterns(){return e(Te)},get generateLabels(){return et},get onClickLegend(){return Ie}}),V=>n(le,V,!0),()=>e(le))}};L(J,f=>{e(_e).length==0||e(T).length==0?f(K):f(h,!1)},!0)}y(c,x)};L(v,c=>{e(i).length==0||e(O)?c(S):c(H,!1)},!0)}y(b,l)};L(_,b=>{e(P)||e(R)?b(g):b(A,!1)})}y(m,a)}}),Ge()}export{Pt as component};
