import"../chunks/DsnmJJEf.js";import{s as Me,o as tt}from"../chunks/Dv-zU6kM.js";import{p as Ue,n as ie,a as T,b as g,c as We,f as S,d as ue,r as de,s as B,h as e,m as s,t as Re,e as w,g as I,u as je,j as rt,k as ot,i as n,l as at}from"../chunks/wiODf3u9.js";import{i as H}from"../chunks/BanhNaiI.js";import{u as nt,g as st,a as Fe,b as ke,e as it,i as lt}from"../chunks/CuRYjgcn.js";import{b as ut}from"../chunks/CdVljubK.js";import{M as dt,r as ct,g as ft,n as gt,c as vt,p as _t,o as pt,a as ht}from"../chunks/BUiXS9lV.js";import{M as fe}from"../chunks/BpW8IzjD.js";import{a as Le,C as mt}from"../chunks/Bv-Vpr2t.js";import{C as Pe,D as bt,F as ge,e as wt,b as yt,r as xt,j as De,n as Ct,f as Ye}from"../chunks/CrYm4EAs.js";import{T as Ee}from"../chunks/DCzEWrZq.js";import{u as ve}from"../chunks/DFszdP0_.js";import{E as he}from"../chunks/Dmw0JB4Z.js";var St=S('<div class="text-center text-muted my-4">Click on a bar to see a production and consumption breakdown.</div>'),Tt=S('<h3 class="font-semibold text-lg mb-4"> </h3> <!>',1),kt=S('<h3 class="font-semibold text-lg mb-4"> </h3> <!>',1),Pt=S('<div class="grid grid-cols-2 gap-4"><!> <!></div>');function Dt(me,b){Ue(b,!0);let re=s(()=>{if(b.year==null)return[];const r=b.labels.findIndex(i=>i===b.year);return b.datasets.filter(i=>i.stack===b.solution).map(i=>({data:i.data.find((k,P)=>P===r),color:i.backgroundColor,label:i.label}))});function J(){return{animation:{duration:0},responsive:!0,plugins:{tooltip:{callbacks:{label:r=>{const i=Number(r.raw||0),k=r.dataset.data.map(N=>Number(N||0)).reduce((N,D)=>N+D,0),P=(i*100/k).toFixed(2);return`${r.dataset.label}: ${r.formattedValue}${b.tooltipSuffix} (${P}%)`}}},legend:{position:"top"}},radius:"90%"}}function oe(r,i){if(b.year==null)return[];const k=e(re).filter(D=>D.data&&r(Number(D.data))),P=k.map(D=>D.data),N=k.map(D=>D.color);return[{label:i,data:P,backgroundColor:N}]}function z(r){return b.year==null?[]:e(re).filter(i=>i.data&&r(Number(i.data))).map(i=>i.label||"")}let c=s(()=>oe(r=>r>1e-6,"Production")),l=s(()=>z(r=>r>1e-6)),K=s(J),Q=s(()=>oe(r=>r<-1e-6,"Consumption")),M=s(()=>z(r=>r<-1e-6)),be=s(J);var R=ie(),j=T(R);{var X=r=>{Pe(r,{children:(i,k)=>{var P=St();g(i,P)},$$slots:{default:!0}})},V=r=>{var i=Pt(),k=ue(i);Pe(k,{children:(N,D)=>{var Z=Tt(),F=T(Z),le=ue(F);de(F);var C=B(F,2);Le(C,{type:"pie",get datasets(){return e(c)},get labels(){return e(l)},get options(){return e(K)},boxed:!1}),Re(()=>Me(le,`Breakdown of Production for ${b.year??""} (${b.solution??""})`)),g(N,Z)},$$slots:{default:!0}});var P=B(k,2);Pe(P,{children:(N,D)=>{var Z=kt(),F=T(Z),le=ue(F);de(F);var C=B(F,2);Le(C,{type:"pie",get datasets(){return e(Q)},get labels(){return e(M)},get options(){return e(be)},boxed:!1}),Re(()=>Me(le,`Breakdown of Consumption for ${b.year??""} (${b.solution??""})`)),g(N,Z)},$$slots:{default:!0}}),de(i),g(r,i)};H(j,r=>{b.year==null||b.solution==null?r(X):r(V,!1)})}g(me,R),We()}var Et=S("<div><!></div>"),Lt=S('<div class="grid grid-cols-2"><div><!></div> <!></div>'),Bt=S("<!> <!> <!>",1),Nt=S("<!> <!> <!>",1),$t=S("<!> <!> <!> <!>",1),Ot=S("<!> <!>",1),At=S('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),It=S("<div></div>"),Mt=S('<div class="text-center">No carriers with this selection.</div>'),Rt=S('<div class="text-center">No data with this selection.</div>'),jt=S("<!> <!>",1);function Zt(me,b){Ue(b,!0);let re=w(I([])),J=w(I([])),oe=w(I([])),z=I([{id:"conversion",short_id:"conv",title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{id:"storage",short_id:"stor",title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{id:"transport",short_id:"tran",title:"Transport",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_transport",positive_label:"Transport in",positive_suffix:" (transport in)",negative:"flow_transport_loss",negative_label:"Transport out",negative_suffix:" (transport out)"},{id:"import_export",short_id:"imp_exp",title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{id:"demand_shed_demand",short_id:"dem_shed",title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),c=w(I([null])),l=w(null),K=w(I([])),Q=w(I([])),M=w(I([])),be=s(()=>[...e(K),...e(Q),...e(M)]),R=w(!1),j=w(I([])),X=w(I([])),V=w(null),r=w(null),i=null,k=null,P=null,N="",D="",Z="",F="",le="",C=w(!1),A=w(!1),ze=s(()=>{if(!e(c)[0]?.solution_name||!e(l))return"";let t=e(c)[0].solution_name.split(".");return[t[t?.length-1],e(c)[0].scenario_name,e(l)].join("_")}),ce=s(()=>e(c).some(t=>t===null)),Be=w(I([])),Ne=s(()=>{let t=null;return!t&&e(l)&&(t=e(Be).find(o=>o.carrier==e(l))),t&&(t[0]||t.units)||""}),we=w(void 0),$e=s(()=>e(X)),Oe=s(()=>e(R)?"":` ${e(Ne)}`),Ve=s(()=>({datasets:{bar:{borderColor:"rgb(255, 0, 0)",borderWidth:t=>!e(V)||!e(r)||t.chart.data.labels?.[t.dataIndex]!==e(V)||t.chart.data.datasets?.[t.datasetIndex].stack!==e(r)?0:5,borderRadius:2,borderSkipped:"middle"}},animation:{duration:0},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Production"+(e(R)?"":` [${e(Ne)}]`)},max:e(R)?1:void 0,suggestedMin:e(R)?-1:void 0}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));const qe={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}${e(Oe)}`,title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`},labelColor:t=>({borderColor:t.dataset.backgroundColor,backgroundColor:t.dataset.backgroundColor,borderWidth:0})},filter:t=>Math.abs(t.parsed.y||0)>1e-6,borderWidth:0}};function Ge(t){return ht(t).map(o=>({...o,lineWidth:0}))}let ae=s(()=>{if(e(ce))return[];const t=new Set;return e(c).forEach(a=>{a.detail.system.set_carriers.forEach(u=>t.add(u))}),Array.from(t).sort()}),ye=s(()=>{if(e(ce)||e(l)===null)return[];const t=new Set;return e(c).forEach(a=>{Object.entries(a.detail.carriers_input).concat(Object.entries(a.detail.carriers_output)).filter(u=>e(l)&&u[1].includes(e(l))).forEach(u=>t.add(u[0]))}),Array.from(t).sort()}),xe=s(()=>{if(e(ce)||e(l)===null)return[];const t=new Set;return e(c).forEach(a=>{a.detail.system.set_storage_technologies.forEach(u=>{a.detail.reference_carrier[u]===e(l)&&t.add(u)})}),Array.from(t).sort()}),Ce=s(()=>{if(e(ce)||e(l)===null)return[];const t=new Set;return e(c).forEach(a=>{a.detail.system.set_transport_technologies.forEach(u=>{a.detail.reference_carrier[u]===e(l)&&t.add(u)})}),Array.from(t).sort()});je(()=>{e(ae),rt(()=>{e(c)&&e(ae).length>0&&(!e(l)||e(l)&&!e(ae).includes(e(l)))&&n(l,e(ae)[0],!0)})}),ve(()=>e(ye),()=>!!e(c),()=>N,()=>i,t=>n(K,t,!0),t=>N=t,t=>i=t),ve(()=>e(xe),()=>!!e(c),()=>D,()=>k,t=>n(Q,t,!0),t=>D=t,t=>k=t),ve(()=>e(Ce),()=>!!e(c),()=>Z,()=>P,t=>n(M,t,!0),t=>Z=t,t=>P=t),ve(()=>e(oe),()=>!!e(c),()=>F,()=>null,t=>n(j,t,!0),t=>F=t,()=>{}),ve(()=>e(J).map(t=>t.toString()),()=>!!e(c),()=>le,()=>null,t=>n(X,t,!0),t=>le=t,()=>{}),tt(()=>{n(l,st("car")||null,!0),z.forEach(t=>{t.show=Fe(t.short_id,t.show),t.subdivision=Fe(t.short_id+"_sub",t.subdivision)}),i=ke("conv_tech"),k=ke("stor_tech"),P=ke("tran_tech")}),je(()=>{e(l),z.forEach(t=>{t.show,t.subdivision}),e(K),e(Q),ot().then(()=>{let t={car:e(l),conv_tech:e(K).map(o=>e(ye).indexOf(o)).join("~"),stor_tech:e(Q).map(o=>e(xe).indexOf(o)).join("~"),tran_tech:e(M).map(o=>e(Ce).indexOf(o)).join("~")};z.forEach(o=>{t[o.short_id]=o.show?"1":"0",t[o.short_id+"_sub"]=o.subdivision?"1":"0"}),nt(t)})});async function He(){n(V,null),n(r,null),await Ke()}function Je(t,o){if(!t)return;const a=e(_e)[o].stack;if(!a||e(V)===t&&e(r)===a){n(V,null),n(r,null);return}n(V,t,!0),n(r,a||null,!0)}async function Ke(){if(e(ce))return;n(A,!0),n(re,[],!0);const t=e(c),o=await Promise.all(t.map(a=>wt(a.solution_name,["flow_conversion_output","flow_conversion_input","flow_storage_discharge","flow_storage_charge","flow_import","flow_export","flow_transport","flow_transport_loss","shed_demand","demand"],a.scenario_name,"demand")));n(re,o.map(a=>z.flatMap(u=>[a[u.positive]?.data||[],a[u.negative]?.data||[]])),!0),o.length>0&&o[0].unit?.data&&n(Be,o[0].unit.data,!0),n(A,!1)}function Ae(t,o,a,u,$){if(!e(l))return he.empty();const q={carrier:[e(l)],node:e(j)};o.filter_by_technologies&&(q.technology=e(be));const G=o.subdivision?["technology"]:[];let Y=t.filterByCriteria(q).filterDataByIndex(e(X).map(v=>e(J).indexOf(Number(v)))).groupBy(G).mapIndex(v=>({...v,label:o.subdivision?v.technology+(u||""):a}));return $!==void 0&&(Y=Y.mapData($)),Y}let Qe=s(()=>{if(e(j).length==0||e(X).length==0||e(re).length==0)return[[],[]];xt(),ct();const t=[];return[e(c).flatMap((a,u)=>{const $=e(re)[u];if(!a||!$.length)return[];let q=z.flatMap((p,O)=>{if(!p.show)return[];let h=he.fromRows($[2*O]),ee=he.fromRows($[2*O+1]);if(p.id==="transport"){const y=h,E=ee.filterByCriteria({technology:e(M),edge:De(a.detail.edges,e(j),!0)});h=y.filterByCriteria({technology:e(M),edge:De(a.detail.edges,e(j),!0)}).mapEntries((_,m)=>{const f=E.find(d=>d.index.technology===_.technology&&d.index.edge===_.edge)?.data;return!f||f.length!==m.length?{index:_,data:m}:{data:m.map((d,x)=>d-f[x]),index:_}}),ee=y.filterByCriteria({technology:e(M),edge:De(a.detail.edges,e(j),!1)})}let U=Ae(h,p,p.positive_label,p.positive_suffix),te=Ae(ee,p,p.negative_label,p.negative_suffix,y=>-y);return[U,te]}),G=he.concatenate(q);e(R)&&(G=G.normalize());let Y=ft(a.solution_name,a.scenario_name),v=u>0?gt():void 0;return t.push(vt(Y,v)),G.toArray().map(p=>{const O=p.index.label,h=Ct(O);return{label:O,data:p.data,borderColor:h,backgroundColor:v!==void 0?_t.draw(v,Ye(h)):Ye(h),stack:Y}})}),t]}),Ie=s(()=>at(e(Qe),2)),_e=s(()=>e(Ie)[0]),Xe=s(()=>e(Ie)[1]);bt(me,{parentTitle:"The Transition Pathway",pageTitle:"Production",filters:u=>{var $=Ot(),q=T($);ge(q,{title:"Solution Selection",children:(v,p)=>{{let O=s(()=>e(A)||e(C));dt(v,{onSelected:He,get disabled(){return e(O)},get solutions(){return e(c)},set solutions(h){n(c,h,!0)},get years(){return e(J)},set years(h){n(J,h,!0)},get nodes(){return e(oe)},set nodes(h){n(oe,h,!0)},get loading(){return e(C)},set loading(h){n(C,h,!0)}})}}});var G=B(q,2);{var Y=v=>{var p=$t(),O=T(p);ge(O,{title:"Carrier Selection",children:(y,ne)=>{var E=ie(),_=T(E);{var m=f=>{{let L=s(()=>e(C)||e(A));yt(f,{label:"Carrier",get options(){return e(ae)},get disabled(){return e(L)},get value(){return e(l)},set value(d){n(l,d,!0)}})}};H(_,f=>{e(ae).length>0&&f(m)})}g(y,E)}});var h=B(O,2);ge(h,{title:"Production Component Selection",children:(y,ne)=>{var E=ie(),_=T(E);it(_,17,()=>z,lt,(m,f,L)=>{var d=Lt(),x=ue(d),W=ue(x);Ee(W,{get label(){return e(f).title},get value(){return e(f).show},set value(se){e(f).show=se}}),de(x);var pe=B(x,2);{var Se=se=>{var Te=Et(),Ze=ue(Te);Ee(Ze,{label:"with Subdivision",get value(){return e(f).subdivision},set value(et){e(f).subdivision=et}}),de(Te),g(se,Te)};H(pe,se=>{e(f).show&&e(f).show_subdivision&&se(Se)})}de(d),g(m,d)}),g(y,E)}});var ee=B(h,2);ge(ee,{title:"Technology Selection",children:(y,ne)=>{var E=Bt(),_=T(E);{let L=s(()=>e(C)||e(A));fe(_,{get options(){return e(ye)},label:"Conversion",get disabled(){return e(L)},get value(){return e(K)},set value(d){n(K,d,!0)}})}var m=B(_,2);{let L=s(()=>e(C)||e(A));fe(m,{get options(){return e(xe)},label:"Storage",get disabled(){return e(L)},get value(){return e(Q)},set value(d){n(Q,d,!0)}})}var f=B(m,2);{let L=s(()=>e(C)||e(A));fe(f,{get options(){return e(Ce)},label:"Transport",get disabled(){return e(L)},get value(){return e(M)},set value(d){n(M,d,!0)}})}g(y,E)}});var U=B(ee,2);{var te=y=>{ge(y,{title:"Data Selection",children:(ne,E)=>{var _=Nt(),m=T(_);Ee(m,{label:"Normalization",get value(){return e(R)},set value(d){n(R,d,!0)}});var f=B(m,2);{let d=s(()=>e(C)||e(A));fe(f,{get options(){return e(oe)},label:"Nodes",get disabled(){return e(d)},get value(){return e(j)},set value(x){n(j,x,!0)}})}var L=B(f,2);{let d=s(()=>e(J).map(W=>W.toString())),x=s(()=>e(C)||e(A));fe(L,{get options(){return e(d)},label:"Years",get disabled(){return e(x)},get value(){return e(X)},set value(W){n(X,W,!0)}})}g(ne,_)}})};H(U,y=>{!e(A)&&e(l)!=null&&y(te)})}g(v,p)};H(G,v=>{!e(C)&&e(c)[0]!==null&&v(Y)})}g(u,$)},buttons:u=>{mt(u,{get chart(){return e(we)},downloadable:!0})},mainContent:u=>{var $=ie(),q=T($);{var G=v=>{var p=At();g(v,p)},Y=v=>{var p=ie(),O=T(p);{var h=U=>{var te=It();g(U,te)},ee=U=>{var te=ie(),y=T(te);{var ne=_=>{var m=Mt();g(_,m)},E=_=>{var m=ie(),f=T(m);{var L=x=>{var W=Rt();g(x,W)},d=x=>{var W=jt(),pe=T(W);ut(Le(pe,{type:"bar",get datasets(){return e(_e)},get labels(){return e($e)},get options(){return e(Ve)},get pluginOptions(){return qe},get plotName(){return e(ze)},get patterns(){return e(Xe)},generateLabels:Ge,get onClickLegend(){return pt},onClickBar:Je}),se=>n(we,se,!0),()=>e(we));var Se=B(pe,2);Dt(Se,{get datasets(){return e(_e)},get labels(){return e($e)},get year(){return e(V)},get solution(){return e(r)},get tooltipSuffix(){return e(Oe)}}),g(x,W)};H(f,x=>{e(_e).length==0?x(L):x(d,!1)},!0)}g(_,m)};H(y,_=>{e(ae).length==0?_(ne):_(E,!1)},!0)}g(U,te)};H(O,U=>{e(c)==null?U(h):U(ee,!1)},!0)}g(v,p)};H(q,v=>{e(C)||e(A)?v(G):v(Y,!1)})}g(u,$)}}),We()}export{Zt as component};
