import"../chunks/DsnmJJEf.js";import{o as Se}from"../chunks/Dv-zU6kM.js";import{p as ze,e as o,g as ae,u as M,h as e,i as t,j as B,k as ue,c as $e,l as Oe,m as _,f as W,a as H,s as U,b as $,n as de}from"../chunks/wiODf3u9.js";import{i as q}from"../chunks/BanhNaiI.js";import{b as ce}from"../chunks/CdVljubK.js";import{D as Le,g as je,a as De,r as Ne,n as Pe,F as ge,S as Me,b as G}from"../chunks/CrYm4EAs.js";import{C as Re,a as _e}from"../chunks/Bv-Vpr2t.js";import{g as O}from"../chunks/CqS7hfz2.js";import{u as We,g as J}from"../chunks/CuRYjgcn.js";var Ee=W("<!> <!> <!> <!>",1),Fe=W("<!> <!>",1),Te=W('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Ae=W('<div class="text-center">No data with this selection.</div>'),Ie=W('<div class="text-center text-muted mt-2">No dual data available.</div>'),Be=W("<!> <!>",1);function Qe(me,pe){ze(pe,!0);let E=null,F=o(null),k=o(!1),C=o(!1),T=o(void 0),Y=o(void 0),L=o(ae([])),j=o(ae([])),D=o(ae([]));const fe=["Hourly","Daily","Weekly","Monthly"];let r=o(null),i=o(null),u=o(null),c=o(null),S=o("Hourly"),re=_(()=>{if(!e(r)||!e(r).solution_name)return"";let l=e(r).solution_name.split(".");return[l[l.length-1],e(r).scenario_name,"balance",e(u),e(i),e(c)].join("_")}),be=_(()=>e(re)+"_duals"),le=_(()=>{if(e(F)===null)return"";let l=e(F).data.find(n=>n.carrier===e(u));return l?l[0]||l.units||"":e(F).data[0][0]||e(F).data[0].units||""}),A=o(null),Q=o(0);M(()=>{e(r)?.detail?.system.unaggregated_time_steps_per_year!==void 0&&t(Q,e(r).detail.system.unaggregated_time_steps_per_year,!0)}),M(()=>{e(Q),B(()=>{t(A,null)})});let ve=_(()=>ne(`Energy [${e(le)}]`)),he=_(()=>ne("Dual",!1,5,!1));function ne(l,n=!0,b=2,h=!0){return{animation:!1,normalized:!0,parsing:!1,responsive:!0,borderWidth:1,aspectRatio:b,elements:{point:{radius:0}},scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:m=>Number(m).toFixed(0)},min:0,max:e(Q)-1},y:{stacked:!0,beginAtZero:h,title:{display:!0,text:l}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}const oe={zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:l=>`${l.dataset.label}: ${l.formattedValue} ${e(le)}`}}};M(()=>{e(D),B(()=>{e(D).length>0&&(e(c)==null||!e(D).includes(Number(e(c))))&&t(c,e(D)[0].toString(),!0)})}),M(()=>{e(L),B(()=>{e(L).length>0&&(e(i)==null||!e(L).includes(e(i)))&&t(i,e(L)[0],!0)})}),M(()=>{e(j),B(()=>{e(j).length>0&&(e(u)==null||!e(j).includes(e(u)))&&t(u,e(j)[0],!0)})}),M(()=>{e(r),e(c),e(i),e(u),e(S),B(xe)}),Se(()=>{t(c,J("year")||e(c),!0),t(i,J("node")||e(i),!0),t(u,J("car")||e(u),!0),t(S,J("window")||e(S),!0)}),M(()=>{e(c),e(i),e(u),e(S),ue().then(()=>{We({year:e(c),node:e(i),car:e(u),window:e(S)})})});let ye=_(()=>({Daily:24,Weekly:168,Monthly:720})[e(S)]||1);async function xe(){e(i)==null||e(u)==null||e(c)==null||e(r)==null||(t(C,!0),await(async l=>{var n=Oe(l,2);E=n[0],t(F,n[1],!0)})(await Promise.all([je(e(r).solution_name,e(i),e(u),e(r).scenario_name,Number(e(c)),e(ye)),De(e(r).solution_name,O("flow_export",e(r).version),e(r).scenario_name)])),t(C,!1),Ce())}let se=_(()=>Array.from({length:e(V)},(l,n)=>n.toString())),K=[],X=[],ee=o(0),ie=o(0),V=o(0);function we(){return!e(r)||!e(i)||!e(u)||!e(c)||!E?[]:Object.entries(E).flatMap(([l,n])=>{if(!n||n.length===0||l==="constraint_nodal_energy_balance")return[];let b={node:[e(i)]};"technology"in n[0].index&&(b={technology:n.map(a=>a.index.technology)});const h=n.filter(a=>Object.entries(b).every(([p,g])=>g.includes(a.index[p]))),m={};return h.forEach(a=>{const p=a.index.technology||a.index.node||a.index.label||"";m[p]||(m[p]=new Array(a.data.length).fill(0)),a.data.forEach((g,d)=>{m[p][d]+=g})}),Object.entries(m).map(([a,p])=>{if(Object.keys(p).length==0)return null;const g=e(r).version,d={[O("flow_storage_discharge",g)]:f=>f+" (discharge)",[O("flow_transport_in",g)]:f=>f+" (transport in)",[O("flow_import",g)]:()=>"Import",[O("shed_demand",g)]:()=>"Shed Demand",[O("flow_storage_charge",g)]:f=>f+" (charge)",[O("flow_transport_out",g)]:f=>f+" (transport out)",[O("flow_export",g)]:()=>"Export"};let y=Pe(),R=y,s=Object.values(p).map((f,v)=>({x:v,y:f}));return l=="demand"?{data:s,label:"Demand",type:"line",stack:"ownCustomStack",fill:!1,borderColor:"black",backgroundColor:"white",borderWidth:2,stepped:!0,pointRadius:Object.keys(p).length==1?2:0}:{data:s,label:d[l]?.(a)||a,fill:"origin",borderColor:y,backgroundColor:R,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:Object.keys(p).length==1?2:0}}).filter(a=>a!==null)})}function ke(){if(!e(r)||!e(i)||!e(u)||!e(c)||!E)return[];const n=E["constraint_nodal_energy_balance"];return!n||n.length===0?[]:n.map(b=>b.data.length==0?null:{data:b.data.map((m,a)=>({x:a,y:m})),label:`dual_${b.index.carrier}_${b.index.node}`,fill:!1,borderColor:"rgb(0, 0, 0)",backgroundColor:"rgb(0, 0, 0)",borderWidth:2,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:b.data.length==1?2:0}).filter(b=>b!==null)}async function Ce(){Ne(),K=we(),t(ee,K.length,!0),t(V,e(ee)>0?K[0].data.length:0,!0),X=ke(),t(ie,X.length,!0),await ue(),e(T)&&e(T).updateChart(K),e(Y)&&e(Y).updateChart(X)}Le(me,{parentTitle:"The Energy Balance",pageTitle:"Nodal",filters:h=>{var m=Fe(),a=H(m);ge(a,{title:"Solution Selection",children:(d,y)=>{{let R=_(()=>e(C)||e(k));Me(d,{get disabled(){return e(R)},get selected_solution(){return e(r)},set selected_solution(s){t(r,s,!0)},get carriers(){return e(j)},set carriers(s){t(j,s,!0)},get nodes(){return e(L)},set nodes(s){t(L,s,!0)},get years(){return e(D)},set years(s){t(D,s,!0)},get loading(){return e(k)},set loading(s){t(k,s,!0)}})}}});var p=U(a,2);{var g=d=>{ge(d,{title:"Data Selection",children:(y,R)=>{var s=Ee(),f=H(s);{let x=_(()=>e(D).map(I=>I.toString())),w=_(()=>e(C)||e(k));G(f,{get options(){return e(x)},label:"Year",get disabled(){return e(w)},get value(){return e(c)},set value(I){t(c,I,!0)}})}var v=U(f,2);{let x=_(()=>e(C)||e(k));G(v,{get options(){return e(L)},label:"Node",get disabled(){return e(x)},get value(){return e(i)},set value(w){t(i,w,!0)}})}var N=U(v,2);{let x=_(()=>e(C)||e(k));G(N,{get options(){return e(j)},label:"Carrier",get disabled(){return e(x)},get value(){return e(u)},set value(w){t(u,w,!0)}})}var Z=U(N,2);{let x=_(()=>e(C)||e(k));G(Z,{get options(){return fe},label:"Smoothing Window Size",get disabled(){return e(x)},get value(){return e(S)},set value(w){t(S,w,!0)}})}$(y,s)}})};q(p,d=>{!e(k)&&e(r)&&d(g)})}$(h,m)},buttons:h=>{Re(h,{get chart(){return e(T)},downloadable:!0,zoomable:!0})},mainContent:h=>{var m=de(),a=H(m);{var p=d=>{var y=Te();$(d,y)},g=d=>{var y=de(),R=H(y);{var s=v=>{var N=Ae();$(v,N)},f=v=>{var N=Be(),Z=H(N);{let z=_(()=>e(V)==1?"bar":"line");ce(_e(Z,{get type(){return e(z)},get labels(){return e(se)},datasets:[],get options(){return e(ve)},get pluginOptions(){return oe},get plotName(){return e(re)},zoom:!0,get zoomLevel(){return e(A)},set zoomLevel(P){t(A,P,!0)}}),P=>t(T,P,!0),()=>e(T))}var x=U(Z,2);{var w=z=>{{let P=_(()=>e(V)==1?"bar":"line");ce(_e(z,{id:"chart-duals",get type(){return e(P)},get labels(){return e(se)},datasets:[],get options(){return e(he)},get pluginOptions(){return oe},get plotName(){return e(be)},zoom:!0,narrow:!0,generateLabels:()=>[],get zoomLevel(){return e(A)},set zoomLevel(te){t(A,te,!0)}}),te=>t(Y,te,!0),()=>e(Y))}},I=z=>{var P=Ie();$(z,P)};q(x,z=>{e(ie)>0?z(w):z(I,!1)})}$(v,N)};q(R,v=>{e(ee)==0||e(r)==null?v(s):v(f,!1)},!0)}$(d,y)};q(a,d=>{e(C)?d(p):d(g,!1)})}$(h,m)}}),$e()}export{Qe as component};
