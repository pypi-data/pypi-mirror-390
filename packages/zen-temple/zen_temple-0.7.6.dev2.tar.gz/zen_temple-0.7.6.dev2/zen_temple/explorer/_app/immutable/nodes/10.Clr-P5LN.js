import"../chunks/DsnmJJEf.js";import{o as ut}from"../chunks/Dv-zU6kM.js";import{p as dt,e as c,g,u as ve,i as s,h as e,m as f,k as ft,c as pt,f as L,a as B,s as y,b as m,n as le,d as Ee,r as Le,l as gt}from"../chunks/wiODf3u9.js";import{i as b}from"../chunks/BanhNaiI.js";import{u as vt,a as ze,b as ie,e as ht,i as mt}from"../chunks/DPXpTqfB.js";import{b as _t}from"../chunks/CdVljubK.js";import{M as bt,r as Ct,n as xt,g as St,c as yt,p as Ie,o as wt,a as Tt}from"../chunks/By3igSyl.js";import{M as K}from"../chunks/3Ej4NDO6.js";import{R as Ot}from"../chunks/BI67IStY.js";import{T as Ve}from"../chunks/DExI7AxJ.js";import{C as Et,a as Lt}from"../chunks/DLlwhTTU.js";import{D as Dt,F as he,e as Pt,r as jt,n as qe,f as me}from"../chunks/hzu92_2X.js";import{g as At}from"../chunks/CqS7hfz2.js";import{u as Q}from"../chunks/DFszdP0_.js";import{E as oe}from"../chunks/Dmw0JB4Z.js";import{d as kt}from"../chunks/CgsLtv0Y.js";var $t=L("<div><!></div>"),Bt=L('<div class="grid grid-cols-2"><div><!></div> <!></div>'),Mt=L("<h3>Technologies (for Capex/Opex)</h3> <!> <!> <!> <!> <!>",1),Rt=L("<!> <!> <!>",1),Ft=L("<!> <!> <!>",1),Ut=L("<!> <!>",1),Nt=L('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Yt=L('<div class="text-center">Please select at least one solution.</div>'),zt=L('<div class="text-center">Please select at least one year.</div>'),It=L('<div class="text-center">No data with this selection.</div>');function nr(Ge,He){dt(He,!0);const x="Technology / Carrier",De=" (Capex)",Pe=" (Opex)",Je="Capex",Ke="Opex",Qe="Carrier",We="Shed Demand";let U=c(g([]));const je=["Location",x];let W=c(g([])),X=c(g([])),_e=c(g([])),ce=c(g([])),ue=c(g([])),de=c(g({})),i=c(g([null])),N=c(g([])),Y=c(g([])),z=c(g([])),M=c(g([])),R=c(g([])),ae=c("Location"),se=c(g([])),D=c(g([])),be=null,Ce=null,xe=null,Se=null,ye=null,Ae="",ke="",$e="",Be="",Me="",Re="",Fe="",ne=c(!1),fe=c(!1),we=c(void 0),P=f(()=>e(i).some(t=>t===null)),j=g({capex:{title:"Capex",show:!0,subdivision:!1,showSubdivision:!0,label:Je},opex:{title:"Opex",show:!0,subdivision:!1,showSubdivision:!0,label:Ke},carrier:{title:"Carrier",show:!0,subdivision:!1,showSubdivision:!0,label:Qe},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1,showSubdivision:!0,label:We},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1,showSubdivision:!1}}),Xe=f(()=>{if(!e(i)[0])return"";let t=e(i)[0].solution_name.split(".");return[t[t.length-1],e(i)[0].scenario_name,"costs"].join("_")}),Ue=f(()=>e(te).length>0?e(de)[e(te)[0]]||"":e(ee).length>0?e(de)[e(ee)[0]]||"":e(re).length>0&&e(de)[e(re)[0]]||""),Ze=f(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(Ue)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),et={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(Ue)}`,title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`}}}},tt=f(()=>e(D)),Z=f(()=>e(P)?new Set:new Set([...e(W).flatMap(t=>t.map(r=>r.technology))||[],...e(X).flatMap(t=>t.map(r=>r.technology))||[]])),ee=f(()=>{if(e(P)||e(Z).size==0)return[];const t=e(i),r=new Set;return t.forEach(o=>{o.detail.system.set_transport_technologies.forEach(n=>{e(Z).has(n)&&r.add(n)})}),Array.from(r).sort()}),te=f(()=>{if(e(P)||e(Z).size==0)return[];const t=e(i),r=new Set;return t.forEach(o=>{o.detail.system.set_conversion_technologies.forEach(n=>{e(Z).has(n)&&r.add(n)})}),Array.from(r).sort()}),re=f(()=>{if(e(P)||e(Z).size==0)return[];const t=e(i),r=new Set;return t.forEach(o=>{o.detail.system.set_storage_technologies.forEach(n=>{e(Z).has(n)&&r.add(n)})}),Array.from(r).sort()}),pe=f(()=>{if(e(P))return[];const t=new Set;return e(ce).forEach(r=>{r.forEach(o=>{t.add(o.carrier)})}),Array.from(t).sort()}),ge=f(()=>{if(e(P))return[];const t=new Set;return e(ue).forEach(r=>{r.forEach(o=>{t.add(o.carrier)})}),Array.from(t).sort()}),Te=f(()=>{if(e(P))return[];const t=e(i),r=new Set;return t.forEach(o=>{Object.keys(o.detail.edges).forEach(n=>{r.add(n)}),o.detail.system.set_nodes.forEach(n=>{r.add(n)})}),Array.from(r).sort()});ve(()=>{s(se,e(Te),!0)}),ve(()=>{s(D,e(U).map(t=>t.toString()),!0)}),Q(()=>e(ee),()=>!!e(i)[0]&&!!e(W)&&!!e(X),()=>$e,()=>xe,t=>s(z,t,!0),t=>$e=t,t=>xe=t),Q(()=>e(te),()=>!!e(i)[0]&&e(W).length>0&&e(X).length>0,()=>Ae,()=>be,t=>s(N,t,!0),t=>Ae=t,t=>be=t),Q(()=>e(re),()=>!!e(i)[0]&&e(W).length>0&&e(X).length>0,()=>ke,()=>Ce,t=>s(Y,t,!0),t=>ke=t,t=>Ce=t),Q(()=>e(pe),()=>!!e(i)[0]&&e(ce).length>0,()=>Be,()=>Se,t=>s(M,t,!0),t=>Be=t,t=>Se=t),Q(()=>e(ge),()=>!!e(i)[0]&&e(ue).length>0,()=>Me,()=>ye,t=>s(R,t,!0),t=>Me=t,t=>ye=t),Q(()=>e(Te),()=>!!e(i)[0],()=>Re,()=>null,t=>s(se,t,!0),t=>Re=t,()=>{}),Q(()=>e(U).map(t=>t.toString()),()=>!!e(i)[0],()=>Fe,()=>null,t=>s(D,t,!0),t=>Fe=t,()=>{}),ut(()=>{Object.entries(j).forEach(([t,r])=>{r.show=ze(t,r.show),r.subdivision=ze(t+"_sub",r.subdivision)}),xe=ie("tran"),be=ie("conv"),Ce=ie("stor"),Se=ie("cost"),ye=ie("demand")}),ve(()=>{e(z),e(N),e(Y),e(M),e(R),Object.values(j).forEach(t=>{t.show,t.subdivision}),ft().then(()=>{let t={tran:e(z).map(r=>e(ee).indexOf(r)).join("~"),conv:e(N).map(r=>e(te).indexOf(r)).join("~"),stor:e(Y).map(r=>e(re).indexOf(r)).join("~"),cost:e(M).map(r=>e(pe).indexOf(r)).join("~"),demand:e(R).map(r=>e(ge).indexOf(r)).join("~")};Object.entries(j).forEach(([r,o])=>{t[r]=o.show?"1":"0",t[r+"_sub"]=o.subdivision?"1":"0"}),vt(t)})});function rt(){ot()}async function ot(){if(e(i).some(o=>o===null))return;s(fe,!0);const t=e(i),r=await Promise.all(t.map(o=>Pt(o.solution_name,["cost_capex_yearly","cost_opex_yearly","cost_carbon_emissions_total","cost_carrier","cost_shed_demand"].map(n=>At(n,o?.version)),o.scenario_name)));s(W,r.map(o=>o.cost_capex_yearly?.data||[]),!0),s(X,r.map(o=>o.cost_opex_yearly?.data||[]),!0),s(_e,r.map(o=>o.cost_carbon_emissions_total?.data||[]),!0),s(ce,r.map(o=>o.cost_carrier?.data||[]),!0),s(ue,r.map(o=>o.cost_shed_demand?.data||[]),!0),r[0].unit?.data&&s(de,Object.fromEntries(r[0].unit.data.map(o=>[o.technology,o[0]||o.units])),!0),s(fe,!1)}let Oe=c(g([]));function at(){s(Oe,[...e(N).concat(e(Y)).concat(e(z)).flatMap(t=>[t+De,t+Pe]),...e(M),...e(R)],!0)}const st=Object.values(j).filter(t=>t.label).map(t=>t.label);let nt=kt(at,100);ve(()=>{e(N),e(Y),e(z),e(M),e(R),nt()});let lt=f(()=>{if(e(Oe).length==0)return[[],[]];jt(),Ct();const t=[];return[e(i).flatMap((o,n)=>{if(o===null)return[];const I={capex:oe.fromRows(e(W)[n]).mapIndex(a=>({location:a.location,[x]:a.technology+De})),opex:oe.fromRows(e(X)[n]).mapIndex(a=>({location:a.location,[x]:a.technology+Pe})),carrier:oe.fromRows(e(ce)[n]).filter(a=>e(M).includes(a.index.carrier)).mapIndex(a=>({location:a.node,[x]:a.carrier})),shed_demand:oe.fromRows(e(ue)[n]).filter(a=>e(R).includes(a.index.carrier)).mapIndex(a=>({location:a.node,[x]:a.carrier}))};let w=oe.concatenate(Object.entries(I).map(([a,h])=>{if(!j[a].show)return null;const u=h.filterByCriteria({location:e(se),[x]:e(Oe).concat(st)}).filterDataByIndex(e(D).map(q=>e(U).indexOf(Number(q))));return j[a].subdivision?u:u.groupBy(["location"]).mapIndex(q=>({location:q.location,[x]:j[a].label||""}))}));e(ae)==x?w=w.groupBy(["location"]):w=w.groupBy([x]);const A=n>0?xt():void 0,V=St(o.solution_name,o.scenario_name);t.push(yt(V,A));const v=w.toArray().map(a=>{const h=e(ae)==x?a.index.location:a.index[x],u=qe(h);return{label:h,data:a.data,borderColor:u,backgroundColor:A!==void 0?Ie.draw(A,me(u)):me(u),stack:V}});if(e(_e)[n].length===1&&j.carbon_emission.show){const a=oe.fromRows(e(_e)[n]).filterDataByIndex(e(D).map(u=>e(U).indexOf(Number(u)))),h=qe("Total Carbon Costs");v.push({data:a.get(0).data,label:"Total Carbon Costs",borderColor:h,backgroundColor:A!==void 0?Ie.draw(A,me(h)):me(h),stack:V})}return v}),t]}),Ne=f(()=>gt(e(lt),2)),Ye=f(()=>e(Ne)[0]),it=f(()=>e(Ne)[1]);Dt(Ge,{parentTitle:"The Transition Pathway",pageTitle:"Costs",filters:n=>{var I=Ut(),w=B(I);he(w,{title:"Solution Selection",children:(v,a)=>{{let h=f(()=>e(fe)||e(ne));bt(v,{onSelected:rt,get disabled(){return e(h)},get solutions(){return e(i)},set solutions(u){s(i,u,!0)},get years(){return e(U)},set years(u){s(U,u,!0)},get loading(){return e(ne)},set loading(u){s(ne,u,!0)}})}}});var A=y(w,2);{var V=v=>{var a=Ft(),h=B(a);he(h,{title:"Cost Selection",children:(C,G)=>{var T=le(),k=B(T);ht(k,17,()=>Object.values(j),mt,(F,d,$)=>{var O=Bt(),p=Ee(O),E=Ee(p);Ve(E,{get label(){return e(d).title},get value(){return e(d).show},set value(J){e(d).show=J}}),Le(p);var _=y(p,2);{var H=J=>{var l=$t(),S=Ee(l);Ve(S,{label:"with Subdivision",get value(){return e(d).subdivision},set value(ct){e(d).subdivision=ct}}),Le(l),m(J,l)};b(_,J=>{e(d).show&&e(d).showSubdivision&&J(H)})}Le(O),m(F,O)}),m(C,T)}});var u=y(h,2);he(u,{title:"Technology Selection",children:(C,G)=>{var T=Mt(),k=y(B(T),2);{var F=l=>{K(l,{get options(){return e(ee)},label:"Transport",get value(){return e(z)},set value(S){s(z,S,!0)}})};b(k,l=>{e(ee).length>0&&l(F)})}var d=y(k,2);{var $=l=>{K(l,{get options(){return e(re)},label:"Storage",get value(){return e(Y)},set value(S){s(Y,S,!0)}})};b(d,l=>{e(re).length>0&&l($)})}var O=y(d,2);{var p=l=>{K(l,{get options(){return e(te)},label:"Conversion",get value(){return e(N)},set value(S){s(N,S,!0)}})};b(O,l=>{e(te).length>0&&l(p)})}var E=y(O,2);{var _=l=>{K(l,{get options(){return e(pe)},label:"Cost of Carrier",get value(){return e(M)},set value(S){s(M,S,!0)}})};b(E,l=>{e(pe).length>0&&l(_)})}var H=y(E,2);{var J=l=>{K(l,{get options(){return e(ge)},label:"Shed Demand",get value(){return e(R)},set value(S){s(R,S,!0)}})};b(H,l=>{e(ge).length>0&&l(J)})}m(C,T)}});var q=y(u,2);he(q,{title:"Data Selection",children:(C,G)=>{var T=Rt(),k=B(T);Ot(k,{get options(){return je},label:"Aggregation",get value(){return e(ae)},set value(p){s(ae,p,!0)}});var F=y(k,2);{var d=p=>{K(p,{get options(){return e(Te)},label:"Locations",get value(){return e(se)},set value(E){s(se,E,!0)}})};b(F,p=>{e(ae)==je[1]&&p(d)})}var $=y(F,2);{var O=p=>{{let E=f(()=>e(U).map(_=>_.toString()));K(p,{get options(){return e(E)},label:"Years",get value(){return e(D)},set value(_){s(D,_,!0)}})}};b($,p=>{e(D)&&p(O)})}m(C,T)}}),m(v,a)};b(A,v=>{!e(ne)&&!e(P)&&v(V)})}m(n,I)},buttons:n=>{Et(n,{get chart(){return e(we)},downloadable:!0})},mainContent:n=>{var I=le(),w=B(I);{var A=v=>{var a=Nt();m(v,a)},V=v=>{var a=le(),h=B(a);{var u=C=>{var G=Yt();m(C,G)},q=C=>{var G=le(),T=B(G);{var k=d=>{var $=zt();m(d,$)},F=d=>{var $=le(),O=B($);{var p=_=>{var H=It();m(_,H)},E=_=>{_t(Lt(_,{type:"bar",get labels(){return e(tt)},get datasets(){return e(Ye)},get options(){return e(Ze)},get pluginOptions(){return et},get plotName(){return e(Xe)},get patterns(){return e(it)},get generateLabels(){return Tt},get onClickLegend(){return wt}}),H=>s(we,H,!0),()=>e(we))};b(O,_=>{e(Ye).length==0?_(p):_(E,!1)},!0)}m(d,$)};b(T,d=>{e(D).length==0?d(k):d(F,!1)},!0)}m(C,G)};b(h,C=>{e(P)?C(u):C(q,!1)},!0)}m(v,a)};b(w,v=>{e(ne)||e(fe)?v(A):v(V,!1)})}m(n,I)}}),pt()}export{nr as component};
