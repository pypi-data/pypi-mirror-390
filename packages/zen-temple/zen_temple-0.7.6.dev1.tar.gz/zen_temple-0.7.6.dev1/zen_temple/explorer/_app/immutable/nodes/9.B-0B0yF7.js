import"../chunks/DsnmJJEf.js";import{o as qe}from"../chunks/Dv-zU6kM.js";import{p as Ge,e as c,g as z,u as ae,h as e,m as l,j as He,i as a,k as Se,c as Je,f as x,a as S,s as M,b as s,n as W,l as Ke}from"../chunks/wiODf3u9.js";import{i as y}from"../chunks/BanhNaiI.js";import{b as Qe}from"../chunks/CdVljubK.js";import{M as We,r as Xe,g as Ze,n as et,c as tt,p as rt,o as at,a as ot}from"../chunks/BUiXS9lV.js";import{M as ge}from"../chunks/BpW8IzjD.js";import{R as xe}from"../chunks/pdbWY_Kb.js";import{C as nt,a as lt}from"../chunks/Bv-Vpr2t.js";import{D as st,F as ve,e as it,b as fe,r as ut,n as ct,f as Te}from"../chunks/CrYm4EAs.js";import{T as dt}from"../chunks/DCzEWrZq.js";import{u as gt,g as se}from"../chunks/CuRYjgcn.js";import{E as vt}from"../chunks/Dmw0JB4Z.js";var ft=x("<!> <!>",1),pt=x("<!> <!> <!>",1),mt=x("<!> <!> <!> <!>",1),ht=x("<!> <!>",1),_t=x("<!> <!>",1),yt=x('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),bt=x('<div class="text-center">No technologies with this selection.</div>'),Ct=x('<div class="text-center">No carriers with this selection.</div>'),St=x('<div class="text-center">No solution selected.</div>'),xt=x('<div class="text-center">No locations with this selection.</div>'),Tt=x('<div class="text-center">No data with this selection.</div>');function Ft(we,ke){Ge(ke,!0);let w=c(z([]));const Ne=["capacity","capacity_addition"],Pe={capacity:"Capacity",capacity_addition:"Capacity Addition"},Ee=["conversion","storage","transport"],Le=["energy","power"],$e=[{label:"Node",value:"node"},{label:"Technology",value:"technology"}];let X=c(z([])),f=c(z([null])),m=c("capacity"),d=c("conversion"),L=c("energy"),i=c(null),Y=c("technology"),$=c(!1),I=c(z([])),q=c(z([])),G=c(z([])),oe=null,k=c(!1),D=c(!1),Z=l(()=>e(f).some(r=>r===null)),pe=c(z({})),me=l(()=>{const r=e(d)=="storage"?e(L):"power";return e(pe)[e(A)[0]+"_"+r]||""}),ie=c(void 0),De=l(()=>e(G).map(r=>r.toString())),Ue=l(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`${Pe[e(m)]}`+(e($)?"":` [${e(me)}]`)},min:e($)?0:void 0,max:e($)?1:void 0}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));const Ae={tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${r.formattedValue}`+(e($)?"":` ${e(me)}`),title:r=>{if(r.length>0)return`${r[0].label} - ${r[0].dataset.stack}`}}}};let Be=l(()=>e(f)[0]==null?"":[e(f)[0].solution_name.split(".").pop(),e(f)[0].scenario_name,e(m),e(d),e(i)].join("_")),he=l(()=>{if(e(Z)||e(d)===null)return[];const r={conversion:"set_conversion_technologies",storage:"set_storage_technologies",transport:"set_transport_technologies"}[e(d)];return e(f).map(g=>g.detail.system[r]||[])}),U=l(()=>{if(e(w).length===0||e(Z))return[];const r=new Set;return e(f).forEach((g,n)=>{g!==null&&(e(w)[n]??[]).forEach(t=>{(e(he)[n]??[]).includes(t.technology)&&r.add(g.detail.reference_carrier[t.technology])})}),Array.from(r).sort()}),A=l(()=>{if(e(d)===null||e(i)===null||e(Z))return[];const r=new Set;return e(f).forEach((g,n)=>{(e(he)[n]??[]).forEach(t=>{g.detail.reference_carrier[t]===e(i)&&r.add(t)})}),Array.from(r).sort()}),H=l(()=>{if(e(Z))return[];const r=new Set;return e(w).forEach(g=>{g.forEach(n=>{e(A).includes(n.technology)&&r.add(n.location)})}),Array.from(r).sort()});ae(()=>{e(U),He(()=>{(e(i)==null||!e(U).includes(e(i)))&&(oe!=null&&e(U).includes(oe)?a(i,oe,!0):a(i,e(U).length>0?e(U)[0]:null,!0))})}),ae(()=>{e(i)!=null&&(oe=e(i))}),ae(()=>{a(q,e(A),!0)}),ae(()=>{a(I,e(H),!0)}),qe(()=>{a(m,se("var")||e(m),!0),a(d,se("tech")||e(d),!0),a(L,se("stor")||e(L),!0),a(i,se("car")||e(i),!0)}),ae(()=>{e(m),e(d),e(L),e(i),Se().then(()=>{gt({var:e(m),tech:e(d),stor:e(L),car:e(i)})})});function ne(){a(Y,"node"),a($,!1),a(I,e(H),!0),a(q,e(A),!0),a(G,e(X).map(r=>r.toString()),!0)}async function Oe(){await Se(),ne(),await ye()}async function Me(){ne(),await ye()}function _e(){ne()}function Fe(){ne()}async function ye(){if(e(m)===null||e(Z)){a(w,[],!0);return}a(D,!0);const r=e(f),g=e(m),n=await Promise.all(r.map(t=>it(t.solution_name,[g],t.scenario_name)));a(w,n.map(t=>t[g]?.data).filter(t=>t!==void 0),!0),n[0]?.unit?.data&&a(pe,Object.fromEntries(n[0].unit.data.map(t=>[t.technology+"_"+t.capacity_type,t[0]||t.units])),!0),a(D,!1)}function Re(r,g,n){const t={},h=["capacity_type"];e(Y)=="technology"?(t.technology=e(q),t.location=e(H),h.push("location")):(t.location=e(I),t.technology=e(A),h.push("technology")),e(d)=="storage"&&(t.capacity_type=[e(L)]);let b=vt.fromRows(r).filterByCriteria(t).filterDataByIndex(e(G).map(N=>e(X).indexOf(Number(N)))).groupBy(h);return e($)&&(b=b.normalize()),b.toArray().map(N=>{const J=e(Y)==="technology"?N.index.location:N.index.technology,u=ct(J);return{label:J,data:N.data,borderColor:u,backgroundColor:n!==void 0?rt.draw(n,Te(u)):Te(u),stack:g}})}let Ve=l(()=>{if(e(m)==null||e(I).length==0||e(G).length==0||e(q).length==0||e(w).length===0)return[[],[]];ut(),Xe();const r=[];return[e(f).flatMap((n,t)=>{if(n===null||!e(w)[t])return[];const h=Ze(n.solution_name,n.scenario_name),b=t>0?et():void 0;return r.push(tt(h,b)),Re(e(w)[t],h,b)}),r]}),be=l(()=>Ke(e(Ve),2)),Ce=l(()=>e(be)[0]),je=l(()=>e(be)[1]);st(we,{parentTitle:"The Transition Pathway",pageTitle:"Capacity",filters:t=>{var h=_t(),b=S(h);ve(b,{title:"Solution Selection",children:(u,B)=>{{let K=l(()=>e(D)||e(k));We(u,{onSelected:Oe,get disabled(){return e(K)},get solutions(){return e(f)},set solutions(P){a(f,P,!0)},get years(){return e(X)},set years(P){a(X,P,!0)},get loading(){return e(k)},set loading(P){a(k,P,!0)}})}}});var N=M(b,2);{var J=u=>{var B=ht(),K=S(B);ve(K,{title:"Variable Selection",children:(_,F)=>{var ee=pt(),R=S(ee);{let p=l(()=>e(D)||e(k));fe(R,{label:"Variable",get options(){return Ne},get disabled(){return e(p)},onUpdate:Me,get value(){return e(m)},set value(T){a(m,T,!0)}})}var V=M(R,2);{var C=p=>{var T=ft(),o=S(T);{let j=l(()=>e(D)||e(k));fe(o,{label:"Technology Type",get options(){return Ee},get disabled(){return e(j)},onUpdate:_e,get value(){return e(d)},set value(re){a(d,re,!0)}})}var v=M(o,2);{var ce=j=>{{let re=l(()=>e(D)||e(k));xe(j,{label:"Storage Type",get options(){return Le},onUpdate:_e,get disabled(){return e(re)},get value(){return e(L)},set value(O){a(L,O,!0)}})}};y(v,j=>{e(d)=="storage"&&j(ce)})}s(p,T)};y(V,p=>{e(m)!=null&&p(C)})}var E=M(V,2);{var te=p=>{{let T=l(()=>e(D)||e(k));fe(p,{label:"Carrier",get options(){return e(U)},get disabled(){return e(T)},onUpdate:Fe,get value(){return e(i)},set value(o){a(i,o,!0)}})}};y(E,p=>{e(d)!=null&&e(U).length>0&&p(te)})}s(_,ee)}});var P=M(K,2);{var ue=_=>{ve(_,{title:"Data Selection",children:(F,ee)=>{var R=mt(),V=S(R);xe(V,{label:"Aggregation",get options(){return $e},get value(){return e(Y)},set value(o){a(Y,o,!0)}});var C=M(V,2);dt(C,{label:"Normalization",get value(){return e($)},set value(o){a($,o,!0)}});var E=M(C,2);{var te=o=>{ge(o,{label:"Technologies",get options(){return e(A)},get value(){return e(q)},set value(v){a(q,v,!0)}})},p=o=>{ge(o,{label:"Nodes",get options(){return e(H)},get value(){return e(I)},set value(v){a(I,v,!0)}})};y(E,o=>{e(Y)=="technology"?o(te):o(p,!1)})}var T=M(E,2);{let o=l(()=>e(X).map(v=>v.toString()));ge(T,{label:"Years",get options(){return e(o)},get value(){return e(G)},set value(v){a(G,v,!0)}})}s(F,R)}})};y(P,_=>{e(w)&&e(d)&&e(i)&&e(A).length>0&&e(H).length>0&&_(ue)})}s(u,B)};y(N,u=>{!e(k)&&e(f)[0]&&u(J)})}s(t,h)},buttons:t=>{nt(t,{get chart(){return e(ie)},downloadable:!0})},mainContent:t=>{var h=W(),b=S(h);{var N=u=>{var B=yt();s(u,B)},J=u=>{var B=W(),K=S(B);{var P=_=>{var F=bt();s(_,F)},ue=_=>{var F=W(),ee=S(F);{var R=C=>{var E=Ct();s(C,E)},V=C=>{var E=W(),te=S(E);{var p=o=>{var v=St();s(o,v)},T=o=>{var v=W(),ce=S(v);{var j=O=>{var le=xt();s(O,le)},re=O=>{var le=W(),ze=S(le);{var Ye=Q=>{var de=Tt();s(Q,de)},Ie=Q=>{Qe(lt(Q,{type:"bar",get datasets(){return e(Ce)},get labels(){return e(De)},get options(){return e(Ue)},get pluginOptions(){return Ae},get plotName(){return e(Be)},get patterns(){return e(je)},get generateLabels(){return ot},get onClickLegend(){return at}}),de=>a(ie,de,!0),()=>e(ie))};y(ze,Q=>{e(Ce).length==0?Q(Ye):Q(Ie,!1)},!0)}s(O,le)};y(ce,O=>{e(H).length==0?O(j):O(re,!1)},!0)}s(o,v)};y(te,o=>{e(f)[0]==null?o(p):o(T,!1)},!0)}s(C,E)};y(ee,C=>{e(U).length==0?C(R):C(V,!1)},!0)}s(_,F)};y(K,_=>{e(A).length==0?_(P):_(ue,!1)},!0)}s(u,B)};y(b,u=>{e(k)||e(D)?u(N):u(J,!1)})}s(t,h)}}),Je()}export{Ft as component};
