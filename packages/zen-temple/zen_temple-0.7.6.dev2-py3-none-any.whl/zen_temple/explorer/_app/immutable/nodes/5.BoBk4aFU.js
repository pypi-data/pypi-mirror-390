import"../chunks/DsnmJJEf.js";import{o as Ge}from"../chunks/Dv-zU6kM.js";import{p as Je,e as n,g as ge,u as N,h as e,i as t,j as I,m as _,k as Le,o as Qe,c as Xe,f as S,a as x,s as B,b as s,n as K}from"../chunks/wiODf3u9.js";import{i as P}from"../chunks/BanhNaiI.js";import{b as Fe}from"../chunks/CdVljubK.js";import{T as et}from"../chunks/DExI7AxJ.js";import{c as tt,D as rt,n as at,d as fe,r as lt,F as ve,S as ot,b as me}from"../chunks/hzu92_2X.js";import{M as De}from"../chunks/3Ej4NDO6.js";import{C as nt,a as Pe}from"../chunks/DLlwhTTU.js";import{u as st,g as pe}from"../chunks/DPXpTqfB.js";var it=S("<!> <!> <!>",1),ut=S("<!> <!> <!>",1),gt=S("<!> <!>",1),dt=S("<!> <!>",1),_t=S('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ct=S('<div class="text-center">No technologies with this selection.</div>'),ft=S('<div class="text-center">No carriers with this selection.</div>'),vt=S('<div class="text-center">No solution selected.</div>'),mt=S('<div class="text-center">No locations with this selection.</div>'),pt=S('<div class="text-center">No data available for this selection.</div>'),ht=S("<!> <!>",1);function Ft(Te,je){Je(je,!0);let h=null,X=null,ee=null,te=null,re=null,ae=n(0),he=n(ge({})),T=n(ge([]));const Me=["Hourly","Daily","Weekly","Monthly"];let o=n(null),c=n(null),b=n(""),j=n("Hourly"),M=n(!0),L=n(ge([])),F=n(ge([])),O=n(!1),D=n(!1),Z=n(void 0),le=n(void 0),be=_(()=>e(H).length>0?e(he)[e(H)[0]]:""),we=_(()=>{if(!e(o)||!e(o).solution_name)return"";let l=e(o).solution_name.split(".");return[l[l.length-1],e(o).scenario_name,"storage_level",e(c)].join("_")}),Oe=_(()=>e(we)+"_flows"),Ae=_(()=>xe("Storage Level")),Ee=_(()=>xe("Storage Flow")),q=n(null),ye=n(0);N(()=>{e(o)?.detail?.system.unaggregated_time_steps_per_year!==void 0&&t(ye,e(o).detail.system.unaggregated_time_steps_per_year,!0)}),N(()=>{e(ye),I(()=>{t(q,null)})});function xe(l){return{animation:!1,normalized:!0,parsing:!1,elements:{point:{radius:0},line:{borderWidth:1}},responsive:!0,scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:r=>Number(r).toFixed(0)},min:0,max:(e(o)?.detail?.system.unaggregated_time_steps_per_year||0)-1},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`${l} [${e(be)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}const Se={zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:l=>`${l.dataset.label}: ${l.formattedValue} ${e(be)}`}}};let G=_(()=>(e(ae),h?fe(h.map(l=>l.index.node)).sort():[])),A=_(()=>{if(e(ae),!h||!e(o))return[];let l=Array.from(h.map(r=>r.index.technology));return fe(h.filter(r=>l.includes(r.index.technology)).map(r=>e(o).detail.reference_carrier[r.index.technology]))}),H=_(()=>(e(ae),!h||!e(o)||e(A).length===0?[]:fe(h.map(r=>r.index.technology)).filter(r=>e(o).detail.reference_carrier[r]==e(c))));N(()=>{e(H),I(()=>{t(L,e(H),!0)})}),N(()=>{e(G),I(()=>{t(F,e(G),!0)})}),N(()=>{e(A),I(()=>{e(A).length>0&&(!e(c)||!e(A).includes(e(c)))&&(t(c,e(A)[0],!0),ne())})}),N(()=>{e(T),I(()=>{e(T).length>0&&(!e(b)||!e(T).includes(Number(e(b))))&&(t(b,e(T)[0].toString(),!0),ne())})}),N(()=>{e(c),e(M),e(L),e(F),I(ne)}),Ge(()=>{t(c,pe("car")||e(c),!0),t(b,pe("year")||e(b),!0),t(j,pe("window")||e(j),!0)}),N(()=>{e(b),e(c),e(j),Le().then(()=>{st({year:e(b),car:e(c),window:e(j)})})}),N(()=>{Re()});async function Re(){if(e(o)===null||!e(b))return;t(D,!0);let l={Daily:24,Weekly:168,Monthly:720}[e(j)]||1;const r=await tt(e(o).solution_name,["storage_level","flow_storage_charge","flow_storage_discharge","flow_storage_spillage","flow_storage_inflow"],e(o).scenario_name,"storage_level",Number(e(b)),l);h=r.components.storage_level||null,X=r.components.flow_storage_charge||null,ee=r.components.flow_storage_discharge||null,te=r.components.flow_storage_spillage||null,re=r.components.flow_storage_inflow||null,Qe(ae),r.unit?.data&&t(he,Object.fromEntries(r.unit.data.map(C=>[C.technology,C[0]||C.units])),!0),t(D,!1),ne()}let Ce=_(()=>Array.from({length:e(ke)},(l,r)=>r.toString())),oe=[],de=[],_e=n(0),We=n(0),ke=n(0);function $e(){return e(F).length==0||e(L).length==0||!h||!X||!ee||!re||!te?[]:ze(h,{technology:e(L),node:e(F)},e(M)?["technology"]:[],e(M)?void 0:()=>({label:"Storage Level",borderColor:"rgb(0, 0, 0)",backgroundColor:"rgba(0, 0, 0, 0.2)"}))}function Be(){return e(o)===null||e(D)||e(F).length==0||e(L).length==0||!h||!X||!ee||!re||!te?[]:[{data:X,label_suffix:"_charge",label_aggregated:"Flow Storage Charge",negate:!1,color:"rgb(54, 162, 235)"},{data:ee,label_suffix:"_discharge",label_aggregated:"Flow Storage Discharge",negate:!0,color:"rgb(255, 99, 132)"},{data:re,label_suffix:"_inflow",label_aggregated:"Flow Storage Inflow",negate:!1,color:"rgb(75, 192, 192)"},{data:te,label_suffix:"_spillage",label_aggregated:"Flow Storage Spillage",negate:!0,color:"rgb(255, 99, 132)"}].flatMap(({data:l,label_suffix:r,label_aggregated:C,negate:z,color:k})=>ze(l,{technology:e(L),node:e(F)},e(M)?["technology"]:[],e(M)?i=>({label:i.index.column+r}):()=>({label:C,borderColor:k,backgroundColor:k}),i=>z?-i:i))}async function ne(){lt(),oe=$e(),de=Be(),t(_e,oe.length,!0),t(We,de.length,!0),t(ke,e(_e)>0?oe[0].data.length:0,!0),await Le(),e(Z)&&e(Z).updateChart(oe),e(le)&&e(le).updateChart(de)}function ze(l,r,C,z=()=>({}),k=i=>i){let i=l.filter(d=>Object.entries(r).every(([g,a])=>a.includes(d.index[g]))).map(d=>({index:d.index,data:d.data.map(k)}));if(i.length===0)return[];if(C){const d=Array.isArray(C)?C:[0],g={};i.forEach(a=>{const u=d.map(v=>a.index[v]).join("_");g[u]||(g[u]=new Array(a.data.length).fill(0)),a.data.forEach((v,w)=>{g[u][w]+=v})}),i=Object.entries(g).map(([a,u])=>({index:{column:a},data:u}))}return i.map(d=>{const g=z(d),a=g.borderColor||at();return{...g,data:d.data.map((u,v)=>({x:v,y:u})),label:g.label||d.index.column,type:"line",fill:"origin",stepped:!0,borderColor:a,backgroundColor:g.backgroundColor||a}})}rt(Te,{parentTitle:"The Energy Balance",pageTitle:"Storage",filters:z=>{var k=dt(),i=x(k);ve(i,{title:"Solution Selection",children:(a,u)=>{{let v=_(()=>e(D)||e(O));ot(a,{get disabled(){return e(v)},get selected_solution(){return e(o)},set selected_solution(w){t(o,w,!0)},get loading(){return e(O)},set loading(w){t(O,w,!0)},get years(){return e(T)},set years(w){t(T,w,!0)}})}}});var d=B(i,2);{var g=a=>{var u=gt(),v=x(u);ve(v,{title:"Variable Selection",children:(m,E)=>{var J=it(),R=x(J);{let p=_(()=>e(T).map(Q=>Q.toString())),f=_(()=>e(D)||e(O));me(R,{get options(){return e(p)},label:"Year",get disabled(){return e(f)},get value(){return e(b)},set value(Q){t(b,Q,!0)}})}var W=B(R,2);{let p=_(()=>e(D)||e(O));me(W,{get options(){return e(A)},label:"Carrier",get disabled(){return e(p)},get value(){return e(c)},set value(f){t(c,f,!0)}})}var y=B(W,2);{let p=_(()=>e(D)||e(O));me(y,{get options(){return Me},label:"Smoothing Window Size",get disabled(){return e(p)},get value(){return e(j)},set value(f){t(j,f,!0)}})}s(m,J)}});var w=B(v,2);{var ce=m=>{ve(m,{title:"Data Selection",children:(E,J)=>{var R=ut(),W=x(R);et(W,{label:"Technology Subdivision",get value(){return e(M)},set value(f){t(M,f,!0)}});var y=B(W,2);De(y,{get options(){return e(H)},label:"Technologies",get value(){return e(L)},set value(f){t(L,f,!0)}});var p=B(y,2);De(p,{get options(){return e(G)},label:"Nodes",get value(){return e(F)},set value(f){t(F,f,!0)}}),s(E,R)}})};P(w,m=>{e(c)&&e(G).length>0&&m(ce)})}s(a,u)};P(d,a=>{e(o)&&a(g)})}s(z,k)},buttons:z=>{nt(z,{get chart(){return e(Z)},downloadable:!0,zoomable:!0})},mainContent:z=>{var k=K(),i=x(k);{var d=a=>{var u=_t();s(a,u)},g=a=>{var u=K(),v=x(u);{var w=m=>{var E=ct();s(m,E)},ce=m=>{var E=K(),J=x(E);{var R=y=>{var p=ft();s(y,p)},W=y=>{var p=K(),f=x(p);{var Q=U=>{var se=vt();s(U,se)},He=U=>{var se=K(),Ue=x(se);{var Ve=V=>{var ie=mt();s(V,ie)},Ye=V=>{var ie=K(),Ie=x(ie);{var Ke=Y=>{var ue=pt();s(Y,ue)},Ze=Y=>{var ue=ht(),Ne=x(ue);Fe(Pe(Ne,{id:"level_chart",type:"line",get labels(){return e(Ce)},datasets:[],get options(){return e(Ae)},get pluginOptions(){return Se},get plotName(){return e(we)},zoom:!0,get zoomLevel(){return e(q)},set zoomLevel($){t(q,$,!0)}}),$=>t(Z,$,!0),()=>e(Z));var qe=B(Ne,2);Fe(Pe(qe,{id:"flow_chart",type:"line",get labels(){return e(Ce)},datasets:[],get options(){return e(Ee)},get pluginOptions(){return Se},get plotName(){return e(Oe)},zoom:!0,get zoomLevel(){return e(q)},set zoomLevel($){t(q,$,!0)}}),$=>t(le,$,!0),()=>e(le)),s(Y,ue)};P(Ie,Y=>{e(_e)==0?Y(Ke):Y(Ze,!1)},!0)}s(V,ie)};P(Ue,V=>{e(G).length==0?V(Ve):V(Ye,!1)},!0)}s(U,se)};P(f,U=>{e(o)==null?U(Q):U(He,!1)},!0)}s(y,p)};P(J,y=>{e(A).length==0?y(R):y(W,!1)},!0)}s(m,E)};P(v,m=>{e(H).length==0?m(w):m(ce,!1)},!0)}s(a,u)};P(i,a=>{e(O)||e(D)?a(d):a(g,!1)})}s(z,k)}}),Xe()}export{Ft as component};
