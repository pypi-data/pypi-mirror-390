"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[2124],{42124:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u,triggerAstStatusCheck:()=>d});var s=r(65043),n=r(89073),o=r(94828),i=r(57692);var l=r(8347),a=r(70579);let c=null;const d=()=>{window.dispatchEvent(new CustomEvent("ast-config-changed"))},f=async()=>{if(c)return console.debug("Reusing existing AST status request"),c;c=(async()=>{try{const e=await fetch("/api/ast/status");if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return await e.json()}catch(e){return console.error("Error fetching AST status:",e),{is_indexing:!1,completion_percentage:0,is_complete:!1,indexed_files:0,total_files:0,elapsed_seconds:null,error:e instanceof Error?e.message:"Unknown error"}}})();const e=await c;return c=null,e},u=()=>{const[e,t]=(0,s.useState)(null),[r,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),{isDarkMode:p}=(0,l.D)();if((0,s.useEffect)(()=>{if(!new URL(window.location.href).searchParams.has("ast")&&"true"!==localStorage.getItem("ZIYA_AST_ENABLED")&&!document.querySelector("[data-ast-enabled]"))return void console.debug("AST not enabled, skipping status checks");const e=new AbortController;let r=null,s=!0;const n=async()=>{if(!e.signal.aborted&&s)try{const o=await f();if(e.signal.aborted||!s)return;s&&(t(o),(o.is_indexing||o.is_complete)&&u(!0),(o.is_indexing||o.error)&&c(!0),o.is_complete&&!o.error&&setTimeout(()=>{s&&c(!1)},5e3),o.is_indexing&&!o.is_complete&&(r=window.setTimeout(n,3e3)))}catch(o){if(o instanceof Error&&"AbortError"===o.name)return void console.debug("AST status check aborted");console.error("Error checking AST status:",o),d&&s&&(r=window.setTimeout(n,3e3))}};n();const o=()=>{"visible"===document.visibilityState?!r&&s&&n():r&&(window.clearTimeout(r),r=null)};document.addEventListener("visibilitychange",o);const i=()=>{u(!1),n()};return window.addEventListener("ast-config-changed",i),()=>{s=!1,e.abort(),r&&window.clearTimeout(r),document.removeEventListener("visibilitychange",o),window.removeEventListener("ast-config-changed",i)}},[d]),!e||!r)return null;if(e.error)return d?(0,a.jsx)(n.A,{className:"ast-status-error",style:{position:"fixed",bottom:"10px",right:"10px",width:"300px",backgroundColor:p?"#2a1f1f":"#fff1f0",borderColor:p?"#a61d24":"#ffa39e",color:p?"#ff7875":void 0},children:(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"AST Indexing Error"}),(0,a.jsx)("p",{children:e.error})]})}):null;if(e.is_indexing&&!e.is_complete){const t=e.elapsed_seconds?` (${(e=>{if(!e)return"";if(e<60)return`${Math.round(e)}s`;if(e<3600)return`${Math.floor(e/60)}m ${Math.round(e%60)}s`;return`${Math.floor(e/3600)}h ${Math.floor(e%3600/60)}m`})(e.elapsed_seconds)})`:"";return(0,a.jsx)(n.A,{className:"ast-status-indicator",style:{position:"fixed",bottom:"10px",right:"10px",width:"300px",backgroundColor:p?"#141414":"#ffffff",borderColor:p?"#303030":"#d9d9d9",color:p?"#ffffff":void 0},children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,a.jsx)("strong",{children:"AST Indexing"}),(0,a.jsxs)("span",{children:[e.completion_percentage,"%",t]})]}),(0,a.jsx)(o.A,{title:`${e.indexed_files}/${e.total_files} files processed`,children:(0,a.jsx)(i.A,{percent:e.completion_percentage,size:"small",status:"active",showInfo:!1})}),(0,a.jsxs)("div",{style:{fontSize:"12px",color:"#8c8c8c",marginTop:"4px"},children:[e.indexed_files,"/",e.total_files," files processed"]})]})})}return e.is_complete?(0,a.jsx)(n.A,{className:"ast-status-complete",style:{position:"fixed",bottom:"10px",right:"10px",width:"300px",backgroundColor:p?"#162312":"#f6ffed",borderColor:p?"#389e0d":"#b7eb8f",color:p?"#ffffff":void 0},children:(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"AST Indexing Complete"}),(0,a.jsxs)("div",{style:{fontSize:"12px",color:"#8c8c8c",marginTop:"4px"},children:[e.indexed_files," files indexed"]})]})}):null}}}]);
//# sourceMappingURL=2124.a3836c9e.chunk.js.map