<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="MRIQC" />
<title>FreeSurfer: Group Report</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style type="text/css">
body {
  font-family: helvetica;
  padding: 50px 10px 10px;
}

.section { margin: 20px 0; }
.metric-group { margin: 15px 0; }
.quality-summary { background: #f5f5f5; padding: 15px; border-radius: 5px; }
.failed { color: red; }
.passed { color: green; }
.warning { color: orange; }
.outliers_detected { color: #ff6600; font-weight: bold; }
.no_data { color: #666666; font-style: italic; }
.stats-info { font-size: 0.9em; color: #666; margin-left: 20px; }

div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
}

span.problematic {
  color: red;
  font-weight: bold ;
}

p.label {
  white-space: nowrap }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

div.embeded-report {
  width: 100%;
  page-break-before:always;
  padding-top: 20px;
}

div.embeded-report svg { width: 100%; }

div#accordionOther {
    margin: 0 20px;
}

.add-padding {
    padding-top: 15px;
}

#report-qi2-fitting {
    max-width: 450px;
}

</style>
</head>
<body>
<div class="document">

<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
<div class="collapse navbar-collapse">
    <ul class="navbar-nav">
      <li class="nav-item"><a class="nav-link" href="#summary">Summary</a></li>
      <li class="nav-item"><a class="nav-link" href="#quality">Quality Summary</a></li>
      <li class="nav-item"><a class="nav-link" href="#plots">Outlier Plots</a></li>
    </ul>
</div>
</nav>
<noscript>
    <h1 class="text-danger"> The navigation menu uses Javascript. Without it this report might not work as expected </h1>
</noscript>

<h1 class="mt-5 mb-5">FreeSurfer: Group Report</h1>

<div class="card mt-3" style="width: 480pt;">
    <h2 id="summary" class="card-header">Summary</h2>
    <div class="card-body">
        <ul class="simple">
        <li>Date and time: {{ timestamp }}.</li>
        <li>Number of subjects: {{ num_subjects }}.</li>
        <li>Outlier detection threshold: {{ sd_threshold }} standard deviations.</li>
        </ul>
    </div>
</div>

<div class="card mt-3">
    <h2 id="quality" class="card-header">Quality Summary</h2>
    <div class="card-body">
        <div class="quality-summary">
        {% if quality_summary %}
            {% for metric_name, metric_data in quality_summary.items() %}
            <div class="metric-group">
                <h3>{{ metric_name.replace('_', ' ').title() }}</h3>
                
                {% for region, result in metric_data.items() %}
                    {% if result.status == "no_data" %}
                        <p class="no_data">{{ region }}: {{ result.message }}</p>
                    {% elif result.status == "outliers_detected" %}
                        <p class="outliers_detected">{{ region }}: {{ result.message }}</p>
                        <p class="stats-info">Mean: {{ "%.2f"|format(result.mean) }}, Std: {{ "%.2f"|format(result.std) }}, Range: {{ "%.2f"|format(result.lower_bound) }} to {{ "%.2f"|format(result.upper_bound) }}</p>
                        {% if result.outlier_subjects %}
                        <p class="stats-info"><strong>Outlier Subjects:</strong></p>
                        <ul class="stats-info">
                            {% for outlier in result.outlier_subjects %}
                            <li>{{ outlier.subject_id }}: {{ "%.2f"|format(outlier.value) }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    {% elif result.status == "passed" %}
                        <p class="passed">{{ region }}: {{ result.message }}</p>
                        <p class="stats-info">Mean: {{ "%.2f"|format(result.mean) }}, Std: {{ "%.2f"|format(result.std) }}, Range: {{ "%.2f"|format(result.lower_bound) }} to {{ "%.2f"|format(result.upper_bound) }}</p>
                    {% endif %}
                {% endfor %}
            </div>
            {% endfor %}
        {% else %}
            <p class="no_data">No quality metrics available.</p>
        {% endif %}
        </div>
    </div>
</div>

<h2 id="plots" class="mt-5 mb-2">Outlier Plots</h2>
{% if plots %}
<div class="section">
    {% for plot_html in plots %}
    <div class="card mt-2">
        <div class="card-body">
            {{ plot_html|safe }}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card mt-2">
    <div class="card-body">
        <p class="no_data">No plots available.</p>
    </div>
</div>
{% endif %}

</div>
</div>
</div>


</body>
</html>
