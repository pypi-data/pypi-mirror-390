import sys
import re

class مساعد_عربي:
    def __init__(self):
        self.اسئلة_شائعة = {
            "range": "تستخدم دالة range() لإنشاء سلسلة من الأرقام. مثال: range(5) ينتج [0,1,2,3,4]",
            "نطاق": "تستخدم دالة نطاق() لإنشاء سلسلة من الأرقام. مثال: نطاق(5) ينتج [0,1,2,3,4]",
            "print": "تستخدم دالة print() لطباعة النصوص والقيم على الشاشة",
            "اطبع": "تستخدم دالة اطبع() لطباعة النصوص والقيم على الشاشة",
            "input": "تستخدم دالة input() لقراءة مدخلات المستخدم من لوحة المفاتيح",
            "ادخال": "تستخدم دالة ادخال() لقراءة مدخلات المستخدم من لوحة المفاتيح",
            "len": "تستخدم دالة len() لحساب طول القائمة أو النص",
            "طول": "تستخدم دالة طول() لحساب طول القائمة أو النص",
            "for": "حلقة for تستخدم للتكرار عبر عناصر قائمة أو سلسلة",
            "لكل": "حلقة لكل تستخدم للتكرار عبر عناصر قائمة أو سلسلة",
            "if": "جملة if تستخدم للتحقق من شرط معين وتنفيذ كود بناءً عليه",
            "اذا": "جملة اذا تستخدم للتحقق من شرط معين وتنفيذ كود بناءً عليه",
            "def": "كلمة def تستخدم لتعريف دالة جديدة",
            "دالة": "كلمة دالة تستخدم لتعريف دالة جديدة",
            "class": "كلمة class تستخدم لتعريف صنف (كلاس) جديد",
            "صنف": "كلمة صنف تستخدم لتعريف صنف (كلاس) جديد",
        }
        
        self.امثلة_كود = {
            "حلقة": '''مثال على الحلقة:
لكل رقم في نطاق(5):
    اطبع(رقم)
''',
            "دالة": '''مثال على الدالة:
دالة جمع(أ, ب):
    ارجع أ + ب

النتيجة = جمع(5, 3)
اطبع(النتيجة)
''',
            "شرط": '''مثال على الشرط:
العمر = 18
اذا العمر >= 18:
    اطبع("بالغ")
والا:
    اطبع("قاصر")
''',
            "قائمة": '''مثال على القائمة:
الأرقام = [1, 2, 3, 4, 5]
اطبع(طول(الأرقام))
لكل رقم في الأرقام:
    اطبع(رقم)
''',
            "قاموس": '''مثال على القاموس:
الطالب = {"الاسم": "أحمد", "العمر": 20}
اطبع(الطالب["الاسم"])
''',
        }

    def اسأل(self, سؤال):
        سؤال = سؤال.strip()
        
        for كلمة, جواب in self.اسئلة_شائعة.items():
            if كلمة in سؤال.lower():
                return جواب
        
        if "حلقة" in سؤال or "loop" in سؤال.lower() or "for" in سؤال.lower():
            return self.امثلة_كود["حلقة"]
        elif "دالة" in سؤال or "function" in سؤال.lower() or "def" in سؤال.lower():
            return self.امثلة_كود["دالة"]
        elif "شرط" in سؤال or "if" in سؤال.lower() or "اذا" in سؤال:
            return self.امثلة_كود["شرط"]
        elif "قائمة" in سؤال or "list" in سؤال.lower():
            return self.امثلة_كود["قائمة"]
        elif "قاموس" in سؤال or "dict" in سؤال.lower():
            return self.امثلة_كود["قاموس"]
        
        return "عذراً، لم أفهم سؤالك. حاول صياغته بطريقة أخرى أو اسأل عن: range، print، input، len، for، if، def، class"

    def شرح_كود(self, كود):
        شرح = []
        سطور = كود.split('\n')
        
        for سطر in سطور:
            سطر_نظيف = سطر.strip()
            
            if not سطر_نظيف or سطر_نظيف.startswith('#'):
                continue
                
            if 'اطبع' in سطر_نظيف or 'print' in سطر_نظيف:
                شرح.append("هذا السطر يطبع قيمة على الشاشة")
            elif 'دالة' in سطر_نظيف or 'def' in سطر_نظيف:
                شرح.append("هذا السطر يعرّف دالة جديدة")
            elif 'لكل' in سطر_نظيف or 'for' in سطر_نظيف:
                شرح.append("هذا السطر يبدأ حلقة تكرار")
            elif 'اذا' in سطر_نظيف or 'if' in سطر_نظيف:
                شرح.append("هذا السطر يتحقق من شرط معين")
            elif 'ارجع' in سطر_نظيف or 'return' in سطر_نظيف:
                شرح.append("هذا السطر يرجع قيمة من الدالة")
            elif '=' in سطر_نظيف and not ('==' in سطر_نظيف or '<=' in سطر_نظيف or '>=' in سطر_نظيف):
                شرح.append("هذا السطر يخزن قيمة في متغير")
        
        return '\n'.join(شرح) if شرح else "لا يوجد شرح متاح لهذا الكود"

    def اقتراحات_تحسين(self, كود):
        اقتراحات = []
        
        سطور = كود.split('\n')
        حلقات_متكررة = 0
        
        for سطر in سطور:
            if 'لكل' in سطر or 'for' in سطر:
                حلقات_متكررة += 1
        
        if حلقات_متكررة > 2:
            اقتراحات.append("يمكنك تبسيط الكود بدمج الحلقات المتكررة في دالة واحدة")
        
        if len(سطور) > 50:
            اقتراحات.append("الكود طويل، يمكنك تقسيمه إلى دوال أصغر لسهولة القراءة")
        
        اسماء_متغيرات = re.findall(r'\b[a-zA-Z_][a-zA-Z0-9_]*\b', كود)
        if len(set(اسماء_متغيرات)) < len(اسماء_متغيرات) * 0.5:
            اقتراحات.append("استخدم أسماء متغيرات أكثر وضوحاً")
        
        return '\n'.join(اقتراحات) if اقتراحات else "الكود يبدو جيداً!"

المساعد = مساعد_عربي()

def اسأل(سؤال):
    return المساعد.اسأل(سؤال)

def شرح_كود(كود):
    return المساعد.شرح_كود(كود)

def اقتراحات(كود):
    return المساعد.اقتراحات_تحسين(كود)
