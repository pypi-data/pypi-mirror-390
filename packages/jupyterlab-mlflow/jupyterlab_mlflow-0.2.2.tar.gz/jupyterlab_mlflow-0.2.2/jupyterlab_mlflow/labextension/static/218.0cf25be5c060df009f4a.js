"use strict";(self.webpackChunkjupyterlab_mlflow=self.webpackChunkjupyterlab_mlflow||[]).push([[218],{218:(e,t,l)=>{l.r(t),l.d(t,{default:()=>U});var a=l(986),n=l(560),s=l(177),i=l(424),o=l(860),r=l(694),c=l(256),m=l(345),d=l.n(m),u=l(628),p=l.n(u);function f(e){const{mlflowClient:t,onOpenObject:l}=e,[a,n]=(0,m.useState)([]),[s,i]=(0,m.useState)([]),[r,c]=(0,m.useState)(!0),[u,p]=(0,m.useState)(null),[f,w]=(0,m.useState)("experiments"),g=(0,m.useCallback)(async()=>{try{c(!0),p(null);const e=(await t.getExperiments()).map(e=>({id:e.experiment_id,label:e.name||e.experiment_id,type:"experiment",expanded:!1,children:[],data:e}));n(e)}catch(e){p(e instanceof Error?e.message:"Failed to load experiments")}finally{c(!1)}},[t]),v=(0,m.useCallback)(async()=>{try{c(!0),p(null);const e=(await t.getModels()).map(e=>({id:e.name,label:e.name,type:"model",expanded:!1,children:[],data:e}));i(e)}catch(e){p(e instanceof Error?e.message:" Failed to load models")}finally{c(!1)}},[t]);(0,m.useEffect)(()=>{g(),v()},[g,v]);const h=async(e,l,a)=>{var n;if(e.expanded)e.expanded=!1,a([...l]);else{if(e.loading)return;if(0===e.children.length){e.expanded=!0,e.loading=!0,a([...l]);try{if("experiment"===e.type){const l=await t.getRuns(e.id);e.children=l.map(e=>({id:e.run_id,label:e.run_name||e.run_id,type:"run",expanded:!1,children:[],data:e}))}else if("run"===e.type){const l=await t.getArtifacts(e.id);e.children=l.artifacts.map(t=>({id:`${e.id}/${t.path}`,label:t.path.split("/").pop()||t.path,type:"artifact",expanded:!1,children:[],data:{path:t.path,is_dir:Boolean(t.is_dir),file_size:t.file_size,runId:e.id}}))}else if("artifact"===e.type&&Boolean(null===(n=e.data)||void 0===n?void 0:n.is_dir)){const l=await t.getArtifacts(e.data.runId,e.data.path);e.children=l.artifacts.filter(e=>!e.is_dir).map(t=>({id:`${e.data.runId}/${t.path}`,label:t.path.split("/").pop()||t.path,type:"artifact",expanded:!1,children:[],data:{path:t.path,is_dir:!1,file_size:t.file_size,runId:e.data.runId}}))}else if("model"===e.type){const l=await t.getModel(e.id);e.children=l.latest_versions.map(t=>({id:`${e.id}/${t.version}`,label:`Version ${t.version} (${t.stage})`,type:"version",expanded:!1,children:[],data:{...t,modelName:e.id}}))}}catch(e){p(e instanceof Error?e.message:"Failed to load children")}finally{e.loading=!1,a([...l])}}else e.expanded=!0,a([...l])}},E=(e,a,n,s)=>{var i,r,c;const m=20*a,u="experiment"===e.type||"run"===e.type||"model"===e.type;let p,f;"artifact"===e.type?Boolean(null===(i=e.data)||void 0===i?void 0:i.is_dir)?(p=e.expanded?"ðŸ”½":"â–¶ï¸",f=!0):(p="ðŸ”¹",f=!1):(f=u,p=f?e.expanded?"â–¼":"â–¶":"experiment"===e.type?"ðŸ“":"run"===e.type?"â–¶ï¸":"model"===e.type?"ðŸ¤–":"ðŸ”¢");const w="artifact"===e.type&&!Boolean(null===(r=e.data)||void 0===r?void 0:r.is_dir);return d().createElement("div",{key:e.id},d().createElement("div",{className:"mlflow-tree-node",style:{paddingLeft:`${m}px`},onClick:()=>(async(e,l,a)=>{"artifact"!==e.type?await h(e,l,a):e.data.is_dir||async function(e,t,l){var a;try{const n=await l.downloadArtifact(e,t),s=(null===(a=t.split(".").pop())||void 0===a?void 0:a.toLowerCase())||"",i=t.split("/").pop()||`artifact_${e}`,o=URL.createObjectURL(n);if(["png","jpg","jpeg","gif","svg"].includes(s)){const e=window.open("","_blank");e&&e.document.write(`\n          <html>\n            <head><title>${i}</title></head>\n            <body style="margin:0;padding:20px;text-align:center;">\n              <img src="${o}" style="max-width:100%;height:auto;" />\n            </body>\n          </html>\n        `)}else if("json"===s){const e=await n.text(),t=window.open("","_blank");t&&t.document.write(`\n          <html>\n            <head>\n              <title>${i}</title>\n              <style>\n                body { font-family: monospace; padding: 20px; background: #f5f5f5; }\n                pre { background: white; padding: 15px; border-radius: 5px; overflow: auto; }\n              </style>\n            </head>\n            <body>\n              <h2>${i}</h2>\n              <pre>${JSON.stringify(JSON.parse(e),null,2)}</pre>\n            </body>\n          </html>\n        `)}else if("csv"===s){const e=await n.text(),t=window.open("","_blank");if(t){const l=e.split("\n").map(e=>"<tr>"+e.split(",").map(e=>`<td>${e}</td>`).join("")+"</tr>").join("");t.document.write(`\n          <html>\n            <head>\n              <title>${i}</title>\n              <style>\n                body { font-family: sans-serif; padding: 20px; }\n                table { border-collapse: collapse; width: 100%; }\n                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n                th { background-color: #f2f2f2; }\n              </style>\n            </head>\n            <body>\n              <h2>${i}</h2>\n              <table>${l}</table>\n            </body>\n          </html>\n        `)}}else{const e=await n.text(),t=window.open("","_blank");t&&t.document.write(`\n          <html>\n            <head>\n              <title>${i}</title>\n              <style>\n                body { font-family: monospace; padding: 20px; white-space: pre-wrap; }\n              </style>\n            </head>\n            <body>${e}</body>\n          </html>\n        `)}setTimeout(()=>URL.revokeObjectURL(o),1e3)}catch(e){console.error("Failed to open artifact:",e),alert(`Failed to open artifact: ${e instanceof Error?e.message:"Unknown error"}`)}}(e.data.runId,e.data.path,t)})(e,n,s)},d().createElement("span",{className:"mlflow-tree-icon",onClick:t=>f&&(async(e,t,l,a)=>{e.stopPropagation(),await h(t,l,a)})(t,e,n,s),style:{cursor:f?"pointer":"default",display:"inline-block",minWidth:"16px",fontSize:"12px",lineHeight:"1",userSelect:"none"},title:"artifact"===e.type?Boolean(null===(c=e.data)||void 0===c?void 0:c.is_dir)?"Directory":"File":""},p||" "),d().createElement("span",{className:"mlflow-loading-container"},e.loading&&d().createElement("span",{className:"mlflow-loading"},"â³")),d().createElement("span",{className:"mlflow-tree-label",title:"run"===e.type?e.id:e.label},"run"===e.type&&e.id.length>20?function(e,t=20){return e.length<=t?e:`${e.substring(0,t-3)}...`}(e.label):e.label),d().createElement("div",{style:{display:"flex",gap:"2px",marginLeft:"4px",alignItems:"center"}},w&&d().createElement("button",{className:"mlflow-download-button",onClick:l=>{l.preventDefault(),l.stopPropagation(),(async e=>{var l,a;if("artifact"===e.type)try{const n=(null===(l=e.data)||void 0===l?void 0:l.runId)||e.id.split("/")[0],s=(null===(a=e.data)||void 0===a?void 0:a.path)||e.label,i=s.split("/").pop()||`artifact_${n}`,r=await t.downloadArtifact(n,s),c=await new Promise((e,t)=>{const l=new FileReader;l.onloadend=()=>{const t=l.result.split(",")[1];e(t)},l.onerror=t,l.readAsDataURL(r)}),m=t.getServerSettings(),d=new o.ContentsManager({serverSettings:m});await d.save(i,{type:"file",format:"base64",content:c}),alert(`Artifact saved to: ${i}`)}catch(e){console.error("Failed to download artifact:",e);const t=e instanceof Error?e.message:"Unknown error";t.includes("is a directory")||t.includes("Is a directory")?alert("Cannot download directories. Expand the directory to see files inside, then download individual files."):alert(`Failed to download: ${t}`)}})(e)},title:"Download artifact",style:{fontSize:"14px",padding:"2px 6px",opacity:.7,cursor:"pointer"}},"â¬‡"),("model"===e.type||"run"===e.type||"experiment"===e.type||"version"===e.type)&&d().createElement("button",{className:"mlflow-open-button",onClick:t=>{t.stopPropagation(),(e=>{l&&("experiment"===e.type?l("experiment",e.id,e.data):"run"===e.type?l("run",e.id,e.data):"model"===e.type?l("model",e.id,e.data):"version"===e.type?l("version",e.data.version,{...e.data,modelName:e.data.modelName}):"artifact"===e.type&&l("artifact",e.data.path,e.data))})(e)},title:"Open in Details View",style:{fontSize:"11px",padding:"2px 6px",opacity:.7,cursor:"pointer"}},"Open"))),e.expanded&&e.children.map(t=>E(t,a+1,e.children,t=>{e.children=t,s([...n])})))};return d().createElement("div",{className:"mlflow-tree-view"},d().createElement("div",{className:"mlflow-tabs"},d().createElement("button",{className:"mlflow-tab "+("experiments"===f?"active":""),onClick:()=>w("experiments")},"Experiments"),d().createElement("button",{className:"mlflow-tab "+("models"===f?"active":""),onClick:()=>w("models")},"Models")),u&&d().createElement("div",{className:"mlflow-error"},"Error: ",u,d().createElement("button",{onClick:()=>"experiments"===f?g():v()},"Retry")),r&&0===a.length&&0===s.length?d().createElement("div",{className:"mlflow-loading"},"Loading..."):d().createElement("div",{className:"mlflow-tree-content"},"experiments"===f&&a.map(e=>E(e,0,a,n)),"models"===f&&s.map(e=>E(e,0,s,i))))}async function w(e){try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0;{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{const e=document.execCommand("copy");return document.body.removeChild(t),e}catch(e){return document.body.removeChild(t),!1}}}catch(e){return console.error("Failed to copy to clipboard:",e),!1}}async function g(e){await w(e)?v("Code copied to clipboard!"):v("Failed to copy code","error")}function v(e,t="success"){const l=document.querySelector(".mlflow-toast");l&&l.remove();const a=document.createElement("div");a.className="mlflow-toast",a.textContent=e;const n="success"===t?"var(--jp-success-color1, #4caf50)":"var(--jp-error-color1, #f44336)";a.style.cssText=`\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    background: ${n};\n    color: white;\n    padding: 12px 24px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n    z-index: 10000;\n    font-size: 13px;\n    animation: mlflow-slideIn 0.3s ease-out;\n  `,document.body.appendChild(a),setTimeout(()=>{a.style.animation="mlflow-slideOut 0.3s ease-out",setTimeout(()=>{a.parentNode&&document.body.removeChild(a)},300)},2e3)}async function h(e){return w(e)}function E(e){return`run = mlflow.get_run(run_id="${e}")\nprint(f"Status: {run.info.status}")\nprint(f"Metrics: {run.data.metrics}")\nprint(f"Parameters: {run.data.params}")\n`}function y(e){const{mlflowClient:t,app:l,initialSelection:a,onObjectSelect:n}=e,[s,i]=(0,m.useState)("experiments"),[o,r]=(0,m.useState)(null),[c,u]=(0,m.useState)([]),[p,f]=(0,m.useState)([]),[v,y]=(0,m.useState)([]),[b,N]=(0,m.useState)([]),[x,_]=(0,m.useState)([]),[k,S]=(0,m.useState)(!0),[C,L]=(0,m.useState)(null),M=(0,m.useRef)(!1),T=(0,m.useCallback)(async()=>{try{S(!0),L(null);const e=await t.getExperiments();u(e)}catch(e){L(e instanceof Error?e.message:"Failed to load experiments")}finally{S(!1)}},[t]),I=(0,m.useCallback)(async()=>{try{S(!0),L(null);const e=await t.getModels();N(e)}catch(e){L(e instanceof Error?e.message:"Failed to load models")}finally{S(!1)}},[t]),U=(0,m.useCallback)(async e=>{try{S(!0),L(null);const l=await t.getExperiment(e);r({type:"experiment",data:l,parent:null});const a=await t.getRuns(e);f(a)}catch(e){L(e instanceof Error?e.message:"Failed to load experiment")}finally{S(!1)}},[t]),$=(0,m.useCallback)(async e=>{try{S(!0),L(null);const l=await t.getRun(e);r({type:"run",data:l,parent:o||void 0});const a=await t.getArtifacts(e);y(a.artifacts||[])}catch(e){L(e instanceof Error?e.message:"Failed to load run")}finally{S(!1)}},[t,o]),R=(0,m.useCallback)(async e=>{try{S(!0),L(null);const l=await t.getModel(e);r({type:"model",data:l,parent:null}),_(l.latest_versions||[])}catch(e){L(e instanceof Error?e.message:"Failed to load model")}finally{S(!1)}},[t]),A=(0,m.useCallback)(async(e,l)=>{try{S(!0),L(null);const a=(await t.getModel(e)).latest_versions.find(e=>e.version===l);if(a){const t=o||void 0;r({type:"version",data:{...a,modelName:e},parent:t||void 0})}}catch(e){L(e instanceof Error?e.message:"Failed to load model version")}finally{S(!1)}},[t,o]),j=(0,m.useCallback)((e,t,l)=>{n&&n(e,t),"experiment"===e?U(t):"run"===e?$(t):"model"===e?R(t):"version"===e&&(null==l?void 0:l.modelName)?A(l.modelName,t):"artifact"===e&&l&&r(e=>({type:"artifact",data:l,parent:e||void 0}))},[n,U,$,R,A]),O=(0,m.useCallback)(()=>{r(e=>(null==e?void 0:e.parent)?("experiment"===e.parent.type?t.getRuns(e.parent.data.experiment_id).then(f).catch(console.error):"model"===e.parent.type&&t.getModel(e.parent.data.name).then(e=>{_(e.latest_versions||[])}).catch(console.error),e.parent):("experiments"===s?T():I(),null))},[s,t,T,I]);(0,m.useEffect)(()=>{a&&!M.current?(M.current=!0,j(a.type,a.id,a.data)):o||a||("experiments"===s?T():I())},[s,j,T,I,a,o]),(0,m.useEffect)(()=>{a&&a.id&&!M.current&&(M.current=!0,j(a.type,a.id,a.data))},[null==a?void 0:a.id,null==a?void 0:a.type,j]);const D=e=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`,F=e=>e.length>6?e.slice(-6):e,P=e=>{if(!l)return void alert("JupyterLab app not available");const t=l.shell.currentWidget;if(!t)return void alert("Please open a notebook first");const a=t.content;if(!a||!a.activeCell){const t=l.shell.widgets("main");for(const a of t){const t=a.content;if(t&&t.activeCell){const n=t.activeCell;if(n.model){if(n.model.sharedModel)return n.model.sharedModel.setSource(e),void l.shell.activateById(a.id);if(n.model.value)return n.model.value.text=e,void l.shell.activateById(a.id)}}}return void alert("Could not find active notebook cell. Please make sure a notebook is open and a cell is selected.")}const n=a.activeCell;n&&n.model?(n.model.sharedModel?n.model.sharedModel.setSource(e):n.model.value&&(n.model.value.text=e),l.shell.activateById(t.id)):alert("Please select a cell in the notebook")};return d().createElement("div",{className:"mlflow-details-view"},d().createElement("div",{className:"mlflow-tabs"},d().createElement("button",{className:"mlflow-tab "+("experiments"===s?"active":""),onClick:()=>{i("experiments"),r(null),T()}},"Experiments"),d().createElement("button",{className:"mlflow-tab "+("models"===s?"active":""),onClick:()=>{i("models"),r(null),I()}},"Models")),C&&d().createElement("div",{className:"mlflow-error"},"Error: ",C,d().createElement("button",{onClick:()=>{L(null),"experiments"===s?T():I()}},"Retry")),k&&!o&&d().createElement("div",{className:"mlflow-loading"},"Loading..."),d().createElement("div",{className:"mlflow-details-content"},o&&d().createElement("div",{className:"mlflow-details-navigation"},d().createElement("button",{className:"mlflow-button",onClick:O},"â† Back")),(()=>{if(!o)return null;const{type:e,data:t}=o;if("experiment"===e)return d().createElement("div",{className:"mlflow-details-metadata"},d().createElement("h3",{className:"mlflow-details-title"},"Experiment: ",t.name||t.experiment_id),d().createElement("div",{className:"mlflow-details-grid"},d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Experiment ID:"),d().createElement("span",{className:"mlflow-details-value"},t.experiment_id)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Name:"),d().createElement("span",{className:"mlflow-details-value"},t.name||"(unnamed)")),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Artifact Location:"),d().createElement("span",{className:"mlflow-details-value"},t.artifact_location)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Lifecycle Stage:"),d().createElement("span",{className:"mlflow-details-value"},t.lifecycle_stage)),t.tags&&Object.keys(t.tags).length>0&&d().createElement("div",{className:"mlflow-details-item mlflow-details-item-full"},d().createElement("span",{className:"mlflow-details-label"},"Tags:"),d().createElement("div",{className:"mlflow-details-tags"},Object.entries(t.tags).map(([e,t])=>d().createElement("span",{key:e,className:"mlflow-tag"},e,": ",t))))));if("run"===e){const e=t.end_time&&t.start_time?`${((t.end_time-t.start_time)/1e3).toFixed(1)}s`:"Running...";return d().createElement("div",{className:"mlflow-details-metadata"},d().createElement("h3",{className:"mlflow-details-title"},"Run: ",t.run_name||t.run_id),d().createElement("div",{className:"mlflow-details-grid"},d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Run ID:"),d().createElement("span",{className:"mlflow-details-value"},t.run_id)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Status:"),d().createElement("span",{className:"mlflow-details-value"},t.status)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"User:"),d().createElement("span",{className:"mlflow-details-value"},t.user_id)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Start Time:"),d().createElement("span",{className:"mlflow-details-value"},new Date(t.start_time).toLocaleString())),t.end_time&&d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"End Time:"),d().createElement("span",{className:"mlflow-details-value"},new Date(t.end_time).toLocaleString())),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Duration:"),d().createElement("span",{className:"mlflow-details-value"},e)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Artifact URI:"),d().createElement("span",{className:"mlflow-details-value"},t.artifact_uri)),t.metrics&&Object.keys(t.metrics).length>0&&d().createElement("div",{className:"mlflow-details-item mlflow-details-item-full"},d().createElement("span",{className:"mlflow-details-label"},"Metrics:"),d().createElement("div",{className:"mlflow-details-metrics"},Object.entries(t.metrics).map(([e,t])=>d().createElement("span",{key:e,className:"mlflow-metric"},e,": ",t)))),t.params&&Object.keys(t.params).length>0&&d().createElement("div",{className:"mlflow-details-item mlflow-details-item-full"},d().createElement("span",{className:"mlflow-details-label"},"Parameters:"),d().createElement("div",{className:"mlflow-details-params"},Object.entries(t.params).map(([e,t])=>d().createElement("span",{key:e,className:"mlflow-param"},e,": ",t)))),t.tags&&Object.keys(t.tags).length>0&&d().createElement("div",{className:"mlflow-details-item mlflow-details-item-full"},d().createElement("span",{className:"mlflow-details-label"},"Tags:"),d().createElement("div",{className:"mlflow-details-tags"},Object.entries(t.tags).map(([e,t])=>d().createElement("span",{key:e,className:"mlflow-tag"},e,": ",t))))))}return"model"===e?d().createElement("div",{className:"mlflow-details-metadata"},d().createElement("h3",{className:"mlflow-details-title"},"Model: ",t.name),d().createElement("div",{className:"mlflow-details-grid"},d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Name:"),d().createElement("span",{className:"mlflow-details-value"},t.name)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Created:"),d().createElement("span",{className:"mlflow-details-value"},new Date(t.creation_timestamp).toLocaleString())),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Last Updated:"),d().createElement("span",{className:"mlflow-details-value"},new Date(t.last_updated_timestamp).toLocaleString())),t.description&&d().createElement("div",{className:"mlflow-details-item mlflow-details-item-full"},d().createElement("span",{className:"mlflow-details-label"},"Description:"),d().createElement("span",{className:"mlflow-details-value"},t.description)),t.tags&&Object.keys(t.tags).length>0&&d().createElement("div",{className:"mlflow-details-item mlflow-details-item-full"},d().createElement("span",{className:"mlflow-details-label"},"Tags:"),d().createElement("div",{className:"mlflow-details-tags"},Object.entries(t.tags).map(([e,t])=>d().createElement("span",{key:e,className:"mlflow-tag"},e,": ",t)))))):"version"===e?d().createElement("div",{className:"mlflow-details-metadata"},d().createElement("h3",{className:"mlflow-details-title"},"Model Version: ",t.version),d().createElement("div",{className:"mlflow-details-grid"},d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Version:"),d().createElement("span",{className:"mlflow-details-value"},t.version)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Stage:"),d().createElement("span",{className:"mlflow-details-value"},t.stage)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Status:"),d().createElement("span",{className:"mlflow-details-value"},t.status)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Run ID:"),d().createElement("span",{className:"mlflow-details-value"},t.run_id)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Created:"),d().createElement("span",{className:"mlflow-details-value"},new Date(t.creation_timestamp).toLocaleString())),t.description&&d().createElement("div",{className:"mlflow-details-item mlflow-details-item-full"},d().createElement("span",{className:"mlflow-details-label"},"Description:"),d().createElement("span",{className:"mlflow-details-value"},t.description)))):"artifact"===e?d().createElement("div",{className:"mlflow-details-metadata"},d().createElement("h3",{className:"mlflow-details-title"},"Artifact: ",t.path),d().createElement("div",{className:"mlflow-details-grid"},d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Path:"),d().createElement("span",{className:"mlflow-details-value"},t.path)),d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Type:"),d().createElement("span",{className:"mlflow-details-value"},t.is_dir?"Directory":"File")),null!==t.file_size&&d().createElement("div",{className:"mlflow-details-item"},d().createElement("span",{className:"mlflow-details-label"},"Size:"),d().createElement("span",{className:"mlflow-details-value"},D(t.file_size))))):null})(),(()=>{if(!o)return"experiments"===s?d().createElement("div",{className:"mlflow-details-table-section"},d().createElement("h4",{className:"mlflow-details-section-title"},"Experiments"),d().createElement("table",{className:"mlflow-table"},d().createElement("thead",null,d().createElement("tr",null,d().createElement("th",null,"ID"),d().createElement("th",null,"Name"),d().createElement("th",null,"Actions"))),d().createElement("tbody",null,c.map(e=>d().createElement("tr",{key:e.experiment_id,onClick:()=>j("experiment",e.experiment_id,e)},d().createElement("td",null,e.experiment_id),d().createElement("td",null,e.name||"(unnamed)"),d().createElement("td",null,d().createElement("button",{className:"mlflow-button-small",onClick:t=>{t.stopPropagation(),async function(e){w(e)}(e.experiment_id)}},"Copy ID"))))))):d().createElement("div",{className:"mlflow-details-table-section"},d().createElement("h4",{className:"mlflow-details-section-title"},"Models"),d().createElement("table",{className:"mlflow-table"},d().createElement("thead",null,d().createElement("tr",null,d().createElement("th",null,"Name"),d().createElement("th",null,"Versions"),d().createElement("th",null,"Last Updated"),d().createElement("th",null,"Actions"))),d().createElement("tbody",null,b.map(e=>d().createElement("tr",{key:e.name,onClick:()=>j("model",e.name,e)},d().createElement("td",null,e.name),d().createElement("td",null,e.latest_versions.length),d().createElement("td",null,new Date(e.last_updated_timestamp).toLocaleString()),d().createElement("td",null,d().createElement("button",{className:"mlflow-button-small",onClick:t=>{t.stopPropagation(),async function(e){w(e)}(e.name)}},"Copy Name")))))));const{type:e}=o;return"experiment"===e?d().createElement("div",{className:"mlflow-details-table-section"},d().createElement("h4",{className:"mlflow-details-section-title"},"Runs"),d().createElement("table",{className:"mlflow-table"},d().createElement("thead",null,d().createElement("tr",null,d().createElement("th",null,"Run ID"),d().createElement("th",null,"Name"),d().createElement("th",null,"Status"),d().createElement("th",null,"Actions"))),d().createElement("tbody",null,p.map(e=>d().createElement("tr",{key:e.run_id,onClick:t=>{"BUTTON"!==t.target.tagName&&j("run",e.run_id,e)}},d().createElement("td",null,d().createElement("button",{className:"mlflow-run-id-button",onClick:t=>{t.stopPropagation(),h(e.run_id)},title:e.run_id},F(e.run_id))),d().createElement("td",null,e.run_name||"-"),d().createElement("td",null,e.status),d().createElement("td",null,d().createElement("div",{className:"mlflow-actions-group",onClick:e=>e.stopPropagation()},d().createElement("button",{className:"mlflow-button-small",onClick:()=>g(E(e.run_id)),title:"Copy code: Get run"},"ðŸ“‹"),l&&d().createElement("button",{className:"mlflow-button-small",onClick:()=>P(E(e.run_id)),title:"Insert code: Get run"},"âž•")))))))):"run"===e?d().createElement("div",{className:"mlflow-details-table-section"},d().createElement("h4",{className:"mlflow-details-section-title"},"Artifacts"),d().createElement("table",{className:"mlflow-table"},d().createElement("thead",null,d().createElement("tr",null,d().createElement("th",null,"Path"),d().createElement("th",null,"Type"),d().createElement("th",null,"Size"))),d().createElement("tbody",null,v.map(e=>d().createElement("tr",{key:e.path,onClick:()=>j("artifact",e.path,e)},d().createElement("td",null,e.path),d().createElement("td",null,e.is_dir?"Directory":"File"),d().createElement("td",null,null!==e.file_size?D(e.file_size):"-")))))):"model"===e?d().createElement("div",{className:"mlflow-details-table-section"},d().createElement("h4",{className:"mlflow-details-section-title"},"Versions"),d().createElement("table",{className:"mlflow-table"},d().createElement("thead",null,d().createElement("tr",null,d().createElement("th",null,"Version"),d().createElement("th",null,"Stage"),d().createElement("th",null,"Status"),d().createElement("th",null,"Run ID"),d().createElement("th",null,"Created"),d().createElement("th",null,"Actions"))),d().createElement("tbody",null,x.map(e=>d().createElement("tr",{key:e.version,onClick:t=>{"BUTTON"!==t.target.tagName&&j("version",e.version,{...e,modelName:o.data.name})}},d().createElement("td",null,e.version),d().createElement("td",null,e.stage),d().createElement("td",null,e.status),d().createElement("td",null,d().createElement("button",{className:"mlflow-run-id-button",onClick:t=>{t.stopPropagation(),h(e.run_id)},title:e.run_id},F(e.run_id))),d().createElement("td",null,new Date(e.creation_timestamp).toLocaleString()),d().createElement("td",null,d().createElement("div",{className:"mlflow-actions-group",onClick:e=>e.stopPropagation()},d().createElement("button",{className:"mlflow-button-small",onClick:()=>g(E(e.run_id)),title:"Copy code: Get run"},"ðŸ“‹"),l&&d().createElement("button",{className:"mlflow-button-small",onClick:()=>P(E(e.run_id)),title:"Insert code: Get run"},"âž•")))))))):null})()))}function b(e){const{mlflowClient:t,trackingUri:l,onTrackingUriChange:a,onClose:n}=e,[s,i]=(0,m.useState)(l),[o,r]=(0,m.useState)(!1),[c,u]=(0,m.useState)(null),[p,f]=(0,m.useState)(null),[w,g]=(0,m.useState)(5e3),[v,h]=(0,m.useState)("sqlite:///mlflow.db"),[E,y]=(0,m.useState)("./mlruns"),[b,N]=(0,m.useState)(!1),[x,_]=(0,m.useState)(!1),k=(0,m.useCallback)(async()=>{try{const e=await t.getLocalServerStatus();f(e),e.running&&e.url&&i(e.url)}catch(e){console.error("Failed to load local server status:",e)}},[t]);return(0,m.useEffect)(()=>{k();const e=setInterval(k,5e3);return()=>clearInterval(e)},[k]),d().createElement("div",{className:"mlflow-settings-panel"},d().createElement("div",{className:"mlflow-settings-header"},d().createElement("h3",null,"MLflow Settings"),d().createElement("button",{className:"mlflow-button-close",onClick:n},"Ã—")),d().createElement("div",{className:"mlflow-settings-content"},d().createElement("div",{className:"mlflow-settings-field"},d().createElement("label",{htmlFor:"tracking-uri"},"MLflow Tracking URI"),d().createElement("input",{id:"tracking-uri",type:"text",value:s,onChange:e=>i(e.target.value),placeholder:"http://localhost:5000 or leave empty for MLFLOW_TRACKING_URI env var",className:"mlflow-input"}),d().createElement("div",{className:"mlflow-settings-help"},"Leave empty to use MLFLOW_TRACKING_URI environment variable")),d().createElement("div",{className:"mlflow-settings-actions"},d().createElement("button",{className:"mlflow-button mlflow-button-primary",onClick:async()=>{r(!0),u(null);try{const e=await t.testConnection(s);u(e)}catch(e){u({success:!1,error:e instanceof Error?e.message:"Unknown error"})}finally{r(!1)}},disabled:o},o?"Testing...":"Test Connection"),c&&d().createElement("div",{className:"mlflow-test-result "+(c.success?"success":"error")},c.success?d().createElement("span",null,"âœ“ ",c.message||"Connection successful"):d().createElement("span",null,"âœ— ",c.error||"Connection failed"))),d().createElement("div",{className:"mlflow-settings-actions"},d().createElement("button",{className:"mlflow-button mlflow-button-primary",onClick:()=>{a(s),n()}},"Save"),d().createElement("button",{className:"mlflow-button",onClick:n},"Cancel")),d().createElement("div",{className:"mlflow-settings-divider"}),d().createElement("div",{className:"mlflow-settings-section"},d().createElement("h4",{className:"mlflow-settings-section-title"},"Local MLflow Server"),d().createElement("div",{className:"mlflow-settings-help",style:{marginBottom:"12px"}},"Launch a local MLflow server for development and testing"),(null==p?void 0:p.running)&&d().createElement("div",{className:"mlflow-test-result success",style:{marginBottom:"12px"}},"âœ“ MLflow server running on ",p.url),d().createElement("div",{className:"mlflow-settings-field"},d().createElement("label",{htmlFor:"local-server-port"},"Port"),d().createElement("input",{id:"local-server-port",type:"number",value:w,onChange:e=>g(parseInt(e.target.value)||5e3),className:"mlflow-input",disabled:null==p?void 0:p.running})),d().createElement("div",{className:"mlflow-settings-field"},d().createElement("label",{htmlFor:"local-server-tracking-uri"},"Tracking URI"),d().createElement("input",{id:"local-server-tracking-uri",type:"text",value:v,onChange:e=>h(e.target.value),placeholder:"sqlite:///mlflow.db",className:"mlflow-input",disabled:null==p?void 0:p.running}),d().createElement("div",{className:"mlflow-settings-help"},"Default: sqlite:///mlflow.db (SQLite database)")),d().createElement("div",{className:"mlflow-settings-field"},d().createElement("label",{htmlFor:"local-server-artifact-uri"},"Artifact URI"),d().createElement("input",{id:"local-server-artifact-uri",type:"text",value:E,onChange:e=>y(e.target.value),placeholder:"./mlruns",className:"mlflow-input",disabled:null==p?void 0:p.running}),d().createElement("div",{className:"mlflow-settings-help"},"Default: ./mlruns (local directory)")),d().createElement("div",{className:"mlflow-settings-actions"},(null==p?void 0:p.running)?d().createElement("button",{className:"mlflow-button",onClick:async()=>{_(!0);try{await t.stopLocalServer(),await k()}catch(e){console.error("Failed to stop local server:",e),alert(`Failed to stop local MLflow server: ${e instanceof Error?e.message:"Unknown error"}`)}finally{_(!1)}},disabled:x},x?"Stopping...":"Stop Server"):d().createElement("button",{className:"mlflow-button mlflow-button-primary",onClick:async()=>{N(!0);try{const e=await t.startLocalServer(w,v,E);e.success&&e.url&&(i(e.url),a(e.url)),await k()}catch(e){console.error("Failed to start local server:",e),alert(`Failed to start local MLflow server: ${e instanceof Error?e.message:"Unknown error"}`)}finally{N(!1)}},disabled:b},b?"Starting...":"Start Local Server")))))}l(665);const N=[{title:"Import MLflow",description:"Import the MLflow library",code:"import mlflow\n",category:"Setup"},{title:"Set Tracking URI",description:"Set the MLflow tracking server URI",code:'mlflow.set_tracking_uri("http://localhost:5000")\n',category:"Setup"},{title:"Create Experiment",description:"Create a new MLflow experiment",code:'experiment_id = mlflow.create_experiment(\n    name="my_experiment"\n)\nprint(f"Created experiment: {experiment_id}")\n',category:"Experiments"},{title:"Get Experiment",description:"Get experiment details by ID",code:'experiment = mlflow.get_experiment(experiment_id="0")\nprint(f"Name: {experiment.name}")\nprint(f"Artifact Location: {experiment.artifact_location}")\n',category:"Experiments"},{title:"Set Active Experiment",description:"Set the active experiment for logging",code:'mlflow.set_experiment("my_experiment")\n',category:"Experiments"},{title:"List Experiments",description:"List all experiments",code:'experiments = mlflow.search_experiments()\nfor exp in experiments:\n    print(f"{exp.experiment_id}: {exp.name}")\n',category:"Experiments"},{title:"Start Run",description:"Start a new MLflow run",code:'with mlflow.start_run() as run:\n    print(f"Run ID: {run.info.run_id}")\n    # Your code here\n',category:"Runs"},{title:"Start Run with Name",description:"Start a named run",code:'with mlflow.start_run(run_name="my_run") as run:\n    print(f"Run ID: {run.info.run_id}")\n    # Your code here\n',category:"Runs"},{title:"Get Run",description:"Get run details by run ID",code:'run = mlflow.get_run(run_id="your-run-id")\nprint(f"Status: {run.info.status}")\nprint(f"Metrics: {run.data.metrics}")\nprint(f"Parameters: {run.data.params}")\n',category:"Runs"},{title:"Search Runs",description:"Search runs in an experiment",code:'runs = mlflow.search_runs(experiment_ids=["0"])\nprint(runs.head())\n',category:"Runs"},{title:"Log Parameter",description:"Log a parameter value",code:'mlflow.log_param("learning_rate", 0.01)\n',category:"Logging"},{title:"Log Multiple Parameters",description:"Log multiple parameters at once",code:'mlflow.log_params({\n    "learning_rate": 0.01,\n    "batch_size": 32,\n    "epochs": 10\n})\n',category:"Logging"},{title:"Log Metric",description:"Log a metric value",code:'mlflow.log_metric("accuracy", 0.95)\n',category:"Logging"},{title:"Log Multiple Metrics",description:"Log multiple metrics at once",code:'mlflow.log_metrics({\n    "accuracy": 0.95,\n    "f1_score": 0.92,\n    "loss": 0.05\n})\n',category:"Logging"},{title:"Log Metric Over Time",description:"Log a metric at a specific step",code:'for step in range(10):\n    mlflow.log_metric("loss", 1.0 / (step + 1), step=step)\n',category:"Logging"},{title:"Log Artifact",description:"Log a file as an artifact",code:'mlflow.log_artifact("path/to/file.txt")\n',category:"Logging"},{title:"Log Artifacts Directory",description:"Log all files in a directory",code:'mlflow.log_artifacts("path/to/directory")\n',category:"Logging"},{title:"Log Text",description:"Log text as an artifact",code:'mlflow.log_text("Some text content", "output.txt")\n',category:"Logging"},{title:"Log JSON",description:"Log a dictionary as JSON artifact",code:'import json\n\ndata = {"key": "value"}\nmlflow.log_dict(data, "data.json")\n',category:"Logging"},{title:"Log Image",description:"Log an image as an artifact",code:'from PIL import Image\n\nimg = Image.open("image.png")\nmlflow.log_image(img, "image.png")\n',category:"Logging"},{title:"Log Figure",description:"Log a matplotlib figure",code:'import matplotlib.pyplot as plt\n\nfig, ax = plt.subplots()\nax.plot([1, 2, 3], [1, 4, 9])\nmlflow.log_figure(fig, "plot.png")\n',category:"Logging"},{title:"Log Model (sklearn)",description:"Log a scikit-learn model",code:'from sklearn.ensemble import RandomForestClassifier\n\nmodel = RandomForestClassifier()\nmlflow.sklearn.log_model(model, "model")\n',category:"Models"},{title:"Log Model (PyTorch)",description:"Log a PyTorch model",code:'import torch\n\nmodel = torch.nn.Linear(10, 1)\nmlflow.pytorch.log_model(model, "model")\n',category:"Models"},{title:"Log Model (TensorFlow)",description:"Log a TensorFlow/Keras model",code:'import tensorflow as tf\n\nmodel = tf.keras.Sequential([...])\nmlflow.tensorflow.log_model(model, "model")\n',category:"Models"},{title:"Log Model (XGBoost)",description:"Log an XGBoost model",code:'import xgboost as xgb\n\nmodel = xgb.XGBClassifier()\nmlflow.xgboost.log_model(model, "model")\n',category:"Models"},{title:"Load Model",description:"Load a logged model",code:'model = mlflow.pyfunc.load_model("runs:/run-id/model")\n',category:"Models"},{title:"Load Model from Registry",description:"Load a model from the model registry",code:'model = mlflow.pyfunc.load_model("models:/model-name/1")\n',category:"Models"},{title:"Register Model",description:"Register a model in the model registry",code:'mlflow.register_model(\n    model_uri="runs:/run-id/model",\n    name="my_model"\n)\n',category:"Models"},{title:"List Registered Models",description:"List all registered models",code:'models = mlflow.search_registered_models()\nfor model in models:\n    print(f"{model.name}: {model.latest_versions}")\n',category:"Model Registry"},{title:"Get Model Version",description:"Get details of a specific model version",code:'model_version = mlflow.get_model_version(\n    name="my_model",\n    version=1\n)\nprint(f"Stage: {model_version.current_stage}")\n',category:"Model Registry"},{title:"Transition Model Stage",description:"Transition a model version to a new stage",code:'mlflow.transition_model_version_stage(\n    name="my_model",\n    version=1,\n    stage="Production"\n)\n',category:"Model Registry"},{title:"Download Artifacts",description:"Download artifacts from a run",code:'artifact_path = mlflow.artifacts.download_artifacts(\n    run_id="run-id",\n    artifact_path="model"\n)\nprint(f"Downloaded to: {artifact_path}")\n',category:"Artifacts"},{title:"Load Artifact as Text",description:"Load an artifact as text",code:'text = mlflow.artifacts.load_text("runs:/run-id/artifact.txt")\nprint(text)\n',category:"Artifacts"},{title:"Load Artifact as JSON",description:"Load an artifact as JSON",code:'import json\n\ntext = mlflow.artifacts.load_text("runs:/run-id/data.json")\ndata = json.loads(text)\nprint(data)\n',category:"Artifacts"},{title:"List Artifacts",description:"List artifacts in a run",code:'artifacts = mlflow.artifacts.list_artifacts("runs:/run-id")\nfor artifact in artifacts:\n    print(f"{artifact.path} ({artifact.file_size} bytes)")\n',category:"Artifacts"}];function x(e){const{app:t}=e,l=N.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{}),a=["Setup","Experiments","Runs","Logging"],n=Object.keys(l).filter(e=>!a.includes(e)).sort(),s=[...a.filter(e=>l[e]),...n];return d().createElement("div",{className:"mlflow-shortcuts-panel"},d().createElement("div",{className:"mlflow-shortcuts-header"},d().createElement("h3",null,"MLflow Shortcuts"),d().createElement("p",{className:"mlflow-shortcuts-description"},"Click on any shortcut to insert it into the active notebook cell")),d().createElement("div",{className:"mlflow-shortcuts-content"},s.map(e=>d().createElement("div",{key:e,className:"mlflow-shortcuts-category"},d().createElement("h4",{className:"mlflow-shortcuts-category-title"},e),d().createElement("div",{className:"mlflow-shortcuts-list"},l[e].map((l,a)=>d().createElement("div",{key:`${e}-${a}`,className:"mlflow-shortcut-item",onClick:()=>(e=>{const l=t.shell.currentWidget;if(!l)return void alert("Please open a notebook first");const a=l.content;if(!a||!a.activeCell){const l=t.shell.widgets("main");for(const a of l){const l=a.content;if(l&&l.activeCell){const n=l.activeCell;if(n.model){if(n.model.sharedModel)return n.model.sharedModel.setSource(e),void t.shell.activateById(a.id);if(n.model.value)return n.model.value.text=e,void t.shell.activateById(a.id)}}}return void alert("Could not find active notebook cell. Please make sure a notebook is open and a cell is selected.")}const n=a.activeCell;n&&n.model?(n.model.sharedModel?n.model.sharedModel.setSource(e):n.model.value&&(n.model.value.text=e),t.shell.activateById(l.id)):alert("Please select a cell in the notebook")})(l.code),title:l.description},d().createElement("div",{className:"mlflow-shortcut-title"},l.title),d().createElement("div",{className:"mlflow-shortcut-description"},l.description),d().createElement("div",{className:"mlflow-shortcut-code-preview"},d().createElement("code",null,l.code.split("\n")[0],l.code.split("\n").length>1?"...":"")))))))))}const _=new r.LabIcon({name:"jupyterlab-mlflow:icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><title>Mlflow SVG Icon</title><path fill="currentColor" d="M11.883.002a12.044 12.044 0 0 0-9.326 19.463l3.668-2.694A7.573 7.573 0 0 1 12.043 4.45v2.867l6.908-5.14A12 12 0 0 0 11.883.002m9.562 4.533L17.777 7.23a7.573 7.573 0 0 1-5.818 12.322v-2.867l-6.908 5.14a12.046 12.046 0 0 0 16.394-17.29"/></svg>'});function k(e){const{settings:t,mlflowClient:l,app:n}=e,[s,i]=(0,m.useState)("tree"),[o,r]=(0,m.useState)(!1),[u,p]=(0,m.useState)(""),[w,g]=(0,m.useState)(null);return(0,m.useEffect)(()=>{t.getTrackingUri().then(e=>{p(e),e?l.setTrackingUri(e):r(!0)})},[t,l]),d().createElement("div",{className:"mlflow-panel"},d().createElement("div",{className:"mlflow-panel-header"},d().createElement("div",{className:"mlflow-panel-title"},"MLflow"),d().createElement("div",{className:"mlflow-panel-controls"},d().createElement("button",{className:"mlflow-button "+("tree"===s?"active":""),onClick:()=>i("tree"),title:"Tree View"},"ðŸ“"),d().createElement("button",{className:"mlflow-button "+("details"===s?"active":""),onClick:()=>{i("details"),g(null)},title:"Details View"},"ðŸ“‹"),d().createElement("button",{className:"mlflow-button "+("shortcuts"===s?"active":""),onClick:()=>i("shortcuts"),title:"MLflow Shortcuts"},"âš¡"),d().createElement("button",{className:"mlflow-button",onClick:async()=>{const e=u||await t.getTrackingUri();if(!e)return void r(!0);const l=e.replace(/\/$/,""),s=new c.Widget;s.addClass("mlflow-iframe-container"),s.node.innerHTML=`\n      <div class="mlflow-iframe-header">\n        <a href="${l}" target="_blank" rel="noopener noreferrer" \n           class="mlflow-pop-out-link" title="Open MLflow UI in new browser tab">\n          ðŸ”— Open in new tab\n        </a>\n      </div>\n      <iframe src="${l}" \n              sandbox="allow-same-origin allow-scripts allow-popups allow-forms"\n              class="mlflow-iframe"\n              referrerpolicy="no-referrer">\n      </iframe>\n    `;const i=new a.MainAreaWidget({content:s});i.id="mlflow-ui-widget",i.title.label="MLflow UI",i.title.icon=_,i.title.closable=!0,n.shell.add(i,"main",{activate:!0})},title:"Open MLflow UI in new tab"},"ðŸŒ"),d().createElement("button",{className:"mlflow-button",onClick:()=>r(!o),title:"Settings"},"âš™ï¸"))),o&&d().createElement("div",{className:"mlflow-settings-container"},d().createElement(b,{settings:t,mlflowClient:l,trackingUri:u,onTrackingUriChange:async e=>{p(e),e&&l.setTrackingUri(e),await t.setTrackingUri(e)},onClose:()=>r(!1)})),d().createElement("div",{className:"mlflow-panel-content"},"tree"===s?d().createElement(f,{mlflowClient:l,onOpenObject:(e,t,l)=>{i("details"),g({type:e,id:t,data:l})}}):"details"===s?d().createElement(y,{mlflowClient:l,app:n,initialSelection:w||void 0,onObjectSelect:(e,t)=>{e&&g({type:e,id:t})}}):d().createElement(x,{app:n})))}class S extends c.Widget{constructor(e,t,l){super(),this._settings=e,this._mlflowClient=t,this._app=l,this.addClass("mlflow-widget"),this.id="mlflow-widget",this.title.closable=!0}onAfterAttach(){this._render()}onBeforeDetach(){p().unmountComponentAtNode(this.node)}_render(){p().render(d().createElement(k,{settings:this._settings,mlflowClient:this._mlflowClient,app:this._app}),this.node)}}class C{constructor(e,t){this._registry=e,this._settings=null}async initialize(){const e="jupyterlab-mlflow:plugin";try{this._settings=await this._registry.load(e)}catch(t){console.error(`Failed to load settings for ${e}:`,t)}}async getTrackingUri(){if(this._settings){const e=this._settings.get("mlflowTrackingUri").composite;if(e&&""!==e.trim())return e.trim()}return""}async setTrackingUri(e){if(!this._settings)throw new Error("Settings not initialized");await this._settings.set("mlflowTrackingUri",e)}getSettings(){return this._settings?{mlflowTrackingUri:this._settings.get("mlflowTrackingUri").composite}:{mlflowTrackingUri:""}}get isLoaded(){return null!==this._settings}}var L,M=l(297);class T{constructor(e){this._trackingUri="",this._serverSettings=e||o.ServerConnection.makeSettings()}setTrackingUri(e){this._trackingUri=e}getBaseUrl(){return this._serverSettings.baseUrl}getServerSettings(){return this._serverSettings}getApiUrl(e){const t=this._serverSettings.baseUrl,l=M.URLExt.join(t,"mlflow","api",e);if(this._trackingUri){const e=l.includes("?")?"&":"?";return`${l}${e}tracking_uri=${encodeURIComponent(this._trackingUri)}`}return l}async request(e,t={}){const l=this.getApiUrl(e),a=await o.ServerConnection.makeRequest(l,{...t,headers:{...t.headers,"Content-Type":"application/json"}},this._serverSettings);if(!a.ok){const e=await a.json().catch(()=>({error:a.statusText}));throw new Error(e.error||`HTTP ${a.status}: ${a.statusText}`)}return a.json()}async testConnection(e){const t=this.getApiUrl("connection/test"),l=await o.ServerConnection.makeRequest(t,{method:"POST",body:JSON.stringify({tracking_uri:e}),headers:{"Content-Type":"application/json"}},this._serverSettings);return l.ok?l.json():{success:!1,error:(await l.json().catch(()=>({error:l.statusText}))).error||`HTTP ${l.status}: ${l.statusText}`}}async getExperiments(){return(await this.request("experiments")).experiments}async getExperiment(e){return this.request(`experiments/${e}`)}async getRuns(e){return(await this.request(`experiments/${e}/runs`)).runs}async getRun(e){return this.request(`runs/${e}`)}async getArtifacts(e,t){const l=t?`runs/${e}/artifacts?path=${encodeURIComponent(t)}`:`runs/${e}/artifacts`;return this.request(l)}async downloadArtifact(e,t){const l=this.getApiUrl(`runs/${e}/artifacts/download?path=${encodeURIComponent(t)}`);console.log("Downloading artifact from URL:",l);const a=await o.ServerConnection.makeRequest(l,{},this._serverSettings);if(console.log("Download response status:",a.status,a.statusText),console.log("Download response headers:",a.headers),!a.ok){let e=a.statusText;try{e=(await a.json()).error||e}catch(t){try{e=await a.text()||e}catch(e){}}throw new Error(`HTTP ${a.status}: ${e}`)}const n=await a.blob();if(console.log("Downloaded blob size:",n.size,"type:",n.type),0===n.size)throw new Error("Downloaded file is empty");return n}async getModels(){return(await this.request("models")).models}async getModel(e){return this.request(`models/${encodeURIComponent(e)}`)}async getLocalServerStatus(){return this.request("local-server")}async startLocalServer(e=5e3,t="sqlite:///mlflow.db",l,a){const n=this.getApiUrl("local-server"),s=JSON.stringify({port:e,tracking_uri:t,artifact_uri:l,backend_uri:a}),i=await o.ServerConnection.makeRequest(n,{method:"POST",body:s},this._serverSettings);if(!i.ok){const e=await i.json().catch(()=>({error:i.statusText}));throw new Error(e.error||`HTTP ${i.status}: ${i.statusText}`)}return i.json()}async stopLocalServer(){const e=this.getApiUrl("local-server"),t=await o.ServerConnection.makeRequest(e,{method:"DELETE"},this._serverSettings);if(!t.ok){const e=await t.json().catch(()=>({error:t.statusText}));throw new Error(e.error||`HTTP ${t.status}: ${t.statusText}`)}return t.json()}}!function(e){e.open="mlflow:open",e.toggle="mlflow:toggle",e.openUI="mlflow:open-ui"}(L||(L={}));const I=new r.LabIcon({name:"jupyterlab-mlflow:icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><title>Mlflow SVG Icon</title><path fill="currentColor" d="M11.883.002a12.044 12.044 0 0 0-9.326 19.463l3.668-2.694A7.573 7.573 0 0 1 12.043 4.45v2.867l6.908-5.14A12 12 0 0 0 11.883.002m9.562 4.533L17.777 7.23a7.573 7.573 0 0 1-5.818 12.322v-2.867l-6.908 5.14a12.046 12.046 0 0 0 16.394-17.29"/></svg>'}),U={id:"jupyterlab-mlflow:plugin",autoStart:!0,requires:[n.ISettingRegistry,i.ITranslator],optional:[a.ICommandPalette,s.IMainMenu],activate:async(e,t,l,n,s)=>{console.log("JupyterLab extension jupyterlab-mlflow is activated!");const i=new C(t,l);await i.initialize();const r=o.ServerConnection.makeSettings(),m=new T(r),d=await i.getTrackingUri();d&&m.setTrackingUri(d);const u=new S(i,m,e);u.id="mlflow-widget",u.title.icon=I,e.shell.add(u,"left",{rank:1e3});const{commands:p}=e;p.addCommand(L.open,{label:"Open MLflow",execute:()=>{u.isAttached||e.shell.add(u,"left",{rank:1e3}),e.shell.activateById(u.id)}}),p.addCommand(L.toggle,{label:"Toggle MLflow",execute:()=>{u.isAttached?u.dispose():(e.shell.add(u,"left",{rank:1e3}),e.shell.activateById(u.id))}}),p.addCommand(L.openUI,{label:"Open MLflow UI",execute:async()=>{const t=await i.getTrackingUri();if(!t)return u.isAttached||e.shell.add(u,"left",{rank:1e3}),void e.shell.activateById(u.id);const l=t.replace(/\/$/,""),n=new c.Widget;n.addClass("mlflow-iframe-container"),n.node.innerHTML=`\n          <div class="mlflow-iframe-header">\n            <a href="${l}" target="_blank" rel="noopener noreferrer" \n               class="mlflow-pop-out-link" title="Open MLflow UI in new browser tab">\n              ðŸ”— Open in new tab\n            </a>\n          </div>\n          <iframe src="${l}" \n                  sandbox="allow-same-origin allow-scripts allow-popups allow-forms"\n                  class="mlflow-iframe"\n                  referrerpolicy="no-referrer">\n          </iframe>\n        `;const s=new a.MainAreaWidget({content:n});s.id="mlflow-ui-widget",s.title.label="MLflow UI",s.title.icon=I,s.title.closable=!0,e.shell.add(s,"main",{activate:!0})}}),n&&(n.addItem({command:L.open,category:"MLflow"}),n.addItem({command:L.openUI,category:"MLflow"})),s&&s.viewMenu.addGroup([{command:L.toggle}])}}}}]);