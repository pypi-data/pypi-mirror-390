import"./CWj6FrbW.js";import"./CN51-NxK.js";import{b as wt,g as xt,q as vt,j as t,v as Et,i as g,d as ue,e as F,a as i,c as d,k as R,r as l,t as N,w as o,s as oe,p as kt,f as k,m as B,n as ne,o as zt,aT as Bt,u as Me,l as Le,z as ot,x as be,aX as qt}from"./CvTLsZlf.js";import{i as C}from"./B3D73U8p.js";import{k as Zt}from"./BOeiEyRi.js";import{e as Nt,i as Ft}from"./uF71e8HK.js";import{s as Pt}from"./D4SMs5q_.js";import{s as mt,a as st}from"./CPzR4-ix.js";import{a as Xt}from"./BpTtYi1u.js";import{b as Ot}from"./DSjMDx8q.js";import{b as Ut}from"./Cz9Z7v2M.js";import{p as Yt}from"./Bfc47y5P.js";import{i as Ct}from"./CNVL70pO.js";import{p as h}from"./DBxQAEQJ.js";import{a as je,s as Tt}from"./DzS5ldT-.js";import{t as $e}from"./Cqe-NRGo.js";import{n as Jt,b as Qt,g as $t,e as bt,c as ea,d as ta,m as aa}from"./BhUNH95W.js";import{k as ra,n as na,v as oa,o as sa,a as la,p as ia,q as ca,r as da,t as ua,u as va,w as ga,x as fa}from"./1mkyv6O_.js";import{g as ma}from"./Bl6rOkVW.js";import{u as pa,F as ha}from"./CwxHrcdq.js";import{C as _a,a as ya,g as yt,b as ba,I as wa}from"./-Q5E0hnJ.js";import"./CXLK5pxB.js";import{b as xa,c as Lt}from"./DM-96xXi.js";import{f as Ea}from"./BjO3HhBo.js";import{D as ka}from"./BggWuidE.js";import{T as ut}from"./k6hQMChD.js";import{V as Ca,R as Ta}from"./B_kxDH--.js";import{I as Ia}from"./Aa-3RUhz.js";import{F as Sa}from"./CRRA9G6A.js";import{H as Aa,L as Ra}from"./DBKj4Hrk.js";import{s as Da}from"./BUfFq6WV.js";import{S as Ua}from"./Cgvnmqcj.js";import{X as $a}from"./BFL0NFeS.js";var La=k('<!> <div class="line-clamp-1"> </div>',1),Ma=k('<!> <div class=" line-clamp-1"> </div>',1),za=k("<!> <!>",1),Ba=k('<div slot="content"><!></div>');function Na(lt,v){wt(v,!1);const y=()=>je(xe,"$i18n",we),[we,f]=Tt(),xe=xt("i18n");let ze=h(v,"screenCaptureHandler",8),Q=h(v,"uploadFilesHandler",8),Be=h(v,"onClose",8,()=>{}),q=B(!1);const T=async()=>{};vt(()=>t(q),()=>{t(q)&&T()}),Et(),Ct(),ka(lt,{get show(){return t(q)},set show(I){g(q,I)},$$events:{change:I=>{I.detail===!1&&Be()()}},children:(I,it)=>{{let se=ne(()=>(y(),o(()=>y().t("More"))));ut(I,{get content(){return t(se)},children:(Ne,Ee)=>{var ve=ue(),ge=F(ve);Pt(ge,v,"default",{},null),i(Ne,ve)},$$slots:{default:!0}})}},$$slots:{default:!0,content:(I,it)=>{var se=Ba(),Ne=d(se);xa(Ne,{class:"w-full max-w-[200px] rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-999 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition",sideOffset:4,alignOffset:-6,side:"bottom",align:"start",get transition(){return Ea},children:(Ee,ve)=>{var ge=za(),Fe=F(ge);Lt(Fe,{class:"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl",$$events:{click:()=>{Q()()}},children:(Ke,Ge)=>{var P=La(),Ce=F(P);_a(Ce,{});var le=R(Ce,2),ee=d(le,!0);l(le),N(te=>oe(ee,te),[()=>(y(),o(()=>y().t("Upload Files")))]),i(Ke,P)},$$slots:{default:!0}});var ke=R(Fe,2);Lt(ke,{class:"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50  rounded-xl",$$events:{click:()=>{ze()()}},children:(Ke,Ge)=>{var P=Ma(),Ce=F(P);ya(Ce,{});var le=R(Ce,2),ee=d(le,!0);l(le),N(te=>oe(ee,te),[()=>(y(),o(()=>y().t("Capture")))]),i(Ke,P)},$$slots:{default:!0}}),i(Ee,ge)},$$slots:{default:!0}}),l(se),i(I,se)}},$$legacy:!0}),kt(),f()}var Fa=k('<div class="px-2 text-xs text-gray-500 py-1"><!></div>'),Pa=k('<div class=" size-4 justify-center flex items-center mr-0.5"><!></div>'),Oa=k('<img class="rounded-full size-5 items-center mr-2"/>'),Ha=k('<img class="rounded-full size-5 items-center mr-2"/>'),Va=k('<button type="button"><!> <div class="truncate flex-1 pr-2"> </div> <div class="shrink-0 text-xs text-gray-500"><!></div></button>'),Wa=k("<!> <!>",1),ja=k('<div class="mention-list text-black dark:text-white rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 flex flex-col bg-white dark:bg-gray-850 w-72 p-1" id="suggestions-container"><div class="overflow-y-auto scrollbar-thin max-h-60"></div></div>');function Mt(lt,v){wt(v,!1);const y=()=>je(Jt,"$channels",xe),we=()=>je(Qt,"$models",xe),f=()=>je(Be,"$i18n",xe),[xe,ze]=Tt(),Q=B(),Be=xt("i18n");let q=h(v,"query",8,""),T=h(v,"command",8),I=h(v,"selectedIndex",12,0);h(v,"label",8,""),h(v,"triggerChar",8,"@");let it=h(v,"modelSuggestions",8,!1),se=h(v,"userSuggestions",8,!1),Ne=h(v,"channelSuggestions",8,!1),Ee=B([]),ve=B([]),ge=B([]);const Fe=async()=>{const n=await Da(localStorage.token,q()).catch(m=>null);n&&g(ve,[...n.users.map(m=>({type:"user",id:m.id,label:m.name}))].sort((m,fe)=>m.label.localeCompare(fe.label)))},ke=n=>{const m=t(Q)[n];m&&m&&T()({id:`${m.type==="user"?"U":m.type==="model"?"M":"C"}:${m.id}|${m.label}`,label:m.label})},Ke=n=>{if(!["ArrowUp","ArrowDown","Enter","Tab","Escape"].includes(n.key))return!1;if(n.key==="ArrowUp"){I(Math.max(0,I()-1));const m=document.querySelector('[data-selected="true"]');return m==null||m.scrollIntoView({block:"center",inline:"nearest",behavior:"instant"}),!0}if(n.key==="ArrowDown"){I(Math.min(I()+1,t(Q).length-1));const m=document.querySelector('[data-selected="true"]');return m==null||m.scrollIntoView({block:"center",inline:"nearest",behavior:"instant"}),!0}return n.key==="Enter"||n.key==="Tab"?(ke(I()),n.key==="Enter"&&n.preventDefault(),!0):n.key==="Escape"};function Ge(n){return Ke(n)}const P=n=>{n.key==="Enter"&&(n.preventDefault(),ke(I()))};zt(async()=>{window.addEventListener("keydown",P),Ne()?g(ge,[...y().map(n=>({type:"channel",id:n.id,label:n.name,data:n}))]):(se()&&await Fe(),it()&&g(Ee,[...we().map(n=>({type:"model",id:n.id,label:n.name,data:n}))]))}),Bt(()=>{window.removeEventListener("keydown",P)}),vt(()=>(t(ve),t(Ee),t(ge),Me(q())),()=>{g(Q,[...t(ve),...t(Ee),...t(ge)].filter(n=>n.label.toLowerCase().includes(q().toLowerCase())||n.id.toLowerCase().includes(q().toLowerCase())))}),vt(()=>(Me(q()),Me(se())),()=>{q()!==null&&se()&&Fe()}),Et();var Ce={_onKeyDown:Ge};Ct();var le=ue(),ee=F(le);{var te=n=>{var m=ja(),fe=d(m);Nt(fe,5,()=>t(Q),Ft,(Je,u,me)=>{var Qe=Wa(),ct=F(Qe);{var gt=Pe=>{var Z=Fa(),qe=d(Z);{var ae=pe=>{var X=ot();N(Ie=>oe(X,Ie),[()=>(f(),o(()=>f().t("Users")))]),i(pe,X)},Te=pe=>{var X=ue(),Ie=F(X);{var Ze=ie=>{var Y=ot();N(Oe=>oe(Y,Oe),[()=>(f(),o(()=>f().t("Models")))]),i(ie,Y)},et=ie=>{var Y=ue(),Oe=F(Y);{var L=D=>{var O=ot();N(he=>oe(O,he),[()=>(f(),o(()=>f().t("Channels")))]),i(D,O)};C(Oe,D=>{t(u),o(()=>{var O;return((O=t(u))==null?void 0:O.type)==="channel"})&&D(L)},!0)}i(ie,Y)};C(Ie,ie=>{t(u),o(()=>{var Y;return((Y=t(u))==null?void 0:Y.type)==="model"})?ie(Ze):ie(et,!1)},!0)}i(pe,X)};C(qe,pe=>{t(u),o(()=>{var X;return((X=t(u))==null?void 0:X.type)==="user"})?pe(ae):pe(Te,!1)})}l(Z),i(Pe,Z)};C(ct,Pe=>{t(u),t(Q),o(()=>{var Z,qe;return me===0||((Z=t(u))==null?void 0:Z.type)!==((qe=t(Q)[me-1])==null?void 0:qe.type)})&&Pe(gt)})}var pt=R(ct,2);{let Pe=ne(()=>(t(u),o(()=>{var Z;return(Z=t(u))==null?void 0:Z.id})));ut(pt,{get content(){return t(Pe)},placement:"top-start",children:(Z,qe)=>{var ae=Va(),Te=d(ae);{var pe=L=>{var D=Pa(),O=d(D);{var he=S=>{Aa(S,{className:"size-3",strokeWidth:"2.5"})},Xe=S=>{Ra(S,{className:"size-[15px]",strokeWidth:"2"})};C(O,S=>{t(u),o(()=>{var z,e;return((e=(z=t(u))==null?void 0:z.data)==null?void 0:e.access_control)===null})?S(he):S(Xe,!1)})}l(D),i(L,D)},X=L=>{var D=ue(),O=F(D);{var he=S=>{var z=Oa();N(()=>{st(z,"src",(t(u),Me($t),o(()=>{var e,r,a,c;return((c=(a=(r=(e=t(u))==null?void 0:e.data)==null?void 0:r.info)==null?void 0:a.meta)==null?void 0:c.profile_image_url)??`${$t}/static/favicon.png`}))),st(z,"alt",(t(u),o(()=>{var e,r;return((r=(e=t(u))==null?void 0:e.data)==null?void 0:r.name)??t(u).id})))}),i(S,z)},Xe=S=>{var z=ue(),e=F(z);{var r=a=>{var c=Ha();N(()=>{st(c,"src",(Me(bt),t(u),o(()=>`${bt}/users/${t(u).id}/profile/image`))),st(c,"alt",(t(u),o(()=>{var b;return((b=t(u))==null?void 0:b.label)??t(u).id})))}),i(a,c)};C(e,a=>{t(u),o(()=>t(u).type==="user")&&a(r)},!0)}i(S,z)};C(O,S=>{t(u),o(()=>t(u).type==="model")?S(he):S(Xe,!1)},!0)}i(L,D)};C(Te,L=>{t(u),o(()=>t(u).type==="channel")?L(pe):L(X,!1)})}var Ie=R(Te,2),Ze=d(Ie,!0);l(Ie);var et=R(Ie,2),ie=d(et);{var Y=L=>{var D=ot();N(O=>oe(D,O),[()=>(f(),o(()=>f().t("User")))]),i(L,D)},Oe=L=>{var D=ue(),O=F(D);{var he=S=>{var z=ot();N(e=>oe(z,e),[()=>(f(),o(()=>f().t("Model")))]),i(S,z)},Xe=S=>{var z=ue(),e=F(z);{var r=a=>{var c=ot();N(b=>oe(c,b),[()=>(f(),o(()=>f().t("Channel")))]),i(a,c)};C(e,a=>{t(u),o(()=>t(u).type==="channel")&&a(r)},!0)}i(S,z)};C(O,S=>{t(u),o(()=>t(u).type==="model")?S(he):S(Xe,!1)},!0)}i(L,D)};C(ie,L=>{t(u),o(()=>t(u).type==="user")?L(Y):L(Oe,!1)})}l(et),l(ae),N(()=>{mt(ae,1,`flex items-center justify-between px-2.5 py-1.5 rounded-xl w-full text-left ${me===I()?"bg-gray-50 dark:bg-gray-800 selected-command-option-button":""}`),st(ae,"data-selected",me===I()),oe(Ze,(t(u),o(()=>t(u).label)))}),Le("click",ae,()=>ke(me)),Le("mousemove",ae,()=>{I(me)}),i(Z,ae)},$$slots:{default:!0}})}i(Je,Qe)}),l(fe),l(m),i(n,m)};C(ee,n=>{t(Q),o(()=>t(Q).length)&&n(te)})}i(lt,le),Ot(v,"_onKeyDown",Ge);var W=kt(Ce);return ze(),W}var Ka=k('<input type="file" hidden="" multiple/>'),Ga=k('<div class=" absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none"><button class=" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg></button></div>'),qa=k('<div><div class=" text-xs px-1 mt-1.5 flex items-center gap-1.5"><!> <div><span class=" font-normal text-black dark:text-white"> </span> </div></div></div>'),Za=k('<div class="px-3 pt-3 text-left w-full flex flex-col z-10"><div class="flex items-center justify-between w-full"><div class="pl-[1px] flex items-center gap-2 text-sm"><div class="translate-y-[0.5px]"><span> </span></div></div> <div><button class="flex items-center dark:text-gray-500"><!></button></div></div></div>'),Xa=k('<div class=" relative group"><div class="relative"><!></div> <div class=" absolute -top-1 -right-1"><button class=" bg-white text-black border border-white rounded-full group-hover:visible invisible transition" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg></button></div></div>'),Ya=k('<div class="mx-2 mt-2.5 -mb-1 flex flex-wrap gap-2"></div>'),Ja=k('<button id="input-menu-button" class="bg-transparent hover:bg-white/80 text-gray-800 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5 outline-hidden focus:outline-hidden" type="button" aria-label="More"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"></path></svg></button>'),Qa=k('<button id="voice-input-button" class=" text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 mr-0.5 self-center" type="button" aria-label="Voice Input"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-y-[0.5px]"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"></path></svg></button>'),er=k('<button class="bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg></button>'),tr=k('<div class=" flex items-center"><!></div>'),ar=k('<button id="send-message-button" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z" clip-rule="evenodd"></path></svg></button>'),rr=k('<div class=" flex items-center"><!></div>'),nr=k('<form class="w-full flex gap-1.5"><div id="message-input-container" class="flex-1 flex flex-col relative w-full shadow-lg rounded-3xl border border-gray-50 dark:border-gray-850 hover:border-gray-100 focus-within:border-gray-100 hover:dark:border-gray-800 focus-within:dark:border-gray-800 transition px-1 bg-white/90 dark:bg-gray-400/5 dark:text-gray-100"><!> <!> <div class="px-2.5"><div class="scrollbar-hidden rtl:text-right ltr:text-left bg-transparent dark:text-gray-100 outline-hidden w-full pt-2.5 pb-[5px] px-1 resize-none h-fit max-h-96 overflow-auto"><!></div></div> <div class=" flex justify-between mb-2.5 mx-0.5"><div class="ml-1 self-end flex space-x-1 flex-1"><!></div> <div class="self-end flex space-x-1 mr-1"><!> <div class=" flex items-center"><!></div></div></div></div></form>'),or=k('<!> <!> <!> <div class="bg-transparent"><div class="max-w-full mx-auto inset-x-0 relative"><div class="absolute top-0 left-0 right-0 mx-auto inset-x-0 bg-transparent flex justify-center"><div class="flex flex-col px-3 w-full"><div class="relative"><!></div> <!></div></div> <div><!></div></div></div>',1);function Fr(lt,v){wt(v,!1);const y=()=>je(Be,"$i18n",ze),we=()=>je(ea,"$config",ze),f=()=>je(ta,"$settings",ze),xe=()=>je(aa,"$mobile",ze),[ze,Q]=Tt(),Be=xt("i18n");let q=h(v,"placeholder",24,()=>y().t("Type here..."));h(v,"id",8,null);let T=h(v,"chatInputElement",12),I=h(v,"typingUsers",24,()=>[]),it=h(v,"inputLoading",8,!1),se=h(v,"onSubmit",8,e=>{}),Ne=h(v,"onChange",8,e=>{}),Ee=h(v,"onStop",8,e=>{}),ve=h(v,"scrollEnd",12,!0),ge=h(v,"scrollToBottom",8,()=>{}),Fe=h(v,"disabled",8,!1),ke=h(v,"acceptFiles",8,!0);h(v,"showFormattingToolbar",8,!0);let Ke=h(v,"userSuggestions",8,!1),Ge=h(v,"channelSuggestions",8,!1),P=h(v,"replyToMessage",12,null),Ce=h(v,"typingUsersClassName",8,"from-white dark:from-gray-900"),le=B(!1),ee=B(!1),te=B(!1),W=B(""),n=B([]),m=B(),fe=B(),Je=B(!1),u=B(),me=B({}),Qe={};const ct=async e=>(g(me,sa(e)),Object.keys(t(me)).length===0?e:(g(Je,!0),await new Promise(r=>{g(u,a=>{Qe={...Qe,...a},pt(Qe),g(Je,!1),r(e)})}))),gt=async e=>{if(e.includes("{{CLIPBOARD}}")){const a=await navigator.clipboard.readText().catch(j=>($e.error(y().t("Failed to read clipboard contents")),"{{CLIPBOARD}}")),c=await navigator.clipboard.read();let b=null;for(const j of c)for(const ce of j.types)if(ce.startsWith("image/")){const _e=await j.getType(ce);b=URL.createObjectURL(_e)}b&&g(n,[...t(n),{type:"image",url:b}]),e=e.replaceAll("{{CLIPBOARD}}",a)}if(e.includes("{{USER_LOCATION}}")){let a;try{a=await la()}catch{$e.error(y().t("Location access not allowed")),a="LOCATION_UNKNOWN"}e=e.replaceAll("{{USER_LOCATION}}",String(a))}const r=await ma(localStorage.token);if(e.includes("{{USER_NAME}}")){const a=(r==null?void 0:r.name)||"User";e=e.replaceAll("{{USER_NAME}}",a)}if(e.includes("{{USER_BIO}}")){const a=(r==null?void 0:r.bio)||"";a&&(e=e.replaceAll("{{USER_BIO}}",a))}if(e.includes("{{USER_GENDER}}")){const a=(r==null?void 0:r.gender)||"";a&&(e=e.replaceAll("{{USER_GENDER}}",a))}if(e.includes("{{USER_BIRTH_DATE}}")){const a=(r==null?void 0:r.date_of_birth)||"";a&&(e=e.replaceAll("{{USER_BIRTH_DATE}}",a))}if(e.includes("{{USER_AGE}}")){const a=(r==null?void 0:r.date_of_birth)||"";if(a){const c=ia(a);e=e.replaceAll("{{USER_AGE}}",c)}}if(e.includes("{{USER_LANGUAGE}}")){const a=localStorage.getItem("locale")||"en-US";e=e.replaceAll("{{USER_LANGUAGE}}",a)}if(e.includes("{{CURRENT_DATE}}")){const a=ca();e=e.replaceAll("{{CURRENT_DATE}}",a)}if(e.includes("{{CURRENT_TIME}}")){const a=da();e=e.replaceAll("{{CURRENT_TIME}}",a)}if(e.includes("{{CURRENT_DATETIME}}")){const a=ua();e=e.replaceAll("{{CURRENT_DATETIME}}",a)}if(e.includes("{{CURRENT_TIMEZONE}}")){const a=va();e=e.replaceAll("{{CURRENT_TIMEZONE}}",a)}if(e.includes("{{CURRENT_WEEKDAY}}")){const a=ga();e=e.replaceAll("{{CURRENT_WEEKDAY}}",a)}return e},pt=e=>{document.getElementById("chat-input")&&(T().replaceVariables(e),T().focus())},Pe=async(e,r)=>{var c,b;document.getElementById("chat-input")&&(e!==""&&(e=await gt(e||"")),(c=T())==null||c.setText(e),(b=T())==null||b.focus(),e!==""&&(e=await ct(e)),await be(),r&&await r(e))},Z=()=>{var a;const e=document.getElementById("chat-input");let r="";return e&&(r=(a=T())==null?void 0:a.getWordAtDocPos()),r},qe=e=>{var a;document.getElementById("chat-input")&&((a=T())==null||a.replaceCommandWithText(e))},ae=async e=>{var c;const r=document.getElementById("chat-input");if(!r)return;e=await gt(e),t(Te)?qe(e):(c=T())==null||c.insertContent(e),await be(),e=await ct(e),await be();const a=document.getElementById("chat-input-container");a&&(a.scrollTop=a.scrollHeight),await be(),r&&(r.focus(),r.dispatchEvent(new Event("input")),ra(prompt).length>0?await be():r.scrollTop=r.scrollHeight)};let Te=B(""),pe=h(v,"showCommands",12,!1),X=B(null);const Ie=async()=>{try{const e=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"never"},audio:!1}),r=document.createElement("video");r.srcObject=e,await r.play();const a=document.createElement("canvas");a.width=r.videoWidth,a.height=r.videoHeight,a.getContext("2d").drawImage(r,0,0,a.width,a.height),e.getTracks().forEach(j=>j.stop()),window.focus();const b=a.toDataURL("image/png");g(n,[...t(n),{type:"image",url:b}]),r.srcObject=null}catch(e){}},Ze=async e=>{e.forEach(async r=>{var a,c,b,j,ce,_e,Se,He;if(console.info("Processing file:",{name:r.name,type:r.type,size:r.size,extension:r.name.split(".").at(-1)}),(((c=(a=we())==null?void 0:a.file)==null?void 0:c.max_size)??null)!==null&&r.size>(((j=(b=we())==null?void 0:b.file)==null?void 0:j.max_size)??0)*1024*1024){r.size,(((_e=(ce=we())==null?void 0:ce.file)==null?void 0:_e.max_size)??0)*1024*1024,$e.error(y().t("File size should not exceed {{maxSize}} MB.",{maxSize:(He=(Se=we())==null?void 0:Se.file)==null?void 0:He.max_size}));return}if(r.type.startsWith("image/")){const Ve=async(p,U={},de={})=>{var E,$,De,Ye,Ue,rt;const Re=(U==null?void 0:U.imageCompression)??!1,tt=(($=(E=de==null?void 0:de.file)==null?void 0:E.image_compression)==null?void 0:$.width)??null,at=((Ye=(De=de==null?void 0:de.file)==null?void 0:De.image_compression)==null?void 0:Ye.height)??null;if(!Re&&!tt&&!at)return p;let We=null,w=null;return Re&&(We=((Ue=U==null?void 0:U.imageCompressionSize)==null?void 0:Ue.width)??null,w=((rt=U==null?void 0:U.imageCompressionSize)==null?void 0:rt.height)??null),tt&&(We===null||We>tt)&&(We=tt),at&&(w===null||w>at)&&(w=at),We||w?await fa(p,We,w):p};let Ae=new FileReader;Ae.onload=async p=>{var de,Re;let U=p.target.result;(de=f())!=null&&de.imageCompression&&((Re=f())!=null&&Re.imageCompressionInChannels)&&(U=await Ve(U,f(),we())),g(n,[...t(n),{type:"image",url:`${U}`}])},Ae.readAsDataURL(r.type==="image/heic"?await na(r):r)}else et(r)})},et=async e=>{var c,b,j,ce,_e,Se,He,Ve;const r=oa(),a={type:"file",file:"",id:null,url:"",name:e.name,collection_name:"",status:"uploading",size:e.size,error:"",itemId:r};if(a.size==0)return $e.error(y().t("You cannot upload an empty file.")),null;g(n,[...t(n),a]);try{let Ae=null;(e.type.startsWith("audio/")||e.type.startsWith("video/"))&&((j=(b=(c=f())==null?void 0:c.audio)==null?void 0:b.stt)!=null&&j.language)&&(Ae={language:(Se=(_e=(ce=f())==null?void 0:ce.audio)==null?void 0:_e.stt)==null?void 0:Se.language});const p=await pa(localStorage.token,e,Ae);p?(console.info("File upload completed:",{id:p.id,name:a.name,collection:(He=p==null?void 0:p.meta)==null?void 0:He.collection_name}),p.error&&(p.error,$e.warning(p.error)),a.status="uploaded",a.file=p,a.id=p.id,a.collection_name=((Ve=p==null?void 0:p.meta)==null?void 0:Ve.collection_name)||(p==null?void 0:p.collection_name),a.url=`${bt}/files/${p.id}`,g(n,t(n))):g(n,t(n).filter(U=>(U==null?void 0:U.itemId)!==r))}catch(Ae){$e.error(`${Ae}`),g(n,t(n).filter(p=>(p==null?void 0:p.itemId)!==r))}},ie=e=>{e.key==="Escape"&&g(ee,!1)},Y=e=>{var r,a;e.preventDefault(),(a=(r=e.dataTransfer)==null?void 0:r.types)!=null&&a.includes("Files")?g(ee,!0):g(ee,!1)},Oe=()=>{g(ee,!1)},L=async e=>{var r,a;if(e.preventDefault(),(r=e.dataTransfer)!=null&&r.files&&ke()){const c=Array.from((a=e.dataTransfer)==null?void 0:a.files);c&&c.length>0&&Ze(c)}g(ee,!1)},D=async()=>{var e;t(W)===""&&t(n).length===0||(se()({content:t(W),data:{files:t(n)}}),g(W,""),g(n,[]),T()&&((e=T())==null||e.setText(""),await be(),T().focus()))};zt(async()=>{g(X,[{char:"@",render:yt(Mt,{i18n:Be,triggerChar:"@",modelSuggestions:!0,userSuggestions:Ke()})},...Ge()?[{char:"#",render:yt(Mt,{i18n:Be,triggerChar:"#",channelSuggestions:Ge()})}]:[],{char:"/",render:yt(ba,{i18n:Be,onSelect:r=>{var b;const{type:a,data:c}=r;(b=document.getElementById("chat-input"))==null||b.focus()},insertTextHandler:ae,onUpload:r=>{const{type:a,data:c}=r;if(a==="file"){if(t(n).find(b=>b.id===c.id))return;g(n,[...t(n),{...c,status:"processed"}])}}})}]),g(le,!0),window.setTimeout(()=>{T()&&T().focus()},100),window.addEventListener("keydown",ie),await be();const e=document.getElementById("channel-container");e==null||e.addEventListener("dragover",Y),e==null||e.addEventListener("drop",L),e==null||e.addEventListener("dragleave",Oe)}),Bt(()=>{window.removeEventListener("keydown",ie);const e=document.getElementById("channel-container");e&&(e==null||e.removeEventListener("dragover",Y),e==null||e.removeEventListener("drop",L),e==null||e.removeEventListener("dragleave",Oe))}),vt(()=>t(Te),()=>{var e;pe(["/"].includes((e=t(Te))==null?void 0:e.charAt(0)))}),vt(()=>(t(W),Me(Ne())),()=>{t(W)&&Ne()()}),Et();var O={setText:Pe};Ct();var he=ue(),Xe=F(he);{var S=e=>{var r=or(),a=F(r);Sa(a,{get show(){return t(ee)}});var c=R(a,2);{var b=w=>{var E=Ka();Ut(E,$=>g(m,$),()=>t(m)),Xt(E,()=>t(fe),$=>g(fe,$)),Le("change",E,async()=>{t(fe)&&t(fe).length>0?Ze(Array.from(t(fe))):$e.error(y().t("File not found.")),qt(m,t(m).value="")}),i(w,E)};C(c,w=>{ke()&&w(b)})}var j=R(c,2);wa(j,{get variables(){return t(me)},get onSave(){return t(u)},get show(){return t(Je)},set show(w){g(Je,w)},$$legacy:!0});var ce=R(j,2),_e=d(ce),Se=d(_e),He=d(Se),Ve=d(He),Ae=d(Ve);{var p=w=>{var E=Ga(),$=d(E);l(E),Le("click",$,()=>{ve(!0),ge()()}),i(w,E)};C(Ae,w=>{ve()===!1&&w(p)})}l(Ve);var U=R(Ve,2);{var de=w=>{var E=qa(),$=d(E),De=d($);Ua(De,{size:"xs"});var Ye=R(De,2),Ue=d(Ye),rt=d(Ue,!0);l(Ue);var dt=R(Ue);l(Ye),l($),l(E),N((nt,ht)=>{mt(E,1,` -mt-7 pb-2.5 bg-gradient-to-t to-transparent ${Ce()??""} pointer-events-none select-none`),oe(rt,nt),oe(dt,` ${ht??""}`)},[()=>(Me(I()),o(()=>I().map(nt=>nt.name).join(", "))),()=>(y(),o(()=>y().t("is typing...")))]),i(w,E)};C(U,w=>{Me(I()),o(()=>I().length>0)&&w(de)})}l(He),l(Se);var Re=R(Se,2),tt=d(Re);{var at=w=>{Ca(w,{onCancel:async()=>{g(te,!1),await be(),T()&&T().focus()},onConfirm:async E=>{const{text:$,filename:De}=E;g(te,!1),await be(),ae($),await be(),T()&&T().focus()},get recording(){return t(te)},set recording(E){g(te,E)},$$legacy:!0})},We=w=>{var E=nr(),$=d(E),De=d($);{var Ye=_=>{var A=Za(),K=d(A),x=d(K),M=d(x),H=d(M),s=d(H,!0);l(H),l(M),l(x);var V=R(x,2),re=d(V),J=d(re);$a(J,{}),l(re),l(V),l(K),l(A),N(G=>oe(s,G),[()=>(y(),Me(P()),o(()=>{var G,ye;return y().t("Replying to {{NAME}}",{NAME:((ye=(G=P())==null?void 0:G.meta)==null?void 0:ye.model_name)??P().user.name})}))]),Le("click",re,()=>{P(null)}),i(_,A)};C(De,_=>{P()!==null&&_(Ye)})}var Ue=R(De,2);{var rt=_=>{var A=Ya();Nt(A,5,()=>t(n),Ft,(K,x,M)=>{var H=ue(),s=F(H);{var V=J=>{var G=Xa(),ye=d(G),ft=d(ye);Ia(ft,{get src(){return t(x),o(()=>t(x).url)},alt:"",imageClassName:" size-10 rounded-xl object-cover"}),l(ye);var Dt=R(ye,2),Gt=d(Dt);l(Dt),l(G),Le("click",Gt,()=>{t(n).splice(M,1),g(n,t(n))}),i(J,G)},re=J=>{{let G=ne(()=>(t(x),o(()=>{var ft;return(ft=t(x))==null?void 0:ft.size}))),ye=ne(()=>(t(x),o(()=>t(x).status==="uploading")));ha(J,{get item(){return t(x)},get name(){return t(x),o(()=>t(x).name)},get type(){return t(x),o(()=>t(x).type)},get size(){return t(G)},small:!0,get loading(){return t(ye)},dismissible:!0,edit:!0,$$events:{dismiss:()=>{t(n).splice(M,1),g(n,t(n))},click:()=>{t(x)}}})}};C(s,J=>{t(x),o(()=>t(x).type==="image")?J(V):J(re,!1)})}i(K,H)}),l(A),i(_,A)};C(Ue,_=>{t(n),o(()=>t(n).length>0)&&_(rt)})}var dt=R(Ue,2),nt=d(dt),ht=d(nt);Zt(ht,()=>(f(),o(()=>{var _;return(_=f())==null?void 0:_.richTextInput})),_=>{{let A=ne(()=>!Fe()),K=ne(()=>(f(),o(()=>{var s;return((s=f())==null?void 0:s.richTextInput)??!0}))),x=ne(()=>(f(),o(()=>{var s;return((s=f())==null?void 0:s.showFormattingToolbar)??!1}))),M=ne(()=>(f(),xe(),o(()=>{var s;return!(((s=f())==null?void 0:s.ctrlEnterToSend)??!1)&&!xe()&&!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)}))),H=ne(()=>(f(),o(()=>{var s;return((s=f())==null?void 0:s.largeTextAsFile)??!1})));Ut(Ta(_,{id:"chat-input",json:!0,messageInput:!0,get editable(){return t(A)},get placeholder(){return q()},get richText(){return t(K)},get showFormattingToolbar(){return t(x)},get shiftEnter(){return t(M)},get largeTextAsFile(){return t(H)},floatingMenuPlacement:"top-start",get suggestions(){return t(X)},onChange:s=>{const{md:V}=s;g(W,V),g(Te,Z())},$$events:{keydown:async s=>{s=s.detail.event,s.ctrlKey||s.metaKey,document.getElementById("suggestions-container")||(!xe()||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))&&(s.keyCode===13&&!s.shiftKey&&s.preventDefault(),t(W)!==""&&s.keyCode===13&&!s.shiftKey&&D()),s.key==="Escape"&&(console.info("Escape"),P(null))},paste:async s=>{s=s.detail.event;const V=s.clipboardData||window.clipboardData;if(V&&V.items){for(const re of V.items)if(re.type.indexOf("image")!==-1){const J=re.getAsFile(),G=new FileReader;G.onload=function(ye){g(n,[...t(n),{type:"image",url:`${ye.target.result}`}])},G.readAsDataURL(J)}else if((re==null?void 0:re.kind)==="file"){const J=re.getAsFile();J&&(await Ze([J]),s.preventDefault())}}}},$$legacy:!0}),s=>T(s),()=>T())}}),l(nt),l(dt);var It=R(dt,2),_t=d(It),Ht=d(_t);Pt(Ht,v,"menu",{},_=>{var A=ue(),K=F(A);{var x=M=>{Na(M,{screenCaptureHandler:Ie,uploadFilesHandler:()=>{t(m).click()},children:(H,s)=>{var V=Ja();i(H,V)},$$slots:{default:!0}})};C(K,M=>{ke()&&M(x)})}i(_,A)}),l(_t);var St=R(_t,2),At=d(St);{var Vt=_=>{{let A=ne(()=>(y(),o(()=>y().t("Record voice"))));ut(_,{get content(){return t(A)},children:(K,x)=>{var M=Qa();Le("click",M,async()=>{try{let H=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(s){return $e.error(y().t("Permission denied when accessing microphone: {{error}}",{error:s})),null});H&&(g(te,!0),H.getTracks().forEach(V=>V.stop())),H=null}catch{$e.error(y().t("Permission denied when accessing microphone"))}}),i(K,M)},$$slots:{default:!0}})}};C(At,_=>{t(W)===""&&_(Vt)})}var Rt=R(At,2),Wt=d(Rt);{var jt=_=>{var A=tr(),K=d(A);{let x=ne(()=>(y(),o(()=>y().t("Stop"))));ut(K,{get content(){return t(x)},children:(M,H)=>{var s=er();Le("click",s,()=>{Ee()()}),i(M,s)},$$slots:{default:!0}})}l(A),i(_,A)},Kt=_=>{var A=rr(),K=d(A);{let x=ne(()=>(y(),o(()=>y().t("Send message"))));ut(K,{get content(){return t(x)},children:(M,H)=>{var s=ar();N(()=>{mt(s,1,`${t(W),t(n),o(()=>t(W)!==""||t(n).length!==0?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")??""} transition rounded-full p-1.5 self-center`),s.disabled=(t(W),t(n),o(()=>t(W)===""&&t(n).length===0))}),i(M,s)},$$slots:{default:!0}})}l(A),i(_,A)};C(Wt,_=>{it()&&Ee()?_(jt):_(Kt,!1)})}l(Rt),l(St),l(It),l($),l(E),N(()=>{st($,"dir",(f(),o(()=>{var _;return((_=f())==null?void 0:_.chatDirection)??"auto"}))),$.dir=$.dir}),Le("submit",E,Yt(()=>{D()})),i(w,E)};C(tt,w=>{t(te)?w(at):w(We,!1)})}l(Re),l(_e),l(ce),N(()=>mt(Re,1,`${Fe()?"opacity-50 pointer-events-none cursor-not-allowed":""} relative z-20`)),i(e,r)};C(Xe,e=>{t(le)&&e(S)})}i(lt,he),Ot(v,"setText",Pe);var z=kt(O);return Q(),z}export{Fr as M};
//# sourceMappingURL=CfeWcOlg.js.map
