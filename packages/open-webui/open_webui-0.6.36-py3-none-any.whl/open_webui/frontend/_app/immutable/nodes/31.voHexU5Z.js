import"../chunks/CWj6FrbW.js";import"../chunks/CN51-NxK.js";import{t as H,a as p,B as mt,b as tt,y as pt,c as l,j as e,r as a,p as rt,f as x,n as ee,u as Rt,w as c,g as gt,i,l as Q,e as xe,k as v,s as Z,m as S,o as Ot,aT as qt,q as ut,v as Vt,aX as We,d as Xt,aY as It}from"../chunks/CvTLsZlf.js";import{i as he}from"../chunks/B3D73U8p.js";import{k as Dt}from"../chunks/BOeiEyRi.js";import{a as fe,s as at,c as ht,r as Ze}from"../chunks/CPzR4-ix.js";import{b as Le,a as Yt}from"../chunks/BpTtYi1u.js";import{i as lt}from"../chunks/CNVL70pO.js";import{a as Be,s as xt}from"../chunks/DzS5ldT-.js";import{F as Wt}from"../chunks/CU2r43ac.js";import{t as u}from"../chunks/Cqe-NRGo.js";import{g as Gt}from"../chunks/B3JesTH8.js";import{p as Jt}from"../chunks/Di6qbzG7.js";import{c as Qt,d as Zt,l as er,u as tr}from"../chunks/BhUNH95W.js";import{F as rr,u as ar,g as lr,a as sr}from"../chunks/CwxHrcdq.js";import{b as or,r as ir,e as nr,u as dr,g as cr,f as vr,h as ur}from"../chunks/CoVvR703.js";import{C as fr,v as mr}from"../chunks/1mkyv6O_.js";import{S as ft}from"../chunks/DD1zKOTk.js";import{e as pr,i as gr}from"../chunks/uF71e8HK.js";import{p as oe}from"../chunks/DBxQAEQJ.js";import"../chunks/CXLK5pxB.js";import{b as hr,c as Qe}from"../chunks/DM-96xXi.js";import{f as xr}from"../chunks/BjO3HhBo.js";import{D as wr}from"../chunks/BggWuidE.js";import{T as et}from"../chunks/k6hQMChD.js";import{F as yr}from"../chunks/B5NGLVQn.js";import{p as _r}from"../chunks/Bfc47y5P.js";import"../chunks/BqAeIAOr.js";import{M as br}from"../chunks/B1Io5-Zn.js";import{R as $r,V as kr}from"../chunks/B_kxDH--.js";import{X as Fr}from"../chunks/BFL0NFeS.js";import{M as Cr}from"../chunks/D_bGA0GB.js";import{C as Sr}from"../chunks/CJhxu3Yk.js";import{D as Pr}from"../chunks/ChrjiQ2X.js";import{C as zr}from"../chunks/B0itHwGp.js";import{L as Mr}from"../chunks/BzcWeUV3.js";import{A as Ir}from"../chunks/KcmNtx4b.js";import{S as Dr}from"../chunks/B0jU0TkR.js";import{F as Wr}from"../chunks/CRRA9G6A.js";var Br=mt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m15 11.25-3-3m0 0-3 3m3-3v7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>');function Nr(j,$){let r=oe($,"className",8,"size-4"),B=oe($,"strokeWidth",8,"1.5");var k=Br();H(()=>{fe(k,"stroke-width",B()),at(k,0,ht(r()))}),p(j,k)}var Tr=x('<div class="mt-1 px-2"><!></div>'),Er=x('<div class=" max-h-full flex flex-col w-full"></div>');function Ar(j,$){tt($,!1);const r=pt();let B=oe($,"selectedFileId",8,null),k=oe($,"files",24,()=>[]),ie=oe($,"small",8,!1);lt();var te=Er();pr(te,5,k,gr,(O,m)=>{var w=Tr(),P=l(w);{let F=ee(()=>(Rt(B()),e(m),c(()=>B()===e(m).id?" bg-gray-50 dark:bg-gray-850":"bg-transparent"))),o=ee(()=>(e(m),c(()=>{var z,q,M;return((z=e(m))==null?void 0:z.name)??((M=(q=e(m))==null?void 0:q.meta)==null?void 0:M.name)}))),X=ee(()=>(e(m),c(()=>{var z,q,M;return((z=e(m))==null?void 0:z.size)??((M=(q=e(m))==null?void 0:q.meta)==null?void 0:M.size)??""}))),Y=ee(()=>(e(m),c(()=>e(m).status==="uploading")));rr(P,{className:"w-full",get colorClassName(){return`${e(F)??""} hover:bg-gray-50 dark:hover:bg-gray-850 transition`},get small(){return ie()},get item(){return e(m)},get name(){return e(o)},type:"file",get size(){return e(X)},get loading(){return e(Y)},dismissible:!0,$$events:{click:()=>{e(m).status!=="uploading"&&r("click",e(m).id)},dismiss:()=>{e(m).status!=="uploading"&&r("delete",e(m).id)}}})}a(w),p(O,w)}),a(te),p(j,te),rt()}var Kr=mt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12"></path></svg>');function Lr(j,$){let r=oe($,"className",8,"size-4"),B=oe($,"strokeWidth",8,"1.5");var k=Kr();H(()=>{fe(k,"stroke-width",B()),at(k,0,ht(r()))}),p(j,k)}var Ur=mt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg>');function Hr(j,$){let r=oe($,"className",8,"size-4"),B=oe($,"strokeWidth",8,"1.5");var k=Ur();H(()=>{fe(k,"stroke-width",B()),at(k,0,ht(r()))}),p(j,k)}var jr=x('<button class=" p-1.5 rounded-xl hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition font-medium text-sm flex items-center space-x-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"></path></svg></button>'),Rr=x('<!> <div class="flex items-center"> </div>',1),Or=x('<!> <div class="flex items-center"> </div>',1),qr=x('<!> <div class="flex items-center"> </div>',1),Vr=x('<!> <div class="flex items-center"> </div>',1),Xr=x("<!> <!> <!> <!>",1),Yr=x('<div slot="content"><!></div>');function Gr(j,$){tt($,!1);const r=()=>Be(te,"$i18n",B),[B,k]=xt(),ie=pt(),te=gt("i18n");let O=oe($,"onClose",8,()=>{}),m=S(!1);lt(),wr(j,{align:"end",get show(){return e(m)},set show(w){i(m,w)},$$events:{change:w=>{w.detail===!1&&O()()}},children:(w,P)=>{{let F=ee(()=>(r(),c(()=>r().t("Add Content"))));et(w,{get content(){return e(F)},children:(o,X)=>{var Y=jr();Q("click",Y,z=>{z.stopPropagation(),i(m,!0)}),p(o,Y)},$$slots:{default:!0}})}},$$slots:{default:!0,content:(w,P)=>{var F=Yr(),o=l(F);hr(o,{class:"w-full max-w-44 rounded-xl p-1 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-sm",sideOffset:4,side:"bottom",align:"end",get transition(){return xr},children:(X,Y)=>{var z=Xr(),q=xe(z);Qe(q,{class:"flex  gap-2  items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$events:{click:()=>{ie("upload",{type:"files"})}},children:(y,A)=>{var N=Rr(),C=xe(N);Nr(C,{strokeWidth:"2"});var K=v(C,2),T=l(K,!0);a(K),H(E=>Z(T,E),[()=>(r(),c(()=>r().t("Upload files")))]),p(y,N)},$$slots:{default:!0}});var M=v(q,2);Qe(M,{class:"flex  gap-2  items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$events:{click:()=>{ie("upload",{type:"directory"})}},children:(y,A)=>{var N=Or(),C=xe(N);yr(C,{strokeWidth:"2"});var K=v(C,2),T=l(K,!0);a(K),H(E=>Z(T,E),[()=>(r(),c(()=>r().t("Upload directory")))]),p(y,N)},$$slots:{default:!0}});var re=v(M,2);{let y=ee(()=>(r(),c(()=>r().t("This option will delete all existing files in the collection and replace them with newly uploaded files."))));et(re,{get content(){return e(y)},className:"w-full",children:(A,N)=>{Qe(A,{class:"flex  gap-2  items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$events:{click:()=>{ie("sync",{type:"directory"})}},children:(C,K)=>{var T=qr(),E=xe(T);Hr(E,{strokeWidth:"2"});var V=v(E,2),Ue=l(V,!0);a(V),H(me=>Z(Ue,me),[()=>(r(),c(()=>r().t("Sync directory")))]),p(C,T)},$$slots:{default:!0}})},$$slots:{default:!0}})}var _=v(re,2);Qe(_,{class:"flex  gap-2  items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$events:{click:()=>{ie("upload",{type:"text"})}},children:(y,A)=>{var N=Vr(),C=xe(N);Lr(C,{strokeWidth:"2"});var K=v(C,2),T=l(K,!0);a(K),H(E=>Z(T,E),[()=>(r(),c(()=>r().t("Add text content")))]),p(y,N)},$$slots:{default:!0}}),p(X,z)},$$slots:{default:!0}}),a(F),p(w,F)}},$$legacy:!0}),rt(),k()}var Jr=x('<div class=" max-w-full w-full"><!></div>'),Qr=x('<button class=" p-2 bg-gray-50 text-gray-700 dark:bg-gray-700 dark:text-white transition rounded-full" type="button"><!></button>'),Zr=x('<button class=" px-3.5 py-2 bg-black text-white dark:bg-white dark:text-black transition rounded-full" type="submit"> </button>'),ea=x('<div class="absolute top-0 right-0 p-5"><button class="self-center dark:text-white" type="button"><!></button></div> <div class="flex flex-col md:flex-row w-full h-full md:space-x-4 dark:text-gray-200"><form class="flex flex-col w-full h-full"><div class=" flex-1 w-full h-full flex justify-center overflow-auto px-5 py-4"><div class=" max-w-3xl py-2 md:py-10 w-full flex flex-col gap-2"><div class="shrink-0 w-full flex justify-between items-center"><div class="w-full"><input class="w-full text-3xl font-semibold bg-transparent outline-hidden svelte-1bctwft" type="text" required/></div></div> <div class=" flex-1 w-full h-full"><!></div></div></div> <div class="flex flex-row items-center justify-end text-sm font-medium shrink-0 mt-1 p-4 gap-1.5"><div><!></div> <div class=" shrink-0"><!></div></div></form></div>',1);function ta(j,$){tt($,!1);const r=()=>Be(ie,"$i18n",B),[B,k]=xt(),ie=gt("i18n"),te=pt();let O=oe($,"show",12,!1),m=S(r().t("Untitled")),w=S(""),P=S(!1);lt(),br(j,{size:"full",containerClassName:"",className:"h-full bg-white dark:bg-gray-900",get show(){return O()},set show(F){O(F)},children:(F,o)=>{var X=ea(),Y=xe(X),z=l(Y),q=l(z);Fr(q,{className:"size-3.5"}),a(z),a(Y);var M=v(Y,2),re=l(M),_=l(re),y=l(_),A=l(y),N=l(A),C=l(N);Ze(C),a(N),a(A);var K=v(A,2),T=l(K);{let L=ee(()=>(r(),c(()=>r().t("Write something..."))));$r(T,{get placeholder(){return e(L)},preserveBreaks:!0,get value(){return e(w)},set value(ae){i(w,ae)},$$legacy:!0})}a(K),a(y),a(_);var E=v(_,2),V=l(E),Ue=l(V);{var me=L=>{var ae=Jr(),Ne=l(ae);kr(Ne,{className:"p-1",onCancel:()=>{i(P,!1)},onConfirm:ne=>{const{text:de,filename:ke}=ne;i(w,`${e(w)}${de} `),i(P,!1)},get recording(){return e(P)},set recording(ne){i(P,ne)},$$legacy:!0}),a(ae),p(L,ae)},He=L=>{{let ae=ee(()=>(r(),c(()=>r().t("Voice Input"))));et(L,{get content(){return e(ae)},children:(Ne,ne)=>{var de=Qr(),ke=l(de);Cr(ke,{className:"size-5"}),a(de),Q("click",de,async()=>{try{let Fe=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(Te){return u.error(r().t("Permission denied when accessing microphone: {{error}}",{error:Te})),null});Fe&&(i(P,!0),Fe.getTracks().forEach(ot=>ot.stop())),Fe=null}catch{u.error(r().t("Permission denied when accessing microphone"))}}),p(Ne,de)},$$slots:{default:!0}})}};he(Ue,L=>{e(P)?L(me):L(He,!1)})}a(V);var je=v(V,2),st=l(je);{let L=ee(()=>(r(),c(()=>r().t("Save"))));et(st,{get content(){return e(L)},children:(ae,Ne)=>{var ne=Zr(),de=l(ne,!0);a(ne),H(ke=>Z(de,ke),[()=>(r(),c(()=>r().t("Save")))]),p(ae,ne)},$$slots:{default:!0}})}a(je),a(E),a(re),a(M),H(L=>fe(C,"placeholder",L),[()=>(r(),c(()=>r().t("Title")))]),Q("click",z,()=>{O(!1)}),Le(C,()=>e(m),L=>i(m,L)),Q("submit",re,_r(()=>{if(e(m).trim()===""||e(w).trim()===""){u.error(r().t("Please fill in all fields.")),i(m,e(m).trim()),i(w,e(w).trim());return}te("submit",{name:e(m),content:e(w)}),O(!1),i(m,""),i(w,"")})),p(F,X)},$$slots:{default:!0},$$legacy:!0}),rt(),k()}var ra=x('<div class="ml-2 self-center"><!></div>'),aa=x('<textarea class="w-full h-full outline-none resize-none"></textarea>'),la=x('<div class=" flex flex-col w-full"><div class="shrink-0 mb-2 flex items-center"><!> <div class=" flex-1 text-xl font-medium"><a class="hover:text-gray-500 dark:hover:text-gray-100 hover:underline grow line-clamp-1" target="_blank"> </a></div> <div><button class="self-center w-fit text-sm py-1 px-2.5 dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"> <!></button></div></div> <div class=" flex-1 w-full h-full max-h-full text-sm bg-transparent outline-hidden overflow-y-auto scrollbar-hidden"><!></div></div>'),sa=x('<div class="h-full flex w-full"><div class="m-auto text-xs text-center text-gray-200 dark:text-gray-700"> </div></div>'),oa=x('<div class="flex-1 flex justify-start w-full h-full max-h-full"><!></div>'),ia=x('<div class="ml-2 self-center"><!></div>'),na=x('<textarea class="w-full h-full outline-none resize-none"></textarea>'),da=x('<div class="flex flex-col justify-start h-full max-h-full p-2"><div class=" flex flex-col w-full h-full max-h-full"><div class="shrink-0 mt-1 mb-2 flex items-center"><div class="mr-2"><button class="w-full text-left text-sm p-1.5 rounded-lg dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-gray-850"><!></button></div> <div class=" flex-1 text-xl line-clamp-1"> </div> <div><button class="self-center w-fit text-sm py-1 px-2.5 dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"> <!></button></div></div> <div class=" flex-1 w-full h-full max-h-full py-2.5 px-3.5 rounded-lg text-sm bg-transparent overflow-y-auto scrollbar-hidden"><!></div></div></div>'),ca=x('<div class=" flex overflow-y-auto h-full w-full scrollbar-hidden text-xs"><!></div>'),va=x('<div class="my-3 flex flex-col justify-center text-center text-gray-500 text-xs"><div> </div></div>'),ua=x('<!> <div class="w-full mb-2.5"><div class=" flex w-full"><div class="flex-1"><div class="flex items-center justify-between w-full px-0.5 mb-1"><div class="w-full"><input type="text" class="text-left w-full font-semibold text-2xl font-primary bg-transparent outline-hidden"/></div> <div class="self-center shrink-0"><button class="bg-gray-50 hover:bg-gray-100 text-black dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-white transition px-2 py-1 rounded-full flex gap-1 items-center" type="button"><!> <div class="text-sm font-medium shrink-0"> </div></button></div></div> <div class="flex w-full px-1"><input type="text" class="text-left text-xs w-full text-gray-500 bg-transparent outline-hidden"/></div></div></div></div> <div class="flex flex-row flex-1 h-full max-h-full pb-2.5 gap-3"><!> <div><div class=" flex flex-col w-full space-x-2 rounded-lg h-full"><div class="w-full h-full flex flex-col"><div class=" px-3"><div class="flex mb-0.5"><div class=" self-center ml-1 mr-3"><!></div> <input class=" w-full text-sm pr-4 py-1 rounded-r-xl outline-hidden bg-transparent"/> <div><!></div></div></div> <!></div></div></div></div>',1),fa=x('<!> <!> <!> <input id="files-input" type="file" multiple hidden=""/> <div class="flex flex-col w-full h-full translate-y-1" id="collection-container"><!></div>',1);function ma(j,$){tt($,!1);const r=()=>Be(w,"$i18n",O),B=()=>Be(Qt,"$config",O),k=()=>Be(Zt,"$settings",O),ie=()=>Be(Jt,"$page",O),te=()=>Be(tr,"$user",O),[O,m]=xt(),w=gt("i18n");let P=S(!0),F=S(null),o=S(null),X=S(""),Y=S(!1),z=S(!1),q=S(!1),M=S(null),re=S([]),_=S(null),y=S(null),A=S(""),N=new Map,C=S(null),K=null,T,E=S(!1),V=S(!1);const Ue=(t,s)=>{const n=new Blob([s],{type:"text/plain"}),d=fr(n,`${t}.txt`);return d},me=async t=>{var d,b,I,D,g,W,le,pe,Ce,Re,Ye,Oe,Se,qe;const s=mr(),n={type:"file",file:"",id:null,url:"",name:t.name,size:t.size,status:"uploading",error:"",itemId:s};if(n.size==0)return u.error(r().t("You cannot upload an empty file.")),null;if((((b=(d=B())==null?void 0:d.file)==null?void 0:b.max_size)??null)!==null&&t.size>(((D=(I=B())==null?void 0:I.file)==null?void 0:D.max_size)??0)*1024*1024){t.size,(((W=(g=B())==null?void 0:g.file)==null?void 0:W.max_size)??0)*1024*1024,u.error(r().t("File size should not exceed {{maxSize}} MB.",{maxSize:(pe=(le=B())==null?void 0:le.file)==null?void 0:pe.max_size}));return}We(o,e(o).files=[...e(o).files??[],n]);try{let Pe=null;(t.type.startsWith("audio/")||t.type.startsWith("video/"))&&((Ye=(Re=(Ce=k())==null?void 0:Ce.audio)==null?void 0:Re.stt)!=null&&Ye.language)&&(Pe={language:(qe=(Se=(Oe=k())==null?void 0:Oe.audio)==null?void 0:Se.stt)==null?void 0:qe.language});const ce=await ar(localStorage.token,t,Pe).catch(ve=>(u.error(`${ve}`),null));ce?(We(o,e(o).files=e(o).files.map(ve=>(ve.itemId===s&&(ve.id=ce.id),delete ve.itemId,ve))),ce.error?(console.warn("File upload warning:",ce.error),u.warning(ce.error),We(o,e(o).files=e(o).files.filter(ve=>ve.id!==ce.id))):await ne(ce.id)):u.error(r().t("Failed to upload file."))}catch(Pe){u.error(`${Pe}`)}},He=async()=>{const t="showDirectoryPicker"in window;try{t?await st():await L()}catch(s){ae(s)}},je=t=>t.split("/").some(s=>s.startsWith(".")),st=async()=>{const t=await window.showDirectoryPicker();let s=0,n=0;const d=()=>{const D=n/s*100;u.info(r().t("Upload Progress: {{uploadedFiles}}/{{totalFiles}} ({{percentage}}%)",{uploadedFiles:n,totalFiles:s,percentage:D.toFixed(2)}))};async function b(D){for await(const g of D.values())g.name.startsWith(".")||(g.kind==="file"?s++:g.kind==="directory"&&(g.name.startsWith(".")||await b(g)))}async function I(D,g=""){for await(const W of D.values()){if(W.name.startsWith("."))continue;const le=g?`${g}/${W.name}`:W.name;if(!je(le))if(W.kind==="file"){const pe=await W.getFile(),Ce=new File([pe],le,{type:pe.type});await me(Ce),n++,d()}else W.kind==="directory"&&(W.name.startsWith(".")||await I(W,le))}}await b(t),d(),s>0&&await I(t)},L=async()=>new Promise((t,s)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0,n.directory=!0,n.multiple=!0,n.style.display="none",document.body.appendChild(n),n.onchange=async()=>{try{const d=Array.from(n.files).filter(g=>!je(g.webkitRelativePath));let b=d.length,I=0;const D=()=>{const g=I/b*100;u.info(r().t("Upload Progress: {{uploadedFiles}}/{{totalFiles}} ({{percentage}}%)",{uploadedFiles:I,totalFiles:b,percentage:g.toFixed(2)}))};D();for(const g of d)if(!g.name.startsWith(".")){const W=g.webkitRelativePath||g.name,le=new File([g],W,{type:g.type});await me(le),I++,D()}document.body.removeChild(n),t()}catch(d){s(d)}},n.onerror=d=>{document.body.removeChild(n),s(d)},n.click()}),ae=t=>{t.name==="AbortError"?u.info(r().t("Directory selection was cancelled")):u.error(r().t("Error accessing directory"))},Ne=async()=>{var t;if((((t=e(o))==null?void 0:t.files)??[]).length>0){const s=await ir(localStorage.token,e(F)).catch(n=>{u.error(`${n}`)});s&&(i(o,s),u.success(r().t("Knowledge reset successfully.")),He())}else He()},ne=async t=>{const s=await nr(localStorage.token,e(F),t).catch(n=>(u.error(`${n}`),null));s?(i(o,s),u.success(r().t("File added successfully."))):(u.error(r().t("Failed to add file.")),We(o,e(o).files=e(o).files.filter(n=>n.id!==t)))},de=async t=>{try{const s=await vr(localStorage.token,e(F),t);s&&(i(o,s),u.success(r().t("File removed successfully.")))}catch(s){u.error(`${s}`)}},ke=async()=>{if(!e(V)){i(V,!0);try{const t=e(_).id,s=e(A);N.delete(t);const n=await sr(localStorage.token,t,s).catch(b=>{u.error(`${b}`)}),d=await ur(localStorage.token,e(F),t).catch(b=>{u.error(`${b}`)});n&&d&&(i(o,d),u.success(r().t("File content updated successfully.")))}finally{i(V,!1)}}},Fe=()=>{K&&clearTimeout(K),K=setTimeout(async()=>{if(e(o).name.trim()===""||e(o).description.trim()===""){u.error(r().t("Please fill in all fields."));return}await dr(localStorage.token,e(F),{...e(o),name:e(o).name,description:e(o).description,access_control:e(o).access_control}).catch(s=>{u.error(`${s}`)})&&(u.success(r().t("Knowledge updated successfully")),er.set(await cr(localStorage.token)))},1e3)},Te=async t=>{t.matches?i(P,!0):i(P,!1)},ot=async t=>{try{if(i(_,t),N.has(t.id)){i(A,N.get(t.id));return}const s=await lr(localStorage.token,t.id);s?(i(A,s.data.content),N.set(t.id,s.data.content)):u.error(r().t("No content found in file."))}catch{u.error(r().t("Failed to load file content."))}},wt=t=>{var s,n;t.preventDefault(),(n=(s=t.dataTransfer)==null?void 0:s.types)!=null&&n.includes("Files")?i(E,!0):i(E,!1)},yt=()=>{i(E,!1)},_t=async t=>{var s,n,d,b;if(t.preventDefault(),i(E,!1),(n=(s=t.dataTransfer)==null?void 0:s.types)!=null&&n.includes("Files")&&(d=t.dataTransfer)!=null&&d.files){const I=(b=t.dataTransfer)==null?void 0:b.files;if(I&&I.length>0)for(const D of I)await me(D);else u.error(r().t("File not found."))}};Ot(async()=>{T=window.matchMedia("(min-width: 1024px)"),T.addEventListener("change",Te),Te(T);const t=document.getElementById("collection-container");e(P)&&Math.floor(300/t.clientWidth*100),new ResizeObserver(b=>{for(let I of b){const g=300/I.contentRect.width*100;e(P)&&Math.floor(g)}}).observe(t),i(F,ie().params.id);const n=await or(localStorage.token,e(F)).catch(b=>(u.error(`${b}`),null));n?i(o,n):Gt("/workspace/knowledge");const d=document.querySelector("body");d==null||d.addEventListener("dragover",wt),d==null||d.addEventListener("drop",_t),d==null||d.addEventListener("dragleave",yt)}),qt(()=>{T==null||T.removeEventListener("change",Te);const t=document.querySelector("body");t==null||t.removeEventListener("dragover",wt),t==null||t.removeEventListener("drop",_t),t==null||t.removeEventListener("dragleave",yt)});const Bt=t=>{try{return decodeURIComponent(t)}catch{return t}};ut(()=>(e(o),Wt),()=>{e(o)&&e(o).files&&i(C,new Wt(e(o).files,{keys:["meta.name","meta.description"]}))}),ut(()=>(e(C),e(X),e(o)),()=>{var t;e(C)&&i(re,e(X)?e(C).search(e(X)).map(s=>s.item):((t=e(o))==null?void 0:t.files)??[])}),ut(()=>(e(y),e(o)),()=>{var t;if(e(y)){const s=(((t=e(o))==null?void 0:t.files)??[]).find(n=>n.id===e(y));s?ot(s):i(_,null)}else i(_,null)}),Vt(),lt();var bt=fa(),$t=xe(bt);Wr($t,{get show(){return e(E)}});var kt=v($t,2);{let t=ee(()=>(r(),c(()=>r().t("This will reset the knowledge base and sync all files. Do you wish to continue?"))));Sr(kt,{get message(){return e(t)},get show(){return e(z)},set show(s){i(z,s)},$$events:{confirm:()=>{Ne()}},$$legacy:!0})}var Ft=v(kt,2);ta(Ft,{get show(){return e(Y)},set show(t){i(Y,t)},$$events:{submit:t=>{const s=Ue(t.detail.name,t.detail.content);me(s)}},$$legacy:!0});var it=v(Ft,2),Ct=v(it,2),Nt=l(Ct);{var Tt=t=>{var s=ua(),n=xe(s);{let f=ee(()=>(te(),c(()=>{var h,G,U,ue;return((U=(G=(h=te())==null?void 0:h.permissions)==null?void 0:G.sharing)==null?void 0:U.public_knowledge)||((ue=te())==null?void 0:ue.role)==="admin"})));Ir(n,{get allowPublic(){return e(f)},onChange:()=>{Fe()},accessRoles:["read","write"],get show(){return e(q)},set show(h){i(q,h)},get accessControl(){return e(o).access_control},set accessControl(h){We(o,e(o).access_control=h)},$$legacy:!0})}var d=v(n,2),b=l(d),I=l(b),D=l(I),g=l(D),W=l(g);Ze(W),a(g);var le=v(g,2),pe=l(le),Ce=l(pe);Mr(Ce,{strokeWidth:"2.5",className:"size-3.5"});var Re=v(Ce,2),Ye=l(Re,!0);a(Re),a(pe),a(le),a(D);var Oe=v(D,2),Se=l(Oe);Ze(Se),a(Oe),a(I),a(b),a(d);var qe=v(d,2),Pe=l(qe);{var ce=f=>{var h=oa(),G=l(h);{var U=we=>{var ge=la(),ze=l(ge),ye=l(ze);he(ye,J=>{});var _e=v(ye,2),Me=l(_e),Xe=l(Me,!0);a(Me),a(_e);var Ee=v(_e,2),Ae=l(Ee),Ke=l(Ae),vt=v(Ke);{var Ge=J=>{var R=ra(),be=l(R);ft(be,{}),a(R),p(J,R)};he(vt,J=>{e(V)&&J(Ge)})}a(Ae),a(Ee),a(ze);var Ie=v(ze,2),Je=l(Ie);Dt(Je,()=>(e(_),c(()=>e(_).id)),J=>{var R=aa();It(R),H(be=>fe(R,"placeholder",be),[()=>(r(),c(()=>r().t("Add content here")))]),Le(R,()=>e(A),be=>i(A,be)),p(J,R)}),a(Ie),a(ge),H((J,R)=>{fe(Me,"href",(e(_),c(()=>e(_).id?`/api/v1/files/${e(_).id}/content`:"#"))),Z(Xe,J),Ae.disabled=e(V),Z(Ke,`${R??""} `)},[()=>(e(_),c(()=>{var J,R;return Bt((R=(J=e(_))==null?void 0:J.meta)==null?void 0:R.name)})),()=>(r(),c(()=>r().t("Save")))]),Q("click",Ae,()=>{ke()}),p(we,ge)},ue=we=>{var ge=sa(),ze=l(ge),ye=l(ze,!0);a(ze),a(ge),H(_e=>Z(ye,_e),[()=>(r(),c(()=>r().t("Drag and drop a file to upload or select a file to view")))]),p(we,ge)};he(G,we=>{e(_)?we(U):we(ue,!1)})}a(h),p(f,h)},ve=f=>{var h=Xt(),G=xe(h);{var U=ue=>{{let we=ee(()=>e(y)!==null);Pr(ue,{className:"h-full",get show(){return e(we)},onClose:()=>{i(y,null)},children:(ge,ze)=>{var ye=da(),_e=l(ye),Me=l(_e),Xe=l(Me),Ee=l(Xe),Ae=l(Ee);zr(Ae,{strokeWidth:"2.5"}),a(Ee),a(Xe);var Ke=v(Xe,2),vt=l(Ke,!0);a(Ke);var Ge=v(Ke,2),Ie=l(Ge),Je=l(Ie),J=v(Je);{var R=De=>{var se=ia(),$e=l(se);ft($e,{}),a(se),p(De,se)};he(J,De=>{e(V)&&De(R)})}a(Ie),a(Ge),a(Me);var be=v(Me,2),jt=l(be);Dt(jt,()=>(e(_),c(()=>e(_).id)),De=>{var se=na();It(se),H($e=>fe(se,"placeholder",$e),[()=>(r(),c(()=>r().t("Add content here")))]),Le(se,()=>e(A),$e=>i(A,$e)),p(De,se)}),a(be),a(_e),a(ye),H(De=>{Z(vt,(e(_),c(()=>{var se,$e;return($e=(se=e(_))==null?void 0:se.meta)==null?void 0:$e.name}))),Ie.disabled=e(V),Z(Je,`${De??""} `)},[()=>(r(),c(()=>r().t("Save")))]),Q("click",Ee,()=>{i(y,null)}),Q("click",Ie,()=>{ke()}),p(ge,ye)},$$slots:{default:!0}})}};he(G,ue=>{!e(P)&&e(y)!==null&&ue(U)},!0)}p(f,h)};he(Pe,f=>{e(P)?f(ce):f(ve,!1)})}var nt=v(Pe,2),St=l(nt),Pt=l(St),dt=l(Pt),zt=l(dt),ct=l(zt),At=l(ct);Dr(At,{}),a(ct);var Ve=v(ct,2);Ze(Ve);var Mt=v(Ve,2),Kt=l(Mt);Gr(Kt,{$$events:{upload:f=>{f.detail.type==="directory"?He():f.detail.type==="text"?i(Y,!0):document.getElementById("files-input").click()},sync:f=>{i(z,!0)}}}),a(Mt),a(zt),a(dt);var Lt=v(dt,2);{var Ut=f=>{var h=ca(),G=l(h);Ar(G,{small:!0,get files(){return e(re)},get selectedFileId(){return e(y)},$$events:{click:U=>{i(y,e(y)===U.detail?null:U.detail)},delete:U=>{U.detail,i(y,null),de(U.detail)}}}),a(h),p(f,h)},Ht=f=>{var h=va(),G=l(h),U=l(G,!0);a(G),a(h),H(ue=>Z(U,ue),[()=>(r(),c(()=>r().t("No content found")))]),p(f,h)};he(Lt,f=>{e(re),c(()=>e(re).length>0)?f(Ut):f(Ht,!1)})}a(Pt),a(St),a(nt),a(qe),H((f,h,G,U)=>{fe(W,"placeholder",f),Z(Ye,h),fe(Se,"placeholder",G),at(nt,1,`${e(P)?"shrink-0 w-72 max-w-72":"flex-1"}
			flex
			py-2
			rounded-2xl
			border
			border-gray-50
			h-full
			dark:border-gray-850`),fe(Ve,"placeholder",U)},[()=>(r(),c(()=>r().t("Knowledge Name"))),()=>(r(),c(()=>r().t("Access"))),()=>(r(),c(()=>r().t("Knowledge Description"))),()=>(r(),e(o),c(()=>{var f,h;return`${r().t("Search Collection")}${(((f=e(o))==null?void 0:f.files)??[]).length?` (${(((h=e(o))==null?void 0:h.files)??[]).length})`:""}`}))]),Le(W,()=>e(o).name,f=>We(o,e(o).name=f)),Q("input",W,()=>{Fe()}),Q("click",pe,()=>{i(q,!0)}),Le(Se,()=>e(o).description,f=>We(o,e(o).description=f)),Q("input",Se,()=>{Fe()}),Le(Ve,()=>e(X),f=>i(X,f)),Q("focus",Ve,()=>{i(y,null)}),p(t,s)},Et=t=>{ft(t,{className:"size-5"})};he(Nt,t=>{e(F)&&e(o)?t(Tt):t(Et,!1)})}a(Ct),Yt(it,()=>e(M),t=>i(M,t)),Q("change",it,async()=>{if(e(M)&&e(M).length>0){for(const s of e(M))await me(s);i(M,null);const t=document.getElementById("files-input");t&&(t.value="")}else u.error(r().t("File not found."))}),p(j,bt),rt(),m()}function el(j){ma(j,{})}export{el as component};
//# sourceMappingURL=31.voHexU5Z.js.map
